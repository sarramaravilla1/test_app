"use strict";(self.webpackChunktest_app=self.webpackChunktest_app||[]).push([[2633,9912],{9912:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>ee,createFieldInfoMap:()=>B,findRelatedLayer:()=>fe,findUtilityNetwork:()=>ce,fixTokens:()=>O,formatAttributes:()=>ne,formatEditInfo:()=>$,formatValueToFieldInfo:()=>P,getAllFieldInfos:()=>K,getFieldFormat:()=>U,getFieldInfo:()=>W,getFieldInfoLabel:()=>E,getFixedFieldName:()=>k,getFixedFieldNames:()=>M,getSourceLayer:()=>C,graphicCallback:()=>L,htmlEntities:()=>X,isAssociatedFeatureSupportedLayer:()=>Q,isExpressionField:()=>x,isFeatureSupportedLayer:()=>G,isGraphicForRelatableFeatureSupportedLayer:()=>_,isRelatableFeatureSupportedLayer:()=>Y,isRelatableLayer:()=>J,isRelatedField:()=>oe,isSupportedContext:()=>q,preLayerQueryCallback:()=>se,preRequestCallback:()=>de,querySourceLayer:()=>ie,queryUpdatedFeature:()=>re,shouldOpenInNewTab:()=>Z,substituteAttributes:()=>D,substituteFieldsInLinksAndAttributes:()=>j});var i=n(89379),r=n(81806),o=n(76460),l=n(88685),a=n(65256),u=n(50265),s=n(94890),d=n(53430),f=n(31933),c=n(42633),p=n(76386),y=n(67478);const m=()=>o.A.getLogger("esri.widgets.Feature.support.featureUtils"),g=/href=(""|'')/gi,v=/(\{([^{\r\n]+)\})/g,h=/'/g,I=/^\s*expression\//i,b=/(\n)/gi,F=/[\u00A0-\u9999<>&]/gim,T=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,w=/^(?:mailto:|tel:)/,A="relationships/",N=(0,a.J2)("short-date-short-time");function C(e){var t;if(null!=e)return null!==(t=e.sourceLayer||e.layer)&&void 0!==t?t:void 0}async function L(e){let{type:t,value:n,event:i}=e;try{return"function"==typeof n?n(i):await n}catch(r){return void m().error("error",'An error occurred when calling the "'.concat(t,'" function'),{error:r,graphic:i.graphic,value:n})}}function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!w.test(e.trim().toLowerCase())}function x(e){return!!e&&I.test(e)}function q(e){let{fieldInfo:t,graphic:n}=e;return!(null===t||void 0===t||!t.fieldName||x(t.fieldName)||oe(t.fieldName)||null!==n&&void 0!==n&&n.isAggregate||null!==n&&void 0!==n&&n.popupTemplate)}function E(e){let{expressionInfos:t,fieldInfo:n,graphic:i,isContentFieldInfos:r,layer:o}=e;if(null===n||void 0===n||!n.fieldName)return null;const l=function(e,t){if(!t||!x(t)||!e)return;const n=t.replace(I,"").toLowerCase();return e.find(e=>{let{name:t}=e;return t.toLowerCase()===n})}(t,n.fieldName);if(l)return l.title||null;if((0,f.jy)(o)&&q({fieldInfo:n,graphic:i})){const e=o.getFieldAlias(n.fieldName);return r?n.label||e||n.fieldName:e||n.fieldName}return n.label||n.fieldName}function U(e){let{fieldInfo:t,isContentFieldInfos:n,layer:i}=e;if(null===t||void 0===t||!t.fieldName)return null;if((0,f.jy)(i)){var r;const e=i.popupTemplate||i.fieldConfigurations?null===(r=i.getFieldConfiguration(t.fieldName))||void 0===r?void 0:r.fieldFormat:(0,s.iu)(t,i.getField(t.fieldName));return n&&t.fieldFormat||e}return null}function k(e,t){const n=R(t,e);return n?n.name:e}function M(e,t){return e&&e.map(e=>k(e,t))}function R(e,t){var n;return e&&"function"==typeof e.getField&&t&&null!==(n=e.getField(t))&&void 0!==n?n:null}function S(e){return"".concat(e).trim()}function j(e){let{attributes:t,globalAttributes:n,layer:r,text:o,expressionAttributes:l,fieldInfoMap:a}=e;return o?D({formattedAttributes:n,template:H(o,(0,i.A)((0,i.A)((0,i.A)({},n),l),t),r),fieldInfoMap:a}):""}function D(e){let{formattedAttributes:t,template:n,fieldInfoMap:i}=e;return S(function(e){return e.replaceAll(g,"")}((0,l.HC)((0,l.HC)(n,e=>function(e,t){const n=t.get(e.toLowerCase());return"{".concat((null===n||void 0===n?void 0:n.fieldName)||e,"}")}(e,i)),t)))}function z(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,i.A)({},e);return Object.keys(n).forEach(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t[e];if("string"==typeof i){const r="%27",o=(n?encodeURIComponent(i):i).replaceAll(h,r);t[e]=o}}(e,n,t)),n}function O(e,t){return e.replaceAll(v,(e,n,i)=>{const r=R(t,i);return r?"{".concat(r.name,"}"):n})}function H(e,t,n){const i=O(e,n);return i?i.replaceAll(T,(e,n,i)=>function(e,t,n){const i=(t=S(t))&&!t.startsWith("{");return(0,l.HC)(e,z(n,i||!1))}(e,n||i,t)):i}function G(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function J(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function Y(e){return G(e)&&J(e)}function Q(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function _(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&Y(e.sourceLayer)}function P(e,t){const{fieldInfos:n,fieldName:r,graphic:o,isContentFieldInfos:l,layer:a,preventPlacesFormatting:s,timeZone:p}=t,y=W(n,r),m=R(a,r),g=(0,f.jy)(a)&&q({fieldInfo:y,graphic:o}),v=g?null:null===y||void 0===y?void 0:y.format,h=g?U({fieldInfo:y,layer:a,isContentFieldInfos:l}):null,I="number"===(null===h||void 0===h?void 0:h.type);if(y&&!(0,d.JL)(r)){const t=null===m||void 0===m?void 0:m.type,n="date-time"===(null===h||void 0===h?void 0:h.type),i=null===v||void 0===v?void 0:v.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n||i)return(0,c.i0)(e,{format:n?void 0:i,fieldFormat:n?h:void 0,fieldType:t,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:p,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}})}if("string"==typeof e&&(0,d.JL)(r)&&v)return function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?V(e,",",", ",t):e.includes(";")?V(e,";","; ",t):e.includes(" ")?V(e," "," ",t):(0,u.ZV)(Number(e),(0,u.yx)(t))}(e,v);if("string"==typeof(e=function(e,t){var n;const i="number"===(null===t||void 0===t||null===(n=t.fieldFormat)||void 0===n?void 0:n.type)||(null===t||void 0===t?void 0:t.format)&&null==t.format.dateFormat&&(null!=t.format.places||null!=t.format.digitSeparator);if("string"==typeof e&&i){const t=Number(e);if(!isNaN(t))return t}return e}(e,{format:I?void 0:v,fieldFormat:I?h:void 0}))||null==e||null==v&&null==h)return ee(e);const b=I?(0,u.Up)(h):v?(0,u.yx)(v):void 0;return(0,u.ZV)(e,s?(0,i.A)((0,i.A)({},b),{},{minimumFractionDigits:0,maximumFractionDigits:20}):b)}function V(e,t,n,i){return e.trim().split(t).map(e=>(0,u.ZV)(Number(e),(0,u.yx)(i))).join(n)}function W(e,t){if(null!==e&&void 0!==e&&e.length&&t)return e.find(e=>{var n;return(null===(n=e.fieldName)||void 0===n?void 0:n.toLowerCase())===t.toLowerCase()})}function $(e,t,n,r){const{creatorField:o,creationDateField:l,editorField:u,editDateField:s}=e;if(!t)return;const d=(0,y.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,n,N,"date"),f=(0,i.A)((0,i.A)({},N),d),c=t[s];if("number"==typeof c){const e=t[u];return{type:"edit",date:(0,a.Yq)(c,f),user:e}}const p=t[l];if("number"==typeof p){const e=t[o];return{type:"create",date:(0,a.Yq)(p,f),user:e}}return null}function B(e,t){const n=new Map;if(!e)return n;for(const i of e){if(!i.fieldName)continue;const e=k(i.fieldName,t);i.fieldName=e,n.set(e.toLowerCase(),i)}return n}function K(e){const t=[];if(!e)return t;const{fieldInfos:n,content:i}=e;return n&&t.push(...n),i&&Array.isArray(i)?(i.forEach(e=>{if("fields"===e.type){const n=null===e||void 0===e?void 0:e.fieldInfos;n&&t.push(...n)}}),t):t}function X(e){return e.replaceAll(F,e=>"&#".concat(e.charCodeAt(0),";"))}function ee(e){return"string"==typeof e?e.replaceAll(b,'<br class="esri-text-new-line" />'):e}function te(e){var t;const{fieldInfoMap:n,fieldInfos:i,fieldName:o,graphic:l,isContentFieldInfos:a,layer:u,timeZone:s,value:f}=e;if(null==f)return"";const p=function(e){let{fieldName:t,value:n,graphic:i,layer:o}=e;if(oe(t))return null;if(!o||"function"!=typeof o.getFieldDomain)return null;const l=i&&o.getFieldDomain(t,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return l&&"coded-value"===l.type?l.getName(n):null}({fieldName:o,value:f,graphic:l,layer:u});if(p)return p;const y=function(e){let{fieldName:t,graphic:n,layer:i}=e;if(oe(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const o=i.getFeatureType(n);return o?o.name:null}({fieldName:o,graphic:l,layer:u});if(y)return y;if(n.get(o.toLowerCase()))return P(f,{fieldInfos:i||Array.from(n.values()),fieldName:o,graphic:l,isContentFieldInfos:a,layer:u,timeZone:s});const m=null===u||void 0===u||null===(t=u.fieldsIndex)||void 0===t?void 0:t.get(o);return m&&((0,c.fs)(m)||(0,d.OH)(m))?(0,c.i0)(f,{fieldType:m.type,timeZoneOptions:{layerTimeZone:u&&"preferredTimeZone"in u?u.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!u||!("datesInUnknownTimezone"in u))&&!!u.datesInUnknownTimezone}}):ee(f)}function ne(e){let{attributes:t,fieldInfoMap:n,fieldInfos:i,graphic:r,isContentFieldInfos:o,layer:l,relatedInfos:a,timeZone:u}=e;const s={};return null!==a&&void 0!==a&&a.forEach(e=>function(e){var t,n;let{attributes:i,relatedInfo:r,fieldInfoMap:o,fieldInfos:l,layer:a,timeZone:u}=e;i&&r&&(null!==(t=r.relatedFeatures)&&void 0!==t&&t.forEach(e=>le({attributes:i,graphic:e,relatedInfo:r,fieldInfoMap:o,fieldInfos:l,layer:a,timeZone:u})),null===(n=r.relatedStatsFeatures)||void 0===n||n.forEach(e=>le({attributes:i,graphic:e,relatedInfo:r,fieldInfoMap:o,fieldInfos:l,layer:a,timeZone:u})))}({attributes:s,relatedInfo:e,fieldInfoMap:n,fieldInfos:i,layer:l,timeZone:u})),t&&Object.keys(t).forEach(e=>{const a=t[e];s[e]=te({fieldInfoMap:n,fieldInfos:i,fieldName:e,graphic:r,isContentFieldInfos:o,layer:l,timeZone:u,value:a})}),s}async function ie(e,t){var n;const{layer:i,graphic:r,outFields:o,objectIds:l,returnGeometry:a,spatialReference:u}=e,s=l[0];if("number"!=typeof s&&"string"!=typeof s){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:r,objectId:s,requiredFields:o};return m().warn(e,t),null}if(null===(n=(0,f.BR)(i))||void 0===n||null===(n=n.operations)||void 0===n||!n.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:i,graphic:r,requiredFields:o,returnGeometry:a};return m().warn(e,t),null}const d=i.createQuery();return d.objectIds=l,d.outFields=null!==o&&void 0!==o&&o.length?o:[i.objectIdField],d.returnGeometry=!!a,d.returnZ=!!a,d.returnM=!!a,d.outSpatialReference=u,(await i.queryFeatures(d,t)).features[0]}async function re(e,t){var n;let{graphic:r,popupTemplate:o,layer:l,spatialReference:a}=e;if(!l||!o)return;if("function"==typeof l.load&&await l.load(t),!r.attributes)return;const u=l.objectIdField,s=r.attributes[u];if(null==s)return;const f=[s],c=new Set(await o.getRequiredFields(l.fieldsIndex));null==(null===(n=l.timeInfo)||void 0===n?void 0:n.trackIdField)||c.has(l.timeInfo.trackIdField)||await async function(e){var t;if(null===(t=e.expressionInfos)||void 0===t||!t.length)return!1;const n=await(0,p.l)(),{arcadeUtils:{requiresTrack:i}}=n;return i(e)}(o)&&c.add(l.timeInfo.trackIdField);const y=(0,d.Kl)(r,c),m=y?[]:c.has(u)?[...c]:[...c,u],g=o.returnGeometry||await async function(e){var t;if(null===(t=e.expressionInfos)||void 0===t||!t.length)return!1;const n=await(0,p.l)(),{arcadeUtils:{hasGeometryFunctions:i}}=n;return i(e)}(o);if(y&&!g)return;const v=await ie({layer:l,graphic:r,outFields:m,objectIds:f,returnGeometry:g,spatialReference:a},t);v&&(v.geometry&&(r.geometry=v.geometry),v.attributes&&(r.attributes=(0,i.A)((0,i.A)({},r.attributes),v.attributes)))}function oe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(A)}function le(e){let{attributes:t,graphic:n,relatedInfo:i,fieldInfos:r,fieldInfoMap:o,layer:l,timeZone:a}=e;t&&n&&i&&Object.keys(n.attributes).forEach(e=>{const u=function(e){return e?"".concat(A).concat(e.layerId,"/").concat(e.fieldName):""}({layerId:i.relation.id.toString(),fieldName:e}),s=n.attributes[e];t[u]=te({fieldName:u,fieldInfos:r,fieldInfoMap:o,layer:l,value:s,graphic:n,timeZone:a})})}const ae=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ue=e=>{var t;let{layer:n,method:i,query:r,definitionExpression:o}=e;if(null===(t=n.capabilities)||void 0===t||null===(t=t.query)||void 0===t||!t.supportsCacheHint||"attachments"===i)return;const l=null!=r.where?r.where:null,a=null!=r.geometry?r.geometry:null;ae(o)||ae(l)||"extent"===(null===a||void 0===a?void 0:a.type)||"tile"===r.resultType||(r.cacheHint=!0)},se=e=>{var t;let{query:n,layer:i,method:r}=e;ue({layer:i,method:r,query:n,definitionExpression:"".concat(i.definitionExpression," ").concat(null!==(t=i.serviceDefinitionExpression)&&void 0!==t?t:"")})},de=e=>{var t;let{queryPayload:n,layer:i,method:r}=e;ue({layer:i,method:r,query:n,definitionExpression:"".concat(i.definitionExpression," ").concat(null!==(t=i.serviceDefinitionExpression)&&void 0!==t?t:"")})};function fe(e,t,n){var i,r;return e&&t&&n?"sublayer"===t.type?ye({layers:null===(i=t.layer)||void 0===i?void 0:i.allSublayers,map:e,relatedLayer:t,relationship:n})||ye({layers:null===(r=t.layer)||void 0===r?void 0:r.subtables,map:e,relatedLayer:t,relationship:n}):ye({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||ye({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function ce(e,t){var n;return e&&"utilityNetworks"in e&&t?null===(n=e.utilityNetworks)||void 0===n?void 0:n.find(e=>e.isUtilityLayer(t)):null}function pe(e,t){return null===e||void 0===e?void 0:e.allTables.find(e=>{var n;return"feature"===e.type&&e.layerId===t.id&&e.url===(null===(n=t.layer)||void 0===n?void 0:n.url)})}function ye(e){let{map:t,relationship:n,relationship:{relatedTableId:i},relatedLayer:r,layers:o}=e;if(!o)return null;for(const a of o){var l;if("map-image"===a.type){const e=ye({layers:a.sublayers,map:t,relatedLayer:r,relationship:n})||ye({layers:a.subtables,map:t,relatedLayer:r,relationship:n});if(e)return e;continue}if(!Y(a))continue;if("sublayer"===r.type){if(a!==r&&a.id===i)return a.isTable?pe(t,a):a;continue}const e="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!e)return null;if("sublayer"!==a.type){if(a!==r&&a.url===e&&a.layerId===i)return a}else if(a!==r&&(null===(l=a.layer)||void 0===l?void 0:l.url)===e&&a.id===i)return a.isTable?pe(t,a):a}return null}},42633:(e,t,n)=>{n.d(t,{EG:()=>y,Ll:()=>b,R3:()=>I,UH:()=>s,aM:()=>v,fs:()=>p,i0:()=>F});var i=n(89379),r=n(65256),o=n(53430),l=(n(63919),n(76386)),a=n(36693),u=n(67478);const s=",",d={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},f=new Set(["integer","small-integer"]);let c=null;function p(e){return(0,o.vE)(e)||(0,o.zD)(e)||(0,o.Ah)(e)}async function y(e){const{field:t,field2:n,field3:i,normalizationField:r,valueExpression:o,fields:a}=e;let u=[];if(o){if(!c){const{arcadeUtils:e}=await(0,l.l)();c=e}u=c.extractFieldNames(o)}return t&&u.push(t),n&&u.push(n),i&&u.push(i),r&&u.push(r),a&&u.push(...a),u}function m(e){return String(e).padStart(2,"0")}function g(e,t,n){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i="TIMESTAMP'".concat(n?e.getFullYear():e.getUTCFullYear(),"-").concat(m((n?e.getMonth():e.getUTCMonth())+1),"-").concat(m(n?e.getDate():e.getUTCDate())," ").concat(m(n?e.getHours():e.getUTCHours()),":").concat(m(n?e.getMinutes():e.getUTCMinutes()),":").concat(m(n?e.getSeconds():e.getUTCSeconds()),"'")):i=e,i}function v(e,t,n,i){const{hasQueryEngine:r}=e,o="(".concat(g(n,h(e,n),r)," - ").concat(g(t,h(e,t),r),")");let l=d[i],a="/";return l<1&&(l=1/l,a="*"),{sqlExpression:1===l?o:"(".concat(o," ").concat(a," ").concat(l,")"),sqlWhere:null}}function h(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const n=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,o.vE)(n))return"field"}}function I(e,t){const n=t&&e.getField(t);return!!n&&f.has(n.type)}function b(e){return"cast(".concat(e," as float)")}function F(e,t){const{format:n,fieldFormat:o,timeZoneOptions:l,fieldType:s}=null!==t&&void 0!==t?t:{},d=o?(0,r._m)(o):null;let f,c;if(l&&({timeZone:f,timeZoneName:c}=(0,u.hv)(l.layerTimeZone,l.datesInUnknownTimezone,l.viewTimeZone,d||(0,r.J2)(n||"short-date-short-time"),s)),"string"==typeof e&&isNaN(Date.parse("time-only"===s?"1970-01-01T".concat(e,"Z"):e)))return e;switch(s){case"date-only":{const t=d||(0,r.J2)(n||"short-date");return"string"==typeof e?(0,r.iS)(e,(0,i.A)({},t)):(0,r.Yq)(e,(0,i.A)((0,i.A)({},t),{},{timeZone:a.n$}))}case"time-only":{const t=d||(0,r.J2)(n||"short-time");return"string"==typeof e?(0,r.F8)(e,t):(0,r.Yq)(e,(0,i.A)((0,i.A)({},t),{},{timeZone:a.n$}))}case"timestamp-offset":{if(!f&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=n||d||l?d||(0,r.J2)(n||"short-date-short-time"):void 0,o=t?(0,i.A)((0,i.A)({},t),{},{timeZone:f,timeZoneName:c}):void 0;return"string"==typeof e?(0,r.Ey)(e,o):(0,r.Yq)(e,o)}default:{const t=n||d||l?d||(0,r.J2)(n||"short-date-short-time"):void 0;return(0,r.Yq)("string"==typeof e?new Date(e):e,t?(0,i.A)((0,i.A)({},t),{},{timeZone:f,timeZoneName:c}):void 0)}}}}}]);
//# sourceMappingURL=9912.8ddf4c75.chunk.js.map
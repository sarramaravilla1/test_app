"use strict";(self.webpackChunktest_app=self.webpackChunktest_app||[]).push([[9232],{55:(e,t,i)=>{i.d(t,{cZ:()=>S,XW:()=>D,fe:()=>N});var n=i(3825),o=i(50076),r=i(87663),s=(i(98618),i(1484)),a=i(13312);class l{constructor(){this.version="",this.queryResult=new d}}class d{constructor(){this.featureResult=new u}}class u{constructor(){this.objectIdFieldName="",this.uniqueIdField=new p,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new c,this.geometryType=null,this.spatialReference=new a.A,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new h,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class p{constructor(){this.name="",this.isSystemMaintained=!1}}class c{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class h{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new y,this.translate=new m}}class y{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class m{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class g{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class f{constructor(){this.attributes=[],this.compressedGeometry=new v,this.centroid=new v,this.aggregateGeometries=[]}}class v{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}const b=["ELEMENTUID","TYPENAME"];var _=i(57502),w=i(31830);const T={upperLeft:0,lowerLeft:1},M={sqlTypeBigInt:0,sqlTypeBinary:1,sqlTypeBit:2,sqlTypeChar:3,sqlTypeDate:4,sqlTypeDecimal:5,sqlTypeDouble:6,sqlTypeFloat:7,sqlTypeGeometry:8,sqlTypeGUID:9,sqlTypeInteger:10,sqlTypeLongNVarchar:11,sqlTypeLongVarbinary:12,sqlTypeLongVarchar:13,sqlTypeNChar:14,sqlTypeNVarChar:15,sqlTypeOther:16,sqlTypeReal:17,sqlTypeSmallInt:18,sqlTypeSqlXml:19,sqlTypeTime:20,sqlTypeTimestamp:21,sqlTypeTimestamp2:22,sqlTypeTinyInt:23,sqlTypeVarbinary:24,sqlTypeVarchar:25};var I=i(48611);function C(e){const t=new v;t.geometryType=(0,I.i7)(w.bV,e.geometry_type.value);const i=[],n=[];for(let o=0;o<e.lengths.length;o++)i.push(e.lengths[o]);for(let o=0;o<e.coords.length;o++)n.push(e.coords[o]);return t.lengths=i,t.coords=n,t}function A(e){const t=new g;return t.name=e.name,t.alias=e.alias,t.fieldType=(0,I.i7)(w.r5,e.field_type.value),t.sqlType=(0,I.i7)(M,e.sql_type.value),t.domain=e.domain,t.defaultValue=e.default_value,t}function x(e){const t=A(e);return t.geometryType=(0,I.i7)(w.bV,e.geometry_type.value),t}function E(e){const t=new h;t.quantizeOriginPosition=(0,I.i7)(T,e.quantizeOriginPosition.value);const i=t.scale,n=e.scale;i.xScale=n.xScale,i.yScale=n.yScale,i.mScale=n.mScale,i.zScale=n.zScale;const o=t.translate,r=e.translate;return o.xTranslate=r.xTranslate,o.yTranslate=r.yTranslate,o.mTranslate=r.mTranslate,o.zTranslate=r.zTranslate,t}async function S(e,t){null!==t&&void 0!==t||(t=!1);const i={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,n.A)(e,{responseType:"array-buffer"}),i=await t.data;return async function(e){const t=new((await(0,_.I)()).MapOfObjectIdentifierSetsDecoder),i=t.decode(new Uint8Array(e)),n=new Map;if(0!==i.error_code)throw new o.A("knowledge-graph:layer-support-utils",i.error_message);const r=t.get_map_of_identifier_sets(),s=r.keys,a=s.size();for(let l=0;l<a;l++){const e=s.get(l),t=r.query_identifier_set(e),i=[];if(1===t.id_array_type.value){const e=t.get_globalid_array(),n=e.count();for(let t=0;t<n;t++)i.push(e.get_globalid_at(t))}else if(3===t.id_array_type.value){const e=t.get_identifier_array(),n=e.count();for(let t=0;t<n;t++)i.push(e.get_identifier_at(t).toString())}else if(2===t.id_array_type.value){const e=t.get_string_array(),n=e.count();for(let t=0;t<n;t++)i.push(e.get_string_at(t))}else{if(0!==t.id_array_type.value)throw new o.A("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=t.get_oid_array(),n=e.count();for(let t=0;t<n;t++)i.push(e.get_objectid_at(t).toString())}}n.set(e,i)}return t.delete(),n}(new Uint8Array(i))}(e).then(e=>{!function(e,t){for(const[i,n]of e){const e=(0,r.tE)(t.namedTypeDefinitions,i,()=>({useAllData:!1,members:new Map}));for(const t of n)e.members.has(t)||e.members.set(t,{id:t})}}(e,i)}),i}async function N(e){const t=await(0,_.I)(),i=new t.MapOfObjectIdentifierSets;!function(e,t,i){for(const[n,o]of i.namedTypeDefinitions){if(!o.members||o.useAllData)continue;const i=o.members.keys();let r=!1,s=!0;const a=new t.ObjectIdArray,l=new t.StringArray,d=new t.GlobalIdArray,u=new t.IdentifierArray,p=new t.ObjectIdentifierSet;for(const e of i)s&&(r=!isNaN(Number(e)),s=!1),r?a.add_objectid(Number(e)):(l.add_string(e),d.add_globalid(e)),u.add_identifier(e);p.set_oid_array(a),p.set_string_array(l),p.set_globalid_array(d),p.set_identifier_array(u),a.delete(),l.delete(),d.delete(),u.delete(),e.put_identifier_set(n,p),p.delete()}}(i,t,e);const n=new t.MapOfObjectIdentifierSetsEncoder;try{n.set_map_of_identifier_sets(i),n.encode();const e=n.get_encoding_result();if(0!==e.error.error_code)throw new o.A("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return n.delete(),t}finally{i.delete()}}async function L(e){const t=await(0,n.A)(e,{responseType:"array-buffer"});return async function(e){const t=new((await(0,_.I)()).FeatureCollectionDecoder),i=t.decode(new Uint8Array(e));if(0!==i.error_code)throw new o.A("knowledge-graph:layer-support-utils",i.error_message);const n=t.get_feature_collection(),r=function(e){const t=new l;t.version=e.version;const i=e.get_query_result();if(0!==i.results_type.value)throw new Error("Got a non-feature collection type");const n=i.get_feature_result(),o=t.queryResult.featureResult;o.objectIdFieldName=n.objectid_field_name,o.exceededTransferLimit=n.exceeded_transfer_limit,o.hasM=n.has_m,o.hasZ=n.has_z,o.geometryType=(0,I.i7)(w.bV,n.geometry_type.value),o.globalIdFieldName=n.globalid_field_name,o.geohashFieldName=n.geohash_field_name;const r=o.uniqueIdField,s=n.unique_id_field;r.name=s.name,r.isSystemMaintained=s.isSystemMaintained;const a=o.geometryProperties,d=n.geometry_properties;a.shapeAreaFieldName=d.shapeAreaFieldName,a.shapeLengthFieldName=d.shapeLengthFieldName,a.units=d.units;const u=o.spatialReference,p=n.spatial_reference;u.wkid=p.wkid,u.latestWkid=p.latestWkid,u.vcsWkid=p.vcsWkid,u.latestVcsWkid=p.latestVcsWkid,u.wkt=p.wkt,o.transform=E(n.transform);const c=o.fields,h=o.fieldNameToAttributeIndexMap,y=n.fields,m=y.size();for(let l=0;l<m;l++){const e=y.get(l),t=A(e);c.push(t),h[t.name]=l,e.delete()}y.delete();const g=o.values,v=n.values_count();for(let l=0;l<v;l++)g.push(n.get_value_at(l));const _=o.features,T=n.features,M=T.size();if(M>0)for(const l of b)if(void 0===h[l])throw new Error("Feature collection missing required attribute: ".concat(l));for(let l=0;l<M;l++){const e=new f,t=T.get(l),i=e.attributes,n=t.attributes_count();for(let l=0;l<n;l++)i.push(t.get_attribute_at(l));const o=t.get_compressed_geometry();o&&(e.compressedGeometry=C(o),e.centroid=C(t.get_centroid()));const r=e.aggregateGeometries,s=t.aggregate_geometries,a=s.size();for(let l=0;l<a;l++){const e=s.get(l),t=C(e);r.push(t),e.delete()}s.delete(),_.push(e),t.delete()}T.delete();const S=o.geometryFields,N=n.geometry_fields,L=N.size();for(let l=0;l<L;l++){const e=N.get(l),t=x(e);S.push(t),e.delete()}return N.delete(),t}(n);return t.delete(),r}(await t.data)}function k(e,t){var i;if(null===e||void 0===e||null===(i=e.queryResult)||void 0===i||!i.featureResult)return t;const n=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const a of e.queryResult.featureResult.features){var o;const e=a.attributes[n.TYPENAME],i=(0,r.tE)(t.namedTypeDefinitions,e,()=>({useAllData:!1,members:new Map})),l=a.attributes[n.ELEMENTUID];if((null===(o=a.compressedGeometry)||void 0===o||null===(o=o.coords)||void 0===o?void 0:o.length)>0){let e=a.compressedGeometry.lengths;"esriGeometryPoint"===a.compressedGeometry.geometryType&&(e=[]),i.members.set(l,{id:l,linkChartLocation:new s.A(e,a.compressedGeometry.coords)})}else i.members.set(l,{id:l})}return t}const D={fetchAndConvertSerializedLinkChart:e=>async function(e){const t=[],i={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(L(e.entitiesUrl).then(e=>{k(e,i)})),e.relationshipsUrl&&t.push(L(e.relationshipsUrl).then(e=>{k(e,i)})),await Promise.all(t),i}(e)}},536:(e,t,i)=>{i.d(t,{A:()=>ge});var n=i(89379),o=i(53986),r=i(6326),s=i(16868),a=i(50076),l=i(53084),d=i(76460),u=i(77717),p=(i(16783),i(46053)),c=(i(81806),i(87990)),h=i(17707),y=i(76797),m=i(19247),g=i(65215),f=i(23701),v=i(56611),b=i(13312),_=i(80963),w=i(31608),T=i(74398),M=i(61024),I=i(57274),C=i(9465);const A=Symbol("isKnowledgeGraphGraphicOriginSymbol");var x;class E extends C.A{get[(x=A,M.ym)](){return this.sublayer}get[T.e](){return this.sublayer}get[I.Q](){return this.sublayer}constructor(e,t){super(),this[x]=!0,this.type="knowledge-graph",this.layer=e,this.sublayer=t}get id(){return this.layer.id}}const S=Symbol("isLinkChartGraphicOriginSymbol");var N;class L extends C.A{get[(N=S,I.Q)](){return this.layer}constructor(e,t){super(),this[N]=!0,this.type="link-chart",this.layer=e,this.sublayer=t}get id(){return"".concat(this.layer.id,":__").concat(this.sublayer.id,"__")}}var k=i(25515),D=i(72547),F=i(12034),R=i(40296),B=i(21009);i(47249);const O=(0,i(76350).p)(),j=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,r.Cg)([(0,p.MZ)(O.fields)],i.prototype,"fields",void 0),(0,r.Cg)([(0,p.MZ)(O.fieldsIndex)],i.prototype,"fieldsIndex",void 0),i=(0,r.Cg)([(0,c.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],i),i};var Z=i(61064),G=i(65624),P=i(30218),q=i(74440),U=i(37207),Q=i(37534),z=i(21617),Y=i(5682),H=i(78817),W=i(95363),X=i(54490),V=i(44135),J=i(53430),$=i(95114),K=i(27937),ee=i(83982),te=i(5766),ie=i(86616),ne=i(34373),oe=i(6560),re=i(77725),se=i(97015),ae=i(30973),le=i(94439),de=i(59989);const ue=["target","writer","overridePolicy"];function pe(e){if(!e.json)return e;e.json.write=ce(e.json.write);const t=e.json.origins;if(!t)return e;let i;for(i in t){const e=t[i];e&&(e.write=ce(e.write))}return e}function ce(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:i,overridePolicy:r}=e,s=(0,o.A)(e,ue);return function(e,t){const i=ye.call(this,e,t);return i.enabled?(0,n.A)((0,n.A)({},s),i):i}}(e)),e):!0===e?he():e}function he(){return{overridePolicy:ye}}function ye(e,t){const i=!!this.geometryType;let o={enabled:i};return i&&(o=(0,n.A)((0,n.A)({},o),me.call(this,e,t))),o}function me(e,t){return{ignoreOrigin:this.originIdOf(t)>0}}let ge=class extends(j((0,P.FJ)((0,U.J)((0,q.F)((0,G.dM)((0,Q.fY)((0,H.e)((0,Y.j)((0,z.J)((0,u.P)(k.A))))))))))){constructor(e){var t;super(e),t=this,this.blendMode="normal",this.charts=null,this.definitionExpression=null,this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=B.dr,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{const e=new MessageChannel;return new de.A(e.port1,{channel:e,client:{queryFeatures:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=se.A.fromJSON(e);return t.queryFeaturesJSON(n,i)}}}),[e.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get capabilities(){return this.parent?this.parent.sublayerCapabilities:(0,Z.hZ)(null)}get userHasUpdateItemPrivileges(){var e;return!(null===(e=this.parent)||void 0===e||!e.userHasUpdateItemPrivileges)}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.capabilities.operations.supportsEditing}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get isTable(){return"link-chart"!==this.parentCompositeLayer.type&&null==this.geometryFieldName}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){var e;const t=[];return null!==(e=this.objectType)&&void 0!==e&&null!==(e=e.properties)&&void 0!==e&&e.forEach(e=>{const i="esriFieldTypeOID"===e.fieldType?"esriFieldTypeInteger":e.fieldType;t.push(V.A.fromJSON({name:e.name,type:i,alias:e.alias,defaultValue:e.defaultValue,editable:e.editable,nullable:e.nullable}))}),t.push(V.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),V.A.fromJSON({name:B.M1,type:"esriFieldTypeInteger",alias:B.M1,editable:!1}),V.A.fromJSON({name:B.BL,type:"esriFieldTypeInteger",alias:B.BL,editable:!1})),t}get formTemplate(){return this._isOverridden("formTemplate")?this._get("formTemplate"):(0,Z.dD)(this)}set formTemplate(e){this._overrideIfSome("formTemplate",e)}get geometryType(){var e,t,i;if("link-chart"===(null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.type))return"relationship"===this.graphType?"polyline":"point";const n=null===(t=this.parentCompositeLayer)||void 0===t?void 0:t.dataManager.geographicLookup.get(null===(i=this.objectType)||void 0===i?void 0:i.name),o=null===n||void 0===n?void 0:n.geometryType;return o&&"esriGeometryNull"!==o?w.gy.fromJSON(o):null}get geometryFieldName(){var e,t,i,n;if("link-chart"===(null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.type))return B.T1;const o=null===(t=this.parentCompositeLayer)||void 0===t?void 0:t.dataManager.geographicLookup.get(null===(i=this.objectType)||void 0===i?void 0:i.name);return null!==(n=null===o||void 0===o?void 0:o.name)&&void 0!==n?n:null}get graphicOrigin(){if(!this.parent)return null;switch(this.parent.type){case"knowledge-graph":return new E(this.parent,this);case"link-chart":return new L(this.parent,this)}}get graphTypeName(){var e;return null===(e=this.objectType)||void 0===e?void 0:e.name}set graphTypeName(e){this._set("graphTypeName",e)}get hasM(){var e,t,i,n;const o=null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.dataManager.geographicLookup.get(null===(t=this.objectType)||void 0===t?void 0:t.name),r=null===o||void 0===o?void 0:o.name,s=r?null===(i=this.objectType)||void 0===i||null===(i=i.properties)||void 0===i?void 0:i[r]:null;return null!==(n=null===s||void 0===s?void 0:s.hasM)&&void 0!==n&&n}get hasZ(){var e,t,i,n;const o=null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.dataManager.geographicLookup.get(null===(t=this.objectType)||void 0===t?void 0:t.name),r=null===o||void 0===o?void 0:o.name,s=r?null===(i=this.objectType)||void 0===i||null===(i=i.properties)||void 0===i?void 0:i[r]:null;return null!==(n=null===s||void 0===s?void 0:s.hasZ)&&void 0!==n&&n}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");if(!this.objectType||!this.parentCompositeLayer||!this.graphTypeName)return null;const e=this.objectType.properties?(0,Z.MY)(this.objectType.properties):"ESRI__ID";return"link-chart"===this.parentCompositeLayer.type?(0,Z.iW)(this.graphType,this.graphTypeName,e):(0,Z.e$)(this.graphTypeName,this.geometryType,e)}set renderer(e){(0,J.yp)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){var e,t,i,n;if(this._isOverridden("renderer"))return this._get("renderer");const o=null===(e=this.parentCompositeLayer)||void 0===e||null===(e=e.dataManager)||void 0===e||null===(e=e.knowledgeGraph)||void 0===e?void 0:e.dataModel,r=[...null!==(t=null===o||void 0===o?void 0:o.entityTypes)&&void 0!==t?t:[],...null!==(i=null===o||void 0===o?void 0:o.relationshipTypes)&&void 0!==i?i:[]].map(e=>e.name).indexOf(this.graphTypeName),s=(0,Z.Td)(r);if("link-chart"===(null===(n=this.parentCompositeLayer)||void 0===n?void 0:n.type)){if("relationship"===this.graphType)return new te.A({type:"simple",symbol:(0,Z.UT)(s)});const e=(0,ie.r)((0,R.F0)(w.gy.toJSON("point")).renderer);return(0,le.dt)(e.symbol,s),e}const a=(0,ie.r)((0,R.F0)(w.gy.toJSON(this.geometryType)).renderer);return(0,le.dt)(a.symbol,s),a}get spatialReference(){var e,t;return null!==(e=null===(t=this.parentCompositeLayer)||void 0===t||null===(t=t.dataManager)||void 0===t||null===(t=t.knowledgeGraph)||void 0===t||null===(t=t.dataModel)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:b.A.WGS84}get templates(){return this._isOverridden("templates")?this._get("templates"):(0,Z.CP)(this)}set templates(e){this._overrideIfSome("templates",e)}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=null!==e&&void 0!==e?e:"Layer"}createPopupTemplate(e){return(0,ae.tn)(this,e)}createQuery(){return new se.A({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e),o=this.graphicOrigin,r=re.A.fromJSON(await n.executeQuery(i.toJSON(),null===t||void 0===t?void 0:t.signal));return r.features.forEach(e=>{e.sourceLayer=this,e.origin=o}),r}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(i.toJSON(),null===t||void 0===t?void 0:t.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(i.toJSON(),null===t||void 0===t?void 0:t.signal)}async queryExtent(){var e,t,i,o;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;await this.load();const a=(0,n.A)((0,n.A)({},r),{},{returnGeometry:!0}),{resolvedQuery:l,queryEngine:d}=await this._setupQueryObjects(a),u=await d.executeQueryForExtent(l.toJSON(),null===s||void 0===s?void 0:s.signal);let p;return p=null!=(null===(e=u.extent)||void 0===e?void 0:e.xmin)&&null!=(null===(t=u.extent)||void 0===t?void 0:t.xmax)&&null!=(null===(i=u.extent)||void 0===i?void 0:i.ymin)&&null!=(null===(o=u.extent)||void 0===o?void 0:o.ymax)?new y.A(u.extent):new y.A,{count:u.count,extent:p}}async queryObjectIds(e,t){await this.load();const i=se.A.from(e);let n;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(i,this,t);n=this.loadQueryEngine(e)}return await n.executeQueryForIds(i.toJSON(),null===t||void 0===t?void 0:t.signal)}async applyEdits(e){var t;if(!this.parentCompositeLayer.dataManager.knowledgeGraph)throw new a.A("knowledge-graph-sublayer:no-knowledge-graph","ApplyEdits cannot be executed because the parent does not have a Knowledge Graph model.  This is usually caused by the layer not yet being loaded");const i=await(0,Z.O9)(e,this);i.options={cascadeDelete:!0,cascadeProvenanceDelete:!(null===(t=this.parent)||void 0===t||!t.knowledgeGraph.serviceDefinition.supportsProvenance)||void 0};const n=await(0,oe.executeApplyEdits)(this.parentCompositeLayer.dataManager.knowledgeGraph,i),o=(0,Z.Gz)(n,this.graphTypeName),r={addedFeatures:o.addFeatureResults,updatedFeatures:o.updateFeatureResults,deletedFeatures:o.deleteFeatureResults,addedAttachments:o.addAttachmentResults,deletedAttachments:o.deleteAttachmentResults,updatedAttachments:o.updateAttachmentResults,exceededTransferLimit:!1,historicMoment:new Date,edits:void 0};return this.emit("edits",r),this.emit("apply-edits",{result:Promise.resolve(r)}),"link-chart"===this.parentCompositeLayer.type&&await this.parentCompositeLayer.refreshLinkChartCache([...r.addedFeatures.map(e=>e.globalId),...r.updatedFeatures.map(e=>e.globalId),...r.deletedFeatures.map(e=>e.globalId)]),o}loadQueryEngine(e){var t;const i=new D.A({geometryType:w.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new F.do({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:w.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,featureIdInfo:{type:"object-id",fieldName:this.objectIdField},spatialReference:this.spatialReference.toJSON(),timeInfo:null===(t=this.timeInfo)||void 0===t?void 0:t.toJSON(),featureStore:i});return n.featureStore.addMany(e),n}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new se.A({where:"1=1",outFields:[B.dr]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>(0,J.sv)(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}async _setupQueryObjects(e,t){var i;const n=se.A.from(e),o=n.geometry;if(o&&!(null!==(i=o.spatialReference)&&void 0!==i&&i.isWGS84)&&(await(0,v.initializeProjection)(o.spatialReference,_.KK),n.geometry=(0,v.project)(o instanceof g.A||o instanceof f.A||o instanceof m.A?o:o.extent,_.KK)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)return{resolvedQuery:n,queryEngine:this._cachedQueryEngine};const r=await this.parentCompositeLayer.dataManager.getData(n,this,t);return{resolvedQuery:n,queryEngine:this.loadQueryEngine(r)}}};(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(G.sU)))],ge.prototype,"blendMode",void 0),(0,r.Cg)([(0,p.MZ)({readOnly:!0})],ge.prototype,"capabilities",null),(0,r.Cg)([(0,p.MZ)({readOnly:!0})],ge.prototype,"userHasUpdateItemPrivileges",null),(0,r.Cg)([(0,p.MZ)({type:Boolean})],ge.prototype,"editingEnabled",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"isTable",null),(0,r.Cg)([(0,p.MZ)({json:{origins:{"web-scene":{write:!1}},write:he()}})],ge.prototype,"charts",void 0),(0,r.Cg)([(0,p.MZ)({readOnly:!0})],ge.prototype,"defaultPopupTemplate",null),(0,r.Cg)([(0,p.MZ)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],ge.prototype,"definitionExpression",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(P.Dp)))],ge.prototype,"displayFilterEnabled",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(P.KV)))],ge.prototype,"displayFilterInfo",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(G.LF)))],ge.prototype,"effect",void 0),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"elevationInfo",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(q.Y)))],ge.prototype,"featureEffect",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(X.d)))],ge.prototype,"featureReduction",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"fields",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"formTemplate",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"geometryType",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"geometryFieldName",null),(0,r.Cg)([(0,p.MZ)({readOnly:!0})],ge.prototype,"graphicOrigin",null),(0,r.Cg)([(0,p.MZ)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],ge.prototype,"graphType",void 0),(0,r.Cg)([(0,p.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],ge.prototype,"graphTypeName",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"hasM",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"hasZ",null),(0,r.Cg)([(0,p.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],ge.prototype,"id",void 0),(0,r.Cg)([(0,p.MZ)({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],ge.prototype,"labelsVisible",void 0),(0,r.Cg)([(0,p.MZ)({type:[$.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:function(e,t,i){const n=[["ESRI__AGGREGATION_COUNT",B.M1],["ESRI__ORIGIN_ID",B.Cz],["ESRI__DESTINATION_ID",B.KQ],["ESRI__LAYOUT_GEOMETRY",B.T1]];try{for(const t of e)for(const[e,i]of n){var o,r;t.labelExpression=null===(o=t.labelExpression)||void 0===o?void 0:o.replaceAll(e,i),(null===(r=t.labelExpressionInfo)||void 0===r?void 0:r.expression)&&(t.labelExpressionInfo.expression=t.labelExpressionInfo.expression.replaceAll(e,i))}}catch(L){d.A.getLogger(this).warn("Error updating labelingInfo",L)}return(0,K.w)(e,t,i)},write:he()}})],ge.prototype,"labelingInfo",null),(0,r.Cg)([(0,p.MZ)({readOnly:!0,json:{read:!1,write:{writer(e,t){var i;switch(null===(i=this.parentCompositeLayer)||void 0===i?void 0:i.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],ge.prototype,"layerType",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(W.fV)))],ge.prototype,"legendEnabled",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(W.hG)))],ge.prototype,"maxScale",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(W.hn)))],ge.prototype,"minScale",void 0),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"objectIdField",void 0),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"objectType",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(W.ke)))],ge.prototype,"opacity",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(Q.ne)))],ge.prototype,"orderBy",void 0),(0,r.Cg)([(0,p.MZ)({clonable:!1})],ge.prototype,"parent",void 0),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"parentCompositeLayer",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(W.M6)))],ge.prototype,"popupEnabled",void 0),(0,r.Cg)([(0,p.MZ)({type:s.A,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],ge.prototype,"popupTemplate",void 0),(0,r.Cg)([(0,p.MZ)({type:Number,json:{write:{overridePolicy:me}}})],ge.prototype,"refreshInterval",void 0),(0,r.Cg)([(0,p.MZ)({types:ne.Hg,json:{name:"layerDefinition.drawingInfo.renderer",write:he()}})],ge.prototype,"renderer",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"source",void 0),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"spatialReference",null),(0,r.Cg)([(0,p.MZ)()],ge.prototype,"templates",null),(0,r.Cg)([(0,p.MZ)({type:ee.A,json:{name:"layerDefinition.timeInfo",write:{overridePolicy:me},origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:me}},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:me}}}}})],ge.prototype,"timeInfo",null),(0,r.Cg)([(0,p.MZ)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],ge.prototype,"title",null),(0,r.Cg)([(0,h.K)("title")],ge.prototype,"writeTitle",null),(0,r.Cg)([(0,p.MZ)({json:{read:!1}})],ge.prototype,"type",void 0),(0,r.Cg)([(0,p.MZ)(pe((0,l.o8)(H.B)))],ge.prototype,"useViewTime",void 0),(0,r.Cg)([(0,p.MZ)({type:Boolean,json:{name:"visibility",write:he()}})],ge.prototype,"visible",void 0),ge=(0,r.Cg)([(0,c.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],ge)},8893:(e,t,i)=>{i.d(t,{k5:()=>u,aq:()=>d,Wq:()=>p});i(39356);var n=i(50076),o=(i(19247),i(65215),i(23701),i(63733),i(33750),i(85646),i(45802));(0,o.O)()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),(0,o.O)()({absoluteValue:"absolute-value",multiplier:"multiplier"});const r=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);var s=i(6560),a=i(35380);i(89465),i(86875),i(86659);function l(e,t){var i;const n=new Map;if(null!==(i=t.dataModel)&&void 0!==i&&i.relationshipTypes)for(const r of t.dataModel.relationshipTypes)r.name&&n.set(r.name,[]);for(const r of e){var o;n.has(r.typeName)&&(null===(o=n.get(r.typeName))||void 0===o||o.push(r.id))}return n}async function d(e,t,i){const n=[],o=l(e,t),r={},d=[];for(const[s,a]of o){if(a.length<1)continue;const e="".concat(s,"_ids");r[e]=a,d.push("MATCH (n)-[r:".concat(s,"]->(m) WHERE id(r) in $").concat(e," RETURN id(n), labels(n)[0], id(m), labels(m)[0]"))}if(0===d.length)return[];const u=d.join(" UNION "),p=new a.A({openCypherQuery:u,bindParameters:r}),c=(await(0,s.executeQueryStreaming)(t,p,null===i||void 0===i?void 0:i.requestOptions)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await c.read();if(e)break;for(const i of t)n.push({id:i[0],typeName:i[1]}),n.push({id:i[2],typeName:i[3]})}return n}const u=e=>{var t;return null!==(t=r.get(e))&&void 0!==t?t:"radial-root-centric"};function p(e){if(!e.spatialReference.isWGS84)throw new n.A("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}},9505:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(6326),o=i(46053),r=(i(81806),i(76460),i(47249),i(87990)),s=i(19247),a=i(27544);let l=class extends a.A{constructor(e){super(e),this.layoutGeometry=null}};(0,n.Cg)([(0,o.MZ)({type:s.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n.Cg)([(0,r.$)("esri.rest.knowledgeGraph.Entity")],l)},12831:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(6326),o=i(42553),r=i(46053),s=(i(81806),i(76460),i(47249),i(87990));let a=class extends o.o{constructor(e){super(e),this.properties=null}};(0,n.Cg)([(0,r.MZ)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,n.Cg)([(0,s.$)("esri.rest.knowledgeGraph.GraphObject")],a)},21009:(e,t,i)=>{i.d(t,{BL:()=>l,Cz:()=>o,KQ:()=>r,M1:()=>a,T1:()=>s,dr:()=>n});const n="ESRI__ID",o="ESRI__OriginID",r="ESRI__DestID",s="ESRI__LayoutGeometry",a="ESRI__AggregationCount",l="LC.ESRI__IsSpatial"},23908:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(6326),o=i(46053),r=(i(81806),i(76460),i(47249),i(87990)),s=i(23701),a=i(27544);let l=class extends a.A{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n.Cg)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,n.Cg)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,n.Cg)([(0,o.MZ)({type:s.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n.Cg)([(0,r.$)("esri.rest.knowledgeGraph.Relationship")],l)},27544:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(6326),o=i(46053),r=(i(81806),i(76460),i(47249),i(87990)),s=i(12831);let a=class extends s.A{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n.Cg)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,n.Cg)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,n.Cg)([(0,r.$)("esri.rest.knowledgeGraph.GraphNamedObject")],a)},33328:(e,t,i)=>{i.d(t,{F:()=>l});var n=i(81806),o=i(70373),r=i(2413);const s={minX:0,minY:0,maxX:0,maxY:0};function a(e,t,i){(function(e){s.minX=e[0],s.minY=e[1],s.maxX=e[2],s.maxY=e[3]})(t),e.search(s,i)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new o.wq(9,(0,n.A)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach((i,n)=>{e[t++]=n}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,r.Ie)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),a(this._index,e,e=>t(this._idByBounds.get(e)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},33376:(e,t,i)=>{i.d(t,{T:()=>o});var n=i(20176);const o={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new n.Om(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},33750:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(19902),o=i(98618),r=i(20176),s=i(21009);class a{constructor(){this._featureLookup=new Map}static getInstance(){return a.instance||(a.instance=new a),a.instance}static resetInstance(){a.instance&&(a.instance=null)}deleteFromStore(e){e.forEach(e=>{this._featureLookup.delete(e)})}readFromStoreByList(e){const t=[];return e.forEach(e=>{const i=this.readFromStoreById(e);i&&t.push(i)}),t}readFromStoreById(e){var t;return null!==(t=this._featureLookup.get(e))&&void 0!==t?t:null}writeToStore(e,t,i){const a=[];return e.forEach(e=>{if(null===e||void 0===e||!e.id)return;e.properties||(e.properties=[]);let l,d=null;if(i&&e.properties[i]&&(d=(0,o.Ux)(e.properties[i])),"originId"in e&&"destinationId"in e&&(e.properties[s.Cz]=e.originId,e.properties[s.KQ]=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const o=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(o.attributes,e.properties)));i&&e.properties[i]&&(s[i]=(0,n.rS)(e.properties[i])),l=new r.Om(d?JSON.parse(JSON.stringify(d)):null!==o&&void 0!==o&&o.geometry?JSON.parse(JSON.stringify(o.geometry)):null,s,null,e.properties[t])}else l=new r.Om(d?JSON.parse(JSON.stringify(d)):null,e.properties,null,e.properties[t]);this._featureLookup.set("".concat(e.typeName?"".concat(e.typeName,"__").concat(e.id):e.id),l),a.push(l)}),a}}},35380:(e,t,i)=>{i.d(t,{A:()=>d});var n=i(6326),o=i(46053),r=(i(81806),i(76460),i(47249),i(87990)),s=i(13312),a=i(91967);let l=class extends a.A{constructor(e){super(e),this.openCypherQuery=""}};(0,n.Cg)([(0,o.MZ)()],l.prototype,"openCypherQuery",void 0),l=(0,n.Cg)([(0,r.$)("esri.rest.knowledgeGraph.GraphQuery")],l);let d=class extends l{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,n.Cg)([(0,o.MZ)()],d.prototype,"bindParameters",void 0),(0,n.Cg)([(0,o.MZ)()],d.prototype,"bindGeometryQuantizationParameters",void 0),(0,n.Cg)([(0,o.MZ)()],d.prototype,"outputQuantizationParameters",void 0),(0,n.Cg)([(0,o.MZ)({type:s.A})],d.prototype,"outputSpatialReference",void 0),(0,n.Cg)([(0,o.MZ)()],d.prototype,"provenanceBehavior",void 0),d=(0,n.Cg)([(0,r.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],d)},38156:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(6326),o=(i(76460),i(81806),i(47249),i(50076),i(87990)),r=i(12831);let s=class extends r.A{constructor(e){super(e)}};s=(0,n.Cg)([(0,o.$)("esri.rest.knowledgeGraph.ObjectValue")],s)},40296:(e,t,i)=>{i.d(t,{F0:()=>l,Vx:()=>p,e2:()=>h,f:()=>y});var n=i(89379),o=i(81806),r=i(53084),s=i(8298),a=i(44460);function l(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?a.Cb:"esriGeometryPolyline"===e?a.yM:a.WR}}}const d=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let u=1;function p(e,t){if((0,o.A)("esri-csp-restrictions"))return()=>(0,n.A)({[t]:null},e);try{let i="this".concat(c(t)," = null;");for(const t in e)i+="this".concat(c(t)," = ").concat(JSON.stringify(e[t]),";");const n=new Function("\n      return class AttributesClass$".concat(u++," {\n        constructor() {\n          ").concat(i,";\n        }\n      }\n    "))();return()=>new n}catch(i){return()=>(0,n.A)({[t]:null},e)}}function c(e){return d.test(e)?".".concat(e):'["'.concat(e,'"]')}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,r.o8)(e)}}]}function y(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:s.P,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},45495:(e,t,i)=>{i.d(t,{P:()=>M});var n=i(6326),o=i(91967),r=i(50076),s=i(76460),a=i(87663),l=i(50346),d=i(34154),u=i(46053),p=(i(81806),i(47249),i(87990)),c=i(76797),h=i(65215),y=i(56611),m=i(80963),g=i(21009);const f=(e,t)=>{if("column-reference"===e.type)return e.column===t.systemOidFieldName?"ID(n)":"n.".concat(e.column);if("string"===e.type)return"'".concat(e.value,"'");if("number"===e.type)return"".concat(e.value);if("binary-expression"===e.type&&t.supportedSqlTypes.has(e.left.type)&&t.supportedSqlTypes.has(e.right.type)&&t.supportedSqlOperators.has(e.operator))return"".concat(f(e.left,t)," ").concat(e.operator," ").concat(f(e.right,t));if("binary-expression"===e.type&&"LIKE"===e.operator){let i="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)i+="lower(n.".concat(e.left.args.value[0].column,")");else{if("column-reference"!==e.left.type)return t.unsupportedOperationFound=!0,"";i+="lower(n.".concat(e.left.column,")")}if(i+=" CONTAINS (","string"!==e.right.type)return t.unsupportedOperationFound=!0,"";{let t=e.right.value;t.startsWith("%")&&(t=t.slice(1)),t.endsWith("%")&&(t=t.slice(0,-1)),i+="'".concat(t.toLowerCase(),"')")}return i}return t.unsupportedOperationFound=!0,""};var v=i(33750),b=i(8893),_=i(6560),w=i(35380),T=i(97015);let M=class extends o.A{constructor(e){var t,i,n;super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const o=new Map;null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach(t=>{var i,n;t.name&&(o.set(t.name,"entity"),this._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(i=e.inclusionModeDefinition)&&void 0!==i&&i.generateAllSublayers)||this.entityTypeNames.add(t.name),null===(n=t.properties)||void 0===n||n.forEach(e=>{var i;e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(t.name,{name:null!==(i=e.name)&&void 0!==i?i:"",geometryType:e.geometryType})}))}),null!==(i=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==i&&i.forEach(t=>{var i,n;t.name&&(o.set(t.name,"relationship"),this._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(i=e.inclusionModeDefinition)&&void 0!==i&&i.generateAllSublayers)||this.relationshipTypeNames.add(t.name),null===(n=t.properties)||void 0===n||n.forEach(e=>{var i;e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(t.name,{name:null!==(i=e.name)&&void 0!==i?i:"",geometryType:e.geometryType})}))}),null===(n=e.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.forEach((t,i)=>{var n;if("entity"===o.get(i))this.entityTypeNames.add(i);else{var r;if("relationship"!==o.get(i))return s.A.getLogger(this).warn("A named type, ".concat(i,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(r=e.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.delete(i));this.relationshipTypeNames.add(i)}const l=new Map;null!==(n=t.members)&&void 0!==n&&n.forEach(e=>{(0,a.tE)(this.memberIdTypeLookup,e.id,()=>new Set).add(i)}),this.sublayerCaches.set(i,l)})}addToLayer(e){e.forEach(e=>{let{typeName:t,id:i}=e;if(!this.inclusionModeDefinition)throw new r.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const e=this.inclusionModeDefinition.namedTypeDefinitions.get(t);e.members||(e.members=new Map),e.members.set(i,{id:i}),(0,a.tE)(this.memberIdTypeLookup,i,()=>new Set).add(t)}}else{const e=new Map;e.set(i,{id:i}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:e}),(0,a.tE)(this.memberIdTypeLookup,i,()=>new Set).add(t)}})}getById(e){return v.A.getInstance().readFromStoreById(e)}async getData(e,t,i){var n;if(t.objectType.name&&null!==(n=this.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let o;if(o=e||new T.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){var r,s,a;const e=t.parentCompositeLayer,i=this._processingCacheUpdatesLookup.get(null!==(r=t.objectType.name)&&void 0!==r?r:""),n=o.outFields;n&&1===n.length&&n[0]===g.dr&&"1=1"===o.where||await Promise.all(null!==i&&void 0!==i?i:[]);const l=this.sublayerCaches.has(null!==(s=t.objectType.name)&&void 0!==s?s:"")?Array.from(null===(a=this.sublayerCaches.get(t.objectType.name))||void 0===a?void 0:a.values()):[],d=[];return l.forEach(i=>{if(this.relationshipTypeNames.has(t.objectType.name)){i.geometry=e.relationshipLinkChartDiagramLookup.get(i.attributes[t.objectIdField]);const n=this.memberIdTypeLookup.get(i.attributes[g.Cz]),o=this.memberIdTypeLookup.get(i.attributes[g.KQ]),r=this._isEndEntitySpatial(n,i,g.Cz),s=this._isEndEntitySpatial(o,i,g.KQ);i.attributes[g.BL]=Number(r&&s)}else{i.geometry=e.entityLinkChartDiagramLookup.get(i.attributes[t.objectIdField]);const n=this.geographicLookup.get(t.objectType.name);n&&i.attributes[n.name]?i.attributes[g.BL]=1:i.attributes[g.BL]=0}i.attributes[g.T1]=i.geometry,d.push(i)}),d}return this.retrieveDataFromService(o,t,i)}async getConnectedRecordIds(e,t,i){const n=[];let o="";const r=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==(null===t||void 0===t?void 0:t.length)){for(const e of t)o=o+e+"|";o=o.slice(0,-1)}const s={},a=[];for(const[u,p]of r){const e="".concat(u,"_ids");s[e]=p,t&&0!==(null===t||void 0===t?void 0:t.length)?a.push("MATCH (n:".concat(u,") WHERE id(n) IN $").concat(e," WITH n MATCH (n)-[r:").concat(o,"]-(m) RETURN id(r), type(r), id(m), labels(m)[0]")):a.push("MATCH (n:".concat(u,") WHERE id(n) IN $").concat(e," WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]"))}if(!a.length)return n;const l=a.join(" UNION "),d=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new w.A({openCypherQuery:l,bindParameters:s}),{signal:null===i||void 0===i?void 0:i.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await d.read();if(e)break;for(let i=0;i<t.length;i++){const e=t[i];n.push({id:e[0],typeName:e[1]}),n.push({id:e[2],typeName:e[3]})}}return n}async getRelationshipsBetweenNodes(e,t,i){const n=this._getNamedTypeIdMapFromNodeIds(e);if(0===n.size)return[];const o={relationshipExclusionIds:t,possibleConnectionEntityIds:e},r=[];for(const[d,u]of n.entries()){const e="".concat(d,"_ids");o[e]=u,r.push("MATCH (n:".concat(d,") WHERE id(n) IN $").concat(e," WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)"))}const s=r.join(" UNION "),a=[],l=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new w.A({openCypherQuery:s,bindParameters:o}),{signal:null===i||void 0===i?void 0:i.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await l.read();if(e)break;for(let i=0;i<t.length;i++){const e=t[i];a.push({id:e[0],typeName:e[1]})}}return a}async getRelationshipsFromNodes(e,t,i,n){const o=this._getNamedTypeIdMapFromNodeIds(e);if(0===o.size||0===t.length)return[];const r={relationshipExclusionIds:i,possibleConnectionEntityIds:t},s=[];for(const[p,c]of o.entries()){const e="".concat(p,"_ids");r[e]=c,s.push("MATCH (n:".concat(p,") WHERE id(n) IN $").concat(e," WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)"))}const a=s.join(" UNION "),l=new Map,d=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new w.A({openCypherQuery:a,bindParameters:r}),{signal:null===n||void 0===n?void 0:n.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await d.read();if(e)break;for(let i=0;i<t.length;i++){const e=t[i];let n=l.get(e[1]);n||(n=new Set,l.set(e[1],n)),n.add(e[0])}}const u=[];for(const[p,c]of l)for(const e of c)u.push({id:e,typeName:p});return u}async refreshCacheContent(e,t,i){var n,o,s,d,u,p;let c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],h=arguments.length>4?arguments[4]:void 0;const y=v.A.getInstance(),m=[],f=new Map,b=new Map;null!==(n=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==n&&n.forEach(e=>{e.name&&b.set(e.name,e)}),null!==(o=this.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==o&&o.forEach(e=>{e.name&&b.set(e.name,e)}),e||this.inclusionModeDefinition?e?e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(const i of this.memberIdTypeLookup.get(e)){var t;f.has(i)?null===(t=f.get(i))||void 0===t||t.push(e):f.set(i,[e])}}):null===(s=this.inclusionModeDefinition)||void 0===s||null===(s=s.namedTypeDefinitions)||void 0===s||s.forEach((e,t)=>{e.useAllData?f.set(t,null):e.members&&e.members.forEach(e=>{var i;f.has(t)&&null!==f.get(t)?null===(i=f.get(t))||void 0===i||i.push(e.id):f.set(t,[e.id])})}):(null!==(d=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==d&&d.forEach(e=>{e.name&&f.set(e.name,null)}),null===(u=this.knowledgeGraph.dataModel.entityTypes)||void 0===u||u.forEach(e=>{e.name&&f.set(e.name,null)}));for(const[l,v]of f){var T;const e=new Set(v),n=new Promise((n,o)=>{(async()=>{var n,o;const s=new Set,d=[];let u,p="",m=!1;if(t||null!==(n=b.get(l))&&void 0!==n&&null!==(n=n.properties)&&void 0!==n&&n.forEach(e=>{e.name&&s.add(e.name)}),i&&this.geographicLookup.has(l)){var f;const e=null===(f=this.geographicLookup.get(l))||void 0===f?void 0:f.name;e&&s.add(e)}if(this.entityTypeNames.has(l))p="MATCH (n:".concat(l,") ").concat(v?"WHERE id(n) IN $ids ":"","return ID(n)"),s.forEach(e=>{p+=", n.".concat(e),d.push(e)});else{if(!this.relationshipTypeNames.has(l))throw new r.A("knowledge-graph:layer-data-manager","The graph type of ".concat(l," could not be determined. Was this type set in the KG data model and inclusion definition?"));m=!0,p="MATCH ()-[n:".concat(l,"]->() ").concat(v?"WHERE id(n) IN $ids ":"","return ID(n), id(startNode(n)), id(endNode(n))"),s.forEach(e=>{p+=", n.".concat(e),d.push(e)})}u=new w.A(v?{openCypherQuery:p,bindParameters:{ids:v}}:{openCypherQuery:p});const T=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,u,{signal:null===h||void 0===h?void 0:h.signal})).resultRowsStream.getReader();for(;;){var M,I,C,A;const{done:t,value:i}=await T.read();if(t)break;const n=[];for(let s=0;s<i.length;s++){const t=i[s];let o=0,r=0;const l={properties:{}};for(l.id=t[o],o++,r++,m&&(l.originId=t[o],o++,r++,l.destinationId=t[o],o++,r++,(0,a.tE)(this.nodeConnectionsLookup,l.originId,()=>new Set).add(l.id),(0,a.tE)(this.nodeConnectionsLookup,l.destinationId,()=>new Set).add(l.id),(0,a.tE)(this.relationshipConnectionsLookup,l.id,()=>[l.originId,l.destinationId]));o<t.length;o++)l.properties[d[o-r]]=t[o];e.delete(l.id),n.push(l)}const o=y.writeToStore(n,g.dr,null===(M=this.geographicLookup.get(l))||void 0===M?void 0:M.name);this.sublayerCaches.has(l)||this.sublayerCaches.set(l,new Map),c&&!(null!==(I=this.inclusionModeDefinition)&&void 0!==I&&I.namedTypeDefinitions.has(l))&&null!==(C=this.inclusionModeDefinition)&&void 0!==C&&C.namedTypeDefinitions.set(l,{useAllData:!1,members:new Map}),c&&(null===(A=this.inclusionModeDefinition)||void 0===A||!A.namedTypeDefinitions.get(l).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get(l).members=new Map);const r=this.sublayerCaches.get(l);o.forEach(e=>{var t,i;null!==r&&void 0!==r&&r.set(e.attributes[g.dr],e),c&&(null===(t=this.inclusionModeDefinition)||void 0===t||!t.namedTypeDefinitions.get(l).members.has(e.attributes[g.dr]))&&(null!==(i=this.inclusionModeDefinition)&&void 0!==i&&i.namedTypeDefinitions.get(l).members.set(e.attributes[g.dr],{id:e.attributes[g.dr]}),(0,a.tE)(this.memberIdTypeLookup,e.attributes[g.dr],()=>new Set).add(l))})}const x=null===(o=this.inclusionModeDefinition)||void 0===o?void 0:o.namedTypeDefinitions.get(l);if(x)for(const t of e){var E;null===(E=x.members)||void 0===E||E.delete(t)}})().then(()=>{n(null)}).catch(e=>{"AbortError"===e.name?n(null):o(e)})});m.push(n),null===(T=this._processingCacheUpdatesLookup.get(l))||void 0===T||T.push(n)}if(await Promise.all(m),null!==h&&void 0!==h&&null!==(p=h.signal)&&void 0!==p&&p.aborted)throw(0,l.NK)()}removeFromLayer(e){const t=new Set,i=new Set(e.map(e=>e.id));for(const s of e){var n,o,r;t.add(s.typeName),1===(null===(n=this.memberIdTypeLookup.get(s.id))||void 0===n?void 0:n.size)?this.memberIdTypeLookup.delete(s.id):null===(o=this.memberIdTypeLookup.get(s.id))||void 0===o||o.delete(s.typeName),null===(r=this.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.forEach((e,t)=>{var i;t===s.typeName&&(null===(i=e.members)||void 0===i?void 0:i.has(s.id))&&e.members.delete(s.id)})}t.forEach(e=>{var t;null===(t=this.sublayerCaches.get(e))||void 0===t||t.forEach((t,n)=>{var o;i.has(n)&&(null===(o=this.sublayerCaches.get(e))||void 0===o||o.delete(n))})})}async retrieveDataFromService(e,t,i){var n,o,s;const a=v.A.getInstance(),l=new Set,u=[];let p,T="",M=[];const I="relationship"===t.graphType,C=null===(n=this.inclusionModeDefinition)||void 0===n||null===(n=n.namedTypeDefinitions)||void 0===n||null===(n=n.get(t.objectType.name))||void 0===n?void 0:n.useAllData,A=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let x=!C&&A?Array.from(A).sort():null;if(null!==(o=this.inclusionModeDefinition)&&void 0!==o&&null!==(o=o.namedTypeDefinitions)&&void 0!==o&&null!==(o=o.get(t.objectType.name))&&void 0!==o&&o.useAllData)(null===(s=this.inclusionModeDefinition)||void 0===s||null===(s=s.namedTypeDefinitions)||void 0===s||null===(s=s.get(t.objectType.name))||void 0===s?void 0:s.useAllData)&&null!=e.objectIds&&(x=e.objectIds);else if(null!=e.objectIds&&x&&x.length>0){const t=e.objectIds;e.objectIds=x.filter(e=>t.includes(e))}else if(null!=e.objectIds)x=e.objectIds;else{var E,S,N;if(null!==(E=this.inclusionModeDefinition)&&void 0!==E&&E.namedTypeDefinitions.has(t.objectType.name)&&(null===(S=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))||void 0===S||!S.members||(null===(N=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))||void 0===N||null===(N=N.members)||void 0===N?void 0:N.size)<1))return e.objectIds=[],[];e.objectIds=x}if(null!=e.outFields){const i=e.outFields;i.includes("*")?t.fields.forEach(e=>{l.add(e.name)}):i.forEach(e=>{e!==g.dr&&e!==t.geometryFieldName&&l.add(e)})}if(null!=e.geometry){var L,k,D;const i=e.geometry;let n;const o=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,s=null===o||void 0===o?void 0:o.spatialReference,a=null===o||void 0===o||null===(L=o.serviceCapabilities)||void 0===L?void 0:L.geometryCapabilities;let g=null===a||void 0===a?void 0:a.geometryMaxBoundingRectangleSizeX,f=null===a||void 0===a?void 0:a.geometryMaxBoundingRectangleSizeY;if("point"===i.type){var F;let e=i;null!==(F=e.spatialReference)&&void 0!==F&&F.isWGS84||(await(0,y.initializeProjection)(e.spatialReference,m.KK),e=(0,y.project)(e,m.KK)),n=new c.A({spatialReference:m.KK,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else null===i||void 0===i||null===(k=i.extent)||void 0===k||!k.spatialReference||null!==(D=i.spatialReference)&&void 0!==D&&D.isWGS84?n=i.extent:(await(0,y.initializeProjection)(i.extent.spatialReference,m.KK),n=(0,y.project)(i.extent,m.KK));if(g&&f&&s){if(4326!==s.wkid){const e=new c.A({spatialReference:s,xmax:g,ymax:f}),t=(0,y.project)(e,m.KK);g=t.xmax,f=t.ymax}if(n.xmax-n.xmin>g)throw new r.A("knowledge-graph:layer-data-manager","Extent x bounds should be within ".concat(g,"\xb0 latitude, limit exceeded"));if(n.ymax-n.ymin>f)throw new r.A("knowledge-graph:layer-data-manager","Extent y bounds should be within ".concat(f,"\xb0 longitude, limit exceeded"))}if(null!=e.where&&"1=1"!==e.where){const i=await(0,d.GP)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(e=>{i.fieldNames.includes(e.name)&&l.add(e.name)})}T=I?"Match ()-[n:".concat(t.objectType.name,"]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(t.geometryFieldName,") return ID(n), id(startNode(r)), id(endNode(r))"):"Match (n:".concat(t.objectType.name,") WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(t.geometryFieldName,") return ID(n)"),t.geometryFieldName&&l.add(t.geometryFieldName),l.forEach(e=>{T+=", n.".concat(e),u.push(e)}),p=new w.A({openCypherQuery:T,bindParameters:{param_filter_geom:new h.A({rings:(0,b.Wq)(n)})}})}else{let i="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,d.GP)(e.where,t.fieldsIndex);t.fields.forEach(e=>{n.fieldNames.includes(e.name)&&l.add(e.name)});const o={systemOidFieldName:g.dr,supportedSqlTypes:new Set(["column-reference","string","number","binary-expression"]),supportedSqlOperators:new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),unsupportedOperationFound:!1};i=f(n.parseTree,o),o.unsupportedOperationFound&&(i="")}let n="";n=I?"Match ()-[n:".concat(t.objectType.name,"]->()"):"Match (n:".concat(t.objectType.name,")");let o=!1;x&&(o=!0,n+=" WHERE ID(n) IN $ids"),i&&(n+=o?" AND":" WHERE",n+=" ".concat(i)),n+=" return ID(n)",I&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&l.add(t.geometryFieldName),l.forEach(e=>{n+=", n.".concat(e),u.push(e)}),p=new w.A(x?{openCypherQuery:n,bindParameters:{ids:x}}:{openCypherQuery:n})}const R=(await(0,_.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,p,i)).resultRowsStream.getReader();for(;;){var B;const{done:e,value:i}=await R.read();if(e)break;const n=[];for(let t=0;t<i.length;t++){const e=i[t];let o=0,r=0;const s={properties:{}};for(s.id=e[o],o++,r++,I&&(s.originId=e[o],o++,r++,s.destinationId=e[o],o++,r++);o<e.length;o++)s.properties[u[o-r]]=e[o];n.push(s)}M=M.concat(a.writeToStore(n,g.dr,null===(B=t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name))||void 0===B?void 0:B.name))}return M}_isEndEntitySpatial(e,t,i){for(const o of null!==e&&void 0!==e?e:[])if(this.entityTypeNames.has(o)){var n;const e=this.geographicLookup.get(o),r=e&&(null===(n=this.sublayerCaches.get(o))||void 0===n?void 0:n.get(t.attributes[i]));if(e&&null!==r&&void 0!==r&&r.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(const n of this.memberIdTypeLookup.get(e)){var i;if(!this.entityTypeNames.has(n))return;t.has(n)?null===(i=t.get(n))||void 0===i||i.push(e):t.set(n,[e])}}),t}};(0,n.Cg)([(0,u.MZ)()],M.prototype,"knowledgeGraph",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"inclusionModeDefinition",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"entityTypeNames",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"relationshipTypeNames",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"geographicLookup",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"sublayerCaches",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"nodeConnectionsLookup",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"relationshipConnectionsLookup",void 0),(0,n.Cg)([(0,u.MZ)()],M.prototype,"memberIdTypeLookup",void 0),M=(0,n.Cg)([(0,p.$)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],M)},61064:(e,t,i)=>{i.d(t,{Gz:()=>q,O9:()=>P,hZ:()=>G,CP:()=>Q,dD:()=>U,UT:()=>R,MY:()=>B,Td:()=>F,iW:()=>O,e$:()=>j,qN:()=>L});var n=i(89379),o=i(69539),r=i(87663),s=(i(54373),i(87444));i(41968),i(36939),i(55884),i(26907);const a=s.A;var l=i(95278),d=i(56611),u=i(13312),p=i(1438),c=i(8298),h=i(21009),y=i(15427),m=i(95114),g=i(57491),f=i(31933),v=i(6560),b=i(9505),_=i(6326),w=i(91967),T=i(46053),M=(i(81806),i(76460),i(47249),i(87990));let I=class extends w.A{constructor(e){super(e),this.entityAdds=void 0,this.entityUpdates=void 0,this.entityDeletes=void 0,this.relationshipAdds=void 0,this.relationshipUpdates=void 0,this.relationshipDeletes=void 0,this.options=void 0}};(0,_.Cg)([(0,T.MZ)()],I.prototype,"entityAdds",void 0),(0,_.Cg)([(0,T.MZ)()],I.prototype,"entityUpdates",void 0),(0,_.Cg)([(0,T.MZ)()],I.prototype,"entityDeletes",void 0),(0,_.Cg)([(0,T.MZ)()],I.prototype,"relationshipAdds",void 0),(0,_.Cg)([(0,T.MZ)()],I.prototype,"relationshipUpdates",void 0),(0,_.Cg)([(0,T.MZ)()],I.prototype,"relationshipDeletes",void 0),(0,_.Cg)([(0,T.MZ)()],I.prototype,"options",void 0),I=(0,_.Cg)([(0,M.$)("esri.rest.knowledgeGraph.GraphApplyEdits")],I);var C=i(23908),A=i(85632),x=i(89465),E=i(86659);const S={initializeLayersFromClientData:async(e,t,i)=>{var n;if(t||(t=[...e.layers,...e.tables].map(e=>e.graphTypeName)),0===(null===(n=t)||void 0===n?void 0:n.length))return;const o=new Map;for(const s of t)o.set(s,N(e,s));const r=await(0,v.fetchClientDataAtKeys)(e.dataManager.knowledgeGraph,Array.from(o.values()),{requestOptions:{signal:null===i||void 0===i?void 0:i.signal}});for(const s of[...e.layers,...e.tables]){const t=s.objectType.name;if(null==t)continue;const i=r.get(N(e,t));if(i){const e=JSON.parse(i);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),s.read(e,{origin:"service"})}}}},N=(e,t)=>"knowledge-graph"===e.type?"".concat(t,"/Map"):"".concat(t,"/LinkChart/LinkChartSubLayer");async function L(e,t,i){return S.initializeLayersFromClientData(e,t,i)}const k=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],D="#8f8f82";function F(e){return e<0||e>=k.length?new o.A(D):new o.A(k[e])}function R(e){const t=e.toArray();return new x.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function B(e){let t="ESRI__ID",i=4;for(const n of e)if(n.name){if("name"===n.name.toLowerCase()){t=n.name;break}n.name.toLowerCase().includes("name")?(t=n.name,i=2):"esriFieldTypeString"===n.fieldType&&i>3&&(t=n.name,i=3)}return t}function O(e,t,i){const o={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},r=new m.A({labelExpressionInfo:new g.A({expression:"ESRI__ID"===i?"".concat(t):"$feature.".concat(i)}),labelPlacement:"above-center",symbol:new E.A(o)}),s=new m.A({labelExpressionInfo:new g.A({expression:"'".concat(t,"' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')")}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new E.A((0,n.A)((0,n.A)({},o),{},{yoffset:"12px"}))});return"entity"===e?[r]:[s]}function j(e,t,i){const n={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},o="ESRI__ID"===i?"".concat(e):"$feature.".concat(i);return"point"===t?[new m.A({labelExpressionInfo:new g.A({expression:o}),labelPlacement:"above-center",symbol:new E.A(n)})]:"polyline"===t?[new m.A({labelExpressionInfo:new g.A({expression:o}),labelPlacement:"center-along",repeatLabel:!0,symbol:new E.A(n)})]:"polygon"===t?[new m.A({labelExpressionInfo:new g.A({expression:o}),labelPlacement:"always-horizontal",symbol:new E.A(n)})]:null}const Z={capabilities:[],allowGeometryUpdates:!1,serviceCapabilities:{geometryCapabilities:{supportsZValues:!1,supportsMValues:!1}}};function G(e){const{capabilities:t,allowGeometryUpdates:i,serviceCapabilities:{geometryCapabilities:{supportsZValues:n,supportsMValues:o}}}=(null===e||void 0===e?void 0:e.serviceDefinition)||Z,r=null!==e&&void 0!==e&&e.dataModel.arcgisManaged?t:t.filter(e=>"Query"===e),s=new Set(r);return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:o,supportsZ:n},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:s.has("Create"),supportsDelete:s.has("Delete"),supportsEditing:s.has("Editing"),supportsChangeTracking:!1,supportsQuery:s.has("Query"),supportsQueryBins:!1,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:s.has("Update"),supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:c.F,queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:c.P,editing:{supportsGeometryUpdate:!(null===e||void 0===e||!e.dataModel.arcgisManaged)&&i,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:s.has("Delete"),supportsUpdateByAnonymous:!1,supportsUpdateByOthers:s.has("Update"),supportsAsyncApplyEdits:!1,zDefault:void 0}}}async function P(e,t){var i;const o=new I,s=t.graphTypeName,a=t.graphType,l="knowledge-graph"===t.parentCompositeLayer.type?t.geometryFieldName:null,c=!(null===(i=t.fieldsIndex.get(l))||void 0===i||!i.editable),y=e=>{const i=(0,n.A)({},e);for(const n of t.fields)n.editable||delete i[n.name];for(const t of Object.keys(e))t.includes("ESRI__")&&delete i[t];return i},m=async e=>{await(0,d.initializeProjection)(e.spatialReference,u.A.WGS84);const t=(0,d.project)(e,u.A.WGS84);return"point"===t.type?t.normalize():(await(0,p.el)(t))[0]};for(const n of null!==(g=e.addFeatures)&&void 0!==g?g:[]){var g;const e=y(n.attributes);(0,f.UC)(n.sourceLayer)&&n.sourceLayer.graphTypeName===s&&("entity"===a?(o.entityAdds||(o.entityAdds=[]),l&&n.geometry&&(e[l]=await m(n.geometry)),o.entityAdds.push(new b.A({properties:e,typeName:s}))):(o.relationshipAdds||(o.relationshipAdds=[]),o.relationshipAdds.push(new C.A({properties:e,typeName:s}))))}for(const n of null!==(v=e.updateFeatures)&&void 0!==v?v:[]){var v;const e=n.attributes[h.dr],t=y(n.attributes);(0,f.UC)(n.sourceLayer)&&n.sourceLayer.graphTypeName===s&&("entity"===a?(o.entityUpdates||(o.entityUpdates=[]),l&&c&&n.geometry&&(t[l]=await m(n.geometry)),o.entityUpdates.push(new b.A({id:e,properties:t,typeName:s}))):(o.relationshipUpdates||(o.relationshipUpdates=[]),o.relationshipUpdates.push(new C.A({id:e,properties:t,typeName:s}))))}const _=new Map;for(const n of null!==(w=e.deleteFeatures)&&void 0!==w?w:[]){var w;if((0,A.DU)(n)){const e=n,t=(0,r.tE)(_,e.sourceLayer.graphTypeName,()=>({typeName:e.sourceLayer.graphTypeName,ids:[]}));e.sourceLayer.graphTypeName===s&&t.ids.push(e.attributes[h.dr])}else n.objectId&&"string"==typeof n.objectId&&(0,r.tE)(_,s,()=>({typeName:s,ids:[]})).ids.push(n.objectId)}for(const n of _.values())n.ids.length>0&&("entity"===a?(o.entityDeletes||(o.entityDeletes=[]),o.entityDeletes.push({typeName:n.typeName,ids:n.ids})):(o.relationshipDeletes||(o.relationshipDeletes=[]),o.relationshipDeletes.push({typeName:n.typeName,ids:n.ids})));return o}function q(e,t){const i={addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]};for(const n of e.editResults)if(n.typeName===t){for(const e of n.adds)i.addFeatureResults.push({objectId:e.id,globalId:e.id});for(const e of n.updates)i.updateFeatureResults.push({objectId:e.id,globalId:e.id});for(const e of n.deletes)i.deleteFeatureResults.push({objectId:e.id,globalId:e.id})}return i}function U(e){if(!e.objectType)return null;const t=[];for(const i of e.fields)!i.name.includes("ESRI__")&&i.editable&&"geometry"!==i.type&&t.push(new a({fieldName:i.name}));return new l.A({elements:t})}function Q(e){if(!e.objectType)return null;let t=null;switch(e.geometryType){case"point":case"multipoint":t="point";break;case"polyline":t="line";break;case"polygon":t="polygon";break;default:t=null}return[new y.A({name:e.graphTypeName,drawingTool:t,prototype:{}})]}},63733:(e,t,i)=>{i.d(t,{A:()=>c});var n=i(6326),o=i(46053),r=(i(81806),i(76460),i(47249),i(87990)),s=i(5364),a=i(25515),l=i(65624),d=i(5682),u=i(64519),p=i(731);let c=class extends((0,l.dM)((0,d.j)(a.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}get loaded(){return super.loaded}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}graphicChanged(e){this.emit("graphic-update",e)}};(0,n.Cg)([(0,o.MZ)({type:p.A})],c.prototype,"elevationInfo",void 0),(0,n.Cg)([(0,o.MZ)((0,s.C)(u.Y,"graphics"))],c.prototype,"graphics",void 0),(0,n.Cg)([(0,o.MZ)({type:["show","hide"]})],c.prototype,"listMode",void 0),(0,n.Cg)([(0,o.MZ)()],c.prototype,"screenSizePerspectiveEnabled",void 0),(0,n.Cg)([(0,o.MZ)({readOnly:!0})],c.prototype,"type",void 0),(0,n.Cg)([(0,o.MZ)({constructOnly:!0})],c.prototype,"internal",void 0),c=(0,n.Cg)([(0,r.$)("esri.layers.GraphicsLayer")],c)},68325:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(6326),o=i(42553),r=i(46053),s=(i(81806),i(76460),i(47249),i(87990)),a=i(12831);let l=class extends o.o{constructor(e){super(e),this.path=[]}};(0,n.Cg)([(0,r.MZ)({type:[a.A],json:{write:!0}})],l.prototype,"path",void 0),l=(0,n.Cg)([(0,s.$)("esri.rest.knowledgeGraph.Path")],l)},70373:(e,t,i)=>{i.d(t,{EC:()=>C,wq:()=>a});var n=i(18690),o=i(4212),r=(i(81806),i(5457)),s=i(61196);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,t=arguments.length>1?arguments[1]:void 0;this._compareMinX=c,this._compareMinY=h,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),w.prune(),T.prune(),M.prune(),I.prune()}all(e){l(this._data,e)}search(e,t){let i=this._data;const n=this._toBBox;if(b(e,i))for(w.clear();i;){for(let o=0,r=i.children.length;o<r;o++){const r=i.children[o],s=i.leaf?n(r):r;b(e,s)&&(i.leaf?t(r):v(e,s)?l(r,t):w.push(r))}i=w.pop()}}collides(e){let t=this._data;const i=this._toBBox;if(!b(e,t))return!1;for(w.clear();t;){for(let n=0,o=t.children.length;n<o;n++){const o=t.children[n],r=t.leaf?i(o):o;if(b(e,r)){if(t.leaf||v(e,r))return!0;w.push(o)}}t=w.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new x([]),this}remove(e){if(!e)return this;let t,i=this._data,r=null,s=0,a=!1;const l=this._toBBox(e);for(M.clear(),I.clear();i||M.length>0;){var d;if(i||(i=M.pop(),r=M.data[M.length-1],s=null!==(d=I.pop())&&void 0!==d?d:0,a=!0),i.leaf&&(t=(0,n.qh)(i.children,(0,o.zI)(e),i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),M.push(i),this._condense(M),this;a||i.leaf||!v(i,l)?r?(s++,i=r.children[s],a=!1):i=null:(M.push(i),I.push(s),s=0,r=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,n){const o=i-t+1;let r=this._maxEntries;if(o<=r){const n=new x(e.slice(t,i+1));return d(n,this._toBBox),n}n||(n=Math.ceil(Math.log(o)/Math.log(r)),r=Math.ceil(o/r**(n-1)));const s=new E([]);s.height=n;const a=Math.ceil(o/r),l=a*Math.ceil(Math.sqrt(r));_(e,t,i,l,this._compareMinX);for(let d=t;d<=i;d+=l){const t=Math.min(d+l-1,i);_(e,d,t,a,this._compareMinY);for(let i=d;i<=t;i+=a){const o=Math.min(i+a-1,t);s.children.push(this._build(e,i,o,n-1))}}return d(s,this._toBBox),s}_insert(e,t,i){const n=this._toBBox,o=i?e:n(e);M.clear();const r=function(e,t,i,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==i;){let i,n=1/0,o=1/0;for(let r=0,s=t.children.length;r<s;r++){const s=t.children[r],a=y(s),l=g(e,s)-a;l<o?(o=l,n=a<n?a:n,i=s):l===o&&a<n&&(n=a,i=s)}t=i||t.children[0]}return t}(o,this._data,t,M);for(r.children.push(e),p(r,o);t>=0&&M.data[t].children.length>this._maxEntries;)this._split(M,t),t--;!function(e,t,i){for(let n=i;n>=0;n--)p(t.data[n],e)}(o,M,t)}_split(e,t){const i=e.data[t],n=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,n);const r=this._chooseSplitIndex(i,o,n);if(!r)return;const s=i.children.splice(r,i.children.length-r),a=i.leaf?new x(s):new E(s);a.height=i.height,d(i,this._toBBox),d(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this._data=new E([e,t]),this._data.height=e.height+1,d(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let n,o,r;n=o=1/0;for(let s=t;s<=i-t;s++){const t=u(e,0,s,this._toBBox),a=u(e,s,i,this._toBBox),l=f(t,a),d=y(t)+y(a);l<n?(n=l,r=s,o=d<o?d:o):l===n&&d<o&&(o=d,r=s)}return r}_chooseSplitAxis(e,t,i){const n=e.leaf?this._compareMinX:c,o=e.leaf?this._compareMinY:h;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,o)&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const o=this._toBBox,r=u(e,0,t,o),s=u(e,i-t,i,o);let a=m(r)+m(s);for(let l=t;l<i-t;l++){const t=e.children[l];p(r,e.leaf?o(t):t),a+=m(r)}for(let l=i-t-1;l>=t;l--){const t=e.children[l];p(s,e.leaf?o(t):t),a+=m(s)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const o=e.data[t-1],r=o.children;r.splice((0,n.qh)(r,i,r.length,o.indexHint),1)}else this.clear();else d(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function l(e,t){let i=e;for(T.clear();i;){var n;if(!0===i.leaf)for(const e of i.children)t((0,o.zI)(e));else T.pushArray(i.children);i=null!==(n=T.pop())&&void 0!==n?n:null}}function d(e,t){u(e,0,e.children.length,t,e)}function u(e,t,i,n,o){o||(o=new x([])),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let r,s=t;s<i;s++)r=e.children[s],p(o,e.leaf?n(r):r);return o}function p(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function c(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function y(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function m(e){return e.maxX-e.minX+(e.maxY-e.minY)}function g(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function f(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),r=Math.min(e.maxY,t.maxY);return Math.max(0,o-i)*Math.max(0,r-n)}function v(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function b(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _(e,t,i,n,o){const r=[t,i];for(;r.length;){const t=r.pop(),i=r.pop();if(t-i<=n)continue;const a=i+Math.ceil((t-i)/n/2)*n;(0,s.q)(e,a,i,t,o),r.push(i,a,a,t)}}const w=new r.A,T=new r.A,M=new r.A,I=new r.A({deallocator:void 0});class C{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class A extends C{constructor(){super(...arguments),this.height=1,this.indexHint=new n.vW}}class x extends A{constructor(e){super(),this.children=e,this.leaf=!0}}class E extends A{constructor(e){super(),this.children=e,this.leaf=!1}}},72547:(e,t,i)=>{i.d(t,{A:()=>y});var n=i(18690),o=i(50076),r=i(54099),s=i(76460),a=i(42294),l=i(2413),d=i(98618),u=i(33328),p=i(55167),c=i(33376);const h=(0,a.vt)();class y{constructor(e){this.geometryInfo=e,this._boundsStore=new u.F,this._featuresById=new Map,this._usedMemory=0,this.events=new r.bk,this.featureAdapter=c.T}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach(t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,i,n,o]=this.fullBounds;return{xmin:t,ymin:i,xmax:n,ymax:o,spatialReference:(0,p.ag)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map(e=>this._upsert(e));return this._emitChanged(),t.filter(n.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const i of e){const e=this._boundsStore.get(i.objectId);e&&t((0,a.Jt)(h,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach(t=>e(t))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,e=>{t(this._featuresById.get(e))})}_emitChanged(){this.events.emit("changed",void 0)}_add(e){var t,i,n,r,a;if(!e)return;const u=e.objectId;if(null==u)return void s.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new o.A("featurestore:invalid-feature","feature id is missing",{feature:e}));const p=this._featuresById.get(u);let c;if(p?(e.displayId=p.displayId,c=this._boundsStore.get(u),this._boundsStore.delete(u),this._usedMemory-=null!==(t=null===(i=this.estimateFeatureUsedMemory)||void 0===i?void 0:i.call(this,p))&&void 0!==t?t:0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),null===(n=e.geometry)||void 0===n||null===(n=n.coords)||void 0===n||!n.length)return this._boundsStore.set(u,null),void this._featuresById.set(u,e);c=(0,d.jQ)(null!=c?c:(0,l.vt)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=c&&this._boundsStore.set(u,c),this._featuresById.set(u,e),this._usedMemory+=null!==(r=null===(a=this.estimateFeatureUsedMemory)||void 0===a?void 0:a.call(this,e))&&void 0!==r?r:0}_upsert(e){var t,i,n,r,a;const u=null===e||void 0===e?void 0:e.objectId;if(null==u)return s.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new o.A("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const p=this._featuresById.get(u);if(!p)return this._add(e),e;this._usedMemory-=null!==(t=null===(i=this.estimateFeatureUsedMemory)||void 0===i?void 0:i.call(this,p))&&void 0!==t?t:0;const{geometry:c,attributes:h}=e;for(const o in h)p.attributes[o]=h[o];return c&&(p.geometry=c,this._boundsStore.set(u,null!==(n=(0,d.jQ)((0,l.vt)(),c,this.geometryInfo.hasZ,this.geometryInfo.hasM))&&void 0!==n?n:null)),this._usedMemory+=null!==(r=null===(a=this.estimateFeatureUsedMemory)||void 0===a?void 0:a.call(this,p))&&void 0!==r?r:0,p}_remove(e){var t,i;null!=this.onFeatureRemove&&this.onFeatureRemove(e);const n=e.objectId;return this._boundsStore.delete(n),this._featuresById.delete(n),this._usedMemory-=null!==(t=null===(i=this.estimateFeatureUsedMemory)||void 0===i?void 0:i.call(this,e))&&void 0!==t?t:0,e}}},85646:(e,t,i)=>{i.d(t,{$C:()=>m,Hh:()=>a,Tu:()=>h,Wg:()=>y,Xq:()=>f,i6:()=>v,pM:()=>c,vJ:()=>g});var n=i(89379),o=i(28899);let r,s=null;function a(){return r||(r=i.e(3884).then(i.bind(i,83884)).then(e=>e.l).then(e=>{let{default:t}=e;return t({locateFile:e=>(0,o.s)("esri/libs/linkchartlayout/".concat(e))})}).then(e=>{!function(e){s=e}(e)}),r)}const l={right:0,left:1,top:2,bottom:3},d={none:0,"start-only":1,"start-and-end":2};function u(e){var t,i,o;const r=(0,n.A)((0,n.A)((0,n.A)({},{timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0}),null===e||void 0===e?void 0:e.toJSON()),{},{eventsTicksVisualization:null!==(t=null===e||void 0===e?void 0:e.eventsTicksVisualization)&&void 0!==t?t:"start-and-end"});return(0,n.A)((0,n.A)({},r),{},{timeDirection:{value:null!==(i=l[r.timeDirection])&&void 0!==i?i:l.right},eventsTicksVisualization:{value:null!==(o=d[r.eventsTicksVisualization])&&void 0!==o?o:d["start-and-end"]}})}function p(e,t,i,n,o,r){const a=i.length,l=o.length,d=Float64Array.BYTES_PER_ELEMENT,u=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,c=16+a*(p+2*d)+l*(2*u),h=s._malloc(c);try{const p=h+16-h%16,c=p+a*d,y=c+a*d,m=y+l*u,g=m+l*u,f=()=>[s.HEAPF64.subarray(p>>3,(p>>3)+a),s.HEAPF64.subarray(c>>3,(c>>3)+a),s.HEAPU32.subarray(y>>2,(y>>2)+l),s.HEAPU32.subarray(m>>2,(m>>2)+l),s.HEAPU8.subarray(g,g+a)],[v,b,_,w,T]=f();v.set(i),b.set(n),_.set(o),w.set(r),T.set(t);const M=e(a,g,p,c,l,y,m);let I=null,C=null;if(0===M.value){const e=s.getLayoutLinksTypes(),t=s.getLayoutLinksVerticesEndIndices(),i=s.getLayoutLinksVertices(),n=s.countLayoutLinksVertices();!l||e&&t?n&&!i?M.value=1:(I={types:new Uint8Array(s.HEAPU8.subarray(e,e+l)),vertexEndIndex:new Uint32Array(s.HEAPU32.subarray(t>>2,(t>>2)+l)),vertices:new Float64Array(s.HEAPF64.subarray(i>>3,(i>>3)+2*n))},C=s.getAuxiliaryGraphicElements()):M.value=1}const[A,x,E,S,N]=f();return i.set(A),n.set(x),o.set(E),r.set(S),t.set(N),{status:M.value,links:I,graphics:C}}finally{s._free(h),s.cleanupLayout()}}var c,h,y,m,g,f,v;!function(e){e.getMinIdealEdgeLength=function(){return s.getMinIdealEdgeLength()},e.apply=function(e,t,i,n,o,r){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;return p((t,i,n,o,r,u,p)=>s.applyForceDirectedLayout(e,t,i,n,o,r,u,p,a,l,d),t,i,n,o,r)}}(c||(c={})),function(e){e.apply=function(e,t,i,n,o,r){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;return p((t,i,n,o,r,u,p)=>s.applyCommunityLayout(e,t,i,n,o,r,u,p,a,l,d),t,i,n,o,r)}}(h||(h={})),function(e){e.apply=function(e,t,i,n,o,r){return p((t,i,n,o,r,a,l)=>s.applySimpleLayout(e,t,i,n,o,r,a,l),t,i,n,o,r)}}(y||(y={})),function(e){e.apply=function(e,t,i,n,o,r){return p((t,i,n,o,r,a,l)=>s.applyHierarchicalLayout(e,t,i,n,o,r,a,l),t,i,n,o,r)}}(m||(m={})),function(e){e.apply=function(e,t,i,n,o,r){return p((t,i,n,o,r,a,l)=>s.applyRadialTreeLayout(e,t,i,n,o,r,a,l),t,i,n,o,r)}}(g||(g={})),function(e){e.apply=function(e,t,i,n,o,r){return p((t,i,n,o,r,a,l)=>s.applySmartTreeLayout(e,t,i,n,o,r,a,l),t,i,n,o,r)}}(f||(f={})),function(e){e.apply=function(e,t,i,n,o,r,a,l,d,c,h,y){return p((t,i,n,a,l,p,m)=>{if(o.length!==t)return{value:1};if(r.length!==t)return{value:1};if(d.length!==l)return{value:1};if(c.length!==l)return{value:1};const g=Float64Array.BYTES_PER_ELEMENT,f=16,v=s._malloc(f+t*g),b=s._malloc(f+t*g),_=s._malloc(f+l*g),w=s._malloc(f+l*g),T=v+f-v%f,M=b+f-b%f,I=_+f-_%f,C=w+f-w%f;try{return s.HEAPF64.subarray(T>>3,(T>>3)+t).set(o),s.HEAPF64.subarray(M>>3,(M>>3)+t).set(r),s.HEAPF64.subarray(I>>3,(I>>3)+l).set(d),s.HEAPF64.subarray(C>>3,(C>>3)+l).set(c),s.applyChronologicalLayout(e,t,i,n,a,T,M,l,p,m,I,C,h,u(y))}finally{s._free(v),s._free(b),s._free(_),s._free(w)}},t,i,n,a,l)}}(v||(v={}))}}]);
//# sourceMappingURL=9232.45a27405.chunk.js.map
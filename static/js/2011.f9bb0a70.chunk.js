"use strict";(self.webpackChunktest_app=self.webpackChunktest_app||[]).push([[2011,7995],{771:(e,t,i)=>{i.d(t,{I:()=>l});var s=i(6326),r=i(76460),n=i(50346),o=i(68134),a=(i(81806),i(47249),i(50076),i(87990));const l=e=>{const t=e;let i=class extends t{initialize(){this.addHandles((0,o.on)(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{(0,n.zf)(e)||r.A.getLogger(this).error(e)})}),"RefreshableLayerView")}};return i=(0,s.Cg)([(0,a.$)("esri.views.layers.RefreshableLayerView")],i),i}},1484:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(97255);class r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.lengths=null!==e&&void 0!==e?e:[],this.coords=null!==t&&void 0!==t?t:[]}static fromJSON(e){return new r(e.lengths,e.coords)}static fromRect(e){const[t,i,s,n]=e,o=s-t,a=n-i;return new r([5],[t,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,t)=>e+t)}get usedMemory(){return 64+(0,s.Qf)(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];if(s<3)continue;let r=this.coords[2*t],n=this.coords[2*t+1];for(let i=1;i<s;i+=1){const s=this.coords[2*(i+t)],o=this.coords[2*(i+t)+1];e+=-.5*(s-r)*(o+n),r=s,n=o}t+=s}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let i=0;i<s;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=s}}deltaDecode(){const e=this.clone(),{coords:t,lengths:i}=e;let s=0;for(const r of i){for(let e=1;e<r;e++)t[2*(s+e)]+=t[2*(s+e)-2],t[2*(s+e)+1]+=t[2*(s+e)-1];s+=r}return e}clone(e){if(0===this.lengths.length)return new r([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce((e,t)=>e+t)),i=this.coords.slice(0,t);return e?(e.set(i),new r(this.lengths,e)):new r(Array.from(this.lengths),Array.from(i))}}},12838:(e,t,i)=>{i.d(t,{jX:()=>c,zo:()=>p,gd:()=>h,ph:()=>a,no:()=>d,kz:()=>l,ht:()=>u,yo:()=>g});var s=i(19247);var r=i(59844);const n=new Map,o=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const i=e+"/"+t,s=this._cachedBlocks;if(s.has(i)){const e=s.get(i);return e.refCount--,e.refCount<=0&&(s.delete(i),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const i=e+"/"+t,s=this._cachedBlocks;if(s.has(i)){const e=s.get(i);return e.ts=Date.now(),e.refCount++,s.delete(i),s.set(i,e),e.block}return null}putBlock(e,t,i,s){const r=this._cachedBlocks,n=e+"/"+t;if(r.has(n)){const e=r.get(n);e.ts=Date.now(),e.refCount++}else r.set(n,{block:i,ts:Date.now(),refCount:1,controller:s});this._trim(),this._updateTimer()}deleteBlock(e,t){const i=this._cachedBlocks,s=e+"/"+t;i.has(s)&&i.delete(s)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval(()=>{const t=Array.from(e),i=Date.now();for(let s=0;s<t.length&&t[s][1].ts<=i-this._duration;s++)e.delete(t[s][0]);0===e.size&&this._clearTimer()},this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let i=0;i<t.length-this._size;i++)e.delete(t[i][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function a(e,t,i){const s=[];return null!=t&&s.push("sliceId=".concat(t)),null!=i&&s.push("bandIds=".concat(i.join(","))),s.length?"".concat(e,"?").concat(s.join("&")):e}function l(e,t){const i={extent:null,rasterInfo:t,cache:new Map},s=n.get(e);return s?(s.push(i),s.length-1):(n.set(e,[i]),0)}function u(e,t){const i=n.get(e);i&&(i[t]=null,i.some(e=>null!=e)||n.delete(e))}function c(e,t,i){var s;const r=n.get(e);if(!r)return null==t?o.decreaseRefCount(e,i):0;if(null==t||null==r[t])return o.decreaseRefCount(e,i);const a=null===(s=r[t])||void 0===s?void 0:s.cache,l=null===a||void 0===a?void 0:a.get(i);if(a&&l){if(l.refCount--,0===l.refCount){a.delete(i);for(let e=0;e<r.length;e++){var u;null===(u=r[e])||void 0===u||u.cache.delete(i)}l.controller&&l.controller.abort()}return l.refCount}return 0}function h(e,t,i){var s;const r=n.get(e);if(!r)return null==t?o.getBlock(e,i):null;if(null==t||null==r[t]){for(let e=0;e<r.length;e++){var a;const t=null===(a=r[e])||void 0===a?void 0:a.cache.get(i);if(t)return t.refCount++,t.block}return o.getBlock(e,i)}const l=null===(s=r[t])||void 0===s?void 0:s.cache.get(i);if(l)return l.refCount++,l.block;for(let n=0;n<r.length;n++){var u;if(n===t||!r[n])continue;const e=null===(u=r[n])||void 0===u?void 0:u.cache,s=null===e||void 0===e?void 0:e.get(i);if(e&&s)return s.refCount++,e.set(i,s),s.block}return null}function d(e,t,i,s){var r;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const l=n.get(e);if(!l)return void(null==t&&o.putBlock(e,i,s,a));if(null==t||null==l[t])return void o.putBlock(e,i,s,a);const u={refCount:1,block:s,isResolved:!1,isRejected:!1,controller:a};s.then(()=>u.isResolved=!0).catch(()=>u.isRejected=!0),null===(r=l[t])||void 0===r||r.cache.set(i,u)}function p(e,t,i){var s;const r=n.get(e);r?null!=t&&null!=r[t]?null===(s=r[t])||void 0===s||s.cache.delete(i):o.deleteBlock(e,i):null==t&&o.deleteBlock(e,i)}function m(e,t){var i;const s=n.get(e);return s&&null!==(i=s[t])&&void 0!==i?i:null}function g(e,t,i,n,o,a){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const u=m(e,t);if(!u)return;const c=u.extent,{cache:h,rasterInfo:d}=u;if(c&&c.xmin===i.xmin&&c.xmax===i.xmax&&c.ymin===i.ymin&&c.ymax===i.ymax)return;n=null!==n&&void 0!==n?n:0;const p=i.clone().normalize(),{spatialReference:g,transform:f}=d,y=new Set;for(let m=0;m<p.length;m++){const e=p[m];if(e.xmax-e.xmin<=n||e.ymax-e.ymin<=n)continue;let t=(0,r._l)(e,g,l);if(null==t)continue;if(null!=f&&(t=f.inverseTransform(t),null==t))continue;const i=new s.A({x:n,y:n,spatialReference:e.spatialReference});if(null==o&&!(o=(0,r.Wo)(i,g,e,l)))return;const{pyramidLevel:u,pyramidResolution:c,excessiveReading:h}=(0,r.t$)(o,d,a||"closest");if(h)return;const{storageInfo:x}=d,{origin:b}=x,{x:w,y:v}=c,C=Math.max(0,Math.floor((t.xmin-b.x)/w)),_=Math.max(0,Math.floor((b.y-t.ymax)/v)),T=Math.ceil(t.width/w-.1),P=Math.ceil(t.height/v-.1),S=u>0?x.pyramidBlockWidth:x.blockWidth,R=u>0?x.pyramidBlockHeight:x.blockHeight,M=x.blockBoundary[u];if(!M)continue;const I=1,F=Math.max(M.minCol,Math.floor(C/S)-I),z=Math.max(M.minRow,Math.floor(_/R)-I),A=Math.min(M.maxCol,Math.floor((C+T-1)/S)+I),k=Math.min(M.maxRow,Math.floor((_+P-1)/R)+I);for(let s=z;s<=k;s++)for(let e=F;e<=A;e++)y.add("".concat(u,"/").concat(s,"/").concat(e))}h.forEach((e,t)=>{if(!y.has(t)){const e=h.get(t);(null==e||e.isResolved||e.isRejected)&&h.delete(t)}}),u.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}},20176:(e,t,i)=>{i.d(t,{N3:()=>l,Om:()=>a});var s=i(89379),r=i(97255),n=i(90321),o=i(1484);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.geometry=e,this.attributes=t,this.centroid=i,this.objectId=s,this.displayId=r}static fromJSON(e){const t=e.geometry?o.A.fromJSON(e.geometry):null,i=e.centroid?o.A.fromJSON(e.centroid):null,s=e.objectId;return new a(t,e.attributes,i,s)}weakClone(){const e=new a(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){var e,t;const i=null===(e=this.geometry)||void 0===e?void 0:e.clone(),r=new a(i,(0,s.A)({},this.attributes),null===(t=this.centroid)||void 0===t?void 0:t.clone(),this.objectId);return r.displayId=this.displayId,r}ensureCentroid(e){var t;return null!==(t=this.centroid)&&void 0!==t||(this.centroid=(0,n.Q)(new o.A,this.geometry,e.hasZ,e.hasM)),this.centroid}get usedMemory(){var e,t;return 128+(0,r.lM)(this.attributes)+(null!==(e=null===(t=this.geometry)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0)}}function l(e){var t;return!(null===(t=e.geometry)||void 0===t||null===(t=t.coords)||void 0===t||!t.length)}},46550:(e,t,i)=>{i.d(t,{A:()=>l});var s=i(81806),r=i(36201),n=i(90548),o=i(44595);const a=(e,t)=>e.key.level-t.key.level!==0?e.key.level-t.key.level:e.key.row-t.key.row!==0?e.key.row-t.key.row:e.key.col-t.key.col;class l extends r.A{constructor(e){super(),this.tileInfoView=e,this.sortFunction=a}renderChildren(e){this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this.tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[n.A],drawPhase:83,target:()=>this.getStencilTarget()})),(0,s.A)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[o.A],drawPhase:64,target:()=>this.children})),t}getStencilTarget(){return this.children}setStencilReference(e){let t=1;for(const i of this.children)i.stencilRef=t++}}},60853:(e,t,i)=>{i.d(t,{K5:()=>h,Kt:()=>m,M8:()=>a,Rj:()=>g,_9:()=>o,i6:()=>d,mh:()=>c,nb:()=>u,p8:()=>x,tL:()=>l,xf:()=>f,yS:()=>p,y_:()=>w,zb:()=>y,zy:()=>b});var s=i(5095),r=i(60984),n=i(90113);function o(e){const t=(0,r.fV)(12.9898),i=(0,r.fV)(78.233),s=(0,r.fV)(43758.5453),n=(0,r.Om)(e,(0,r.Zc)(t,i)),o=(0,r.zi)(n,(0,r.fV)(3.14));return(0,r.jc)((0,r.F8)(o).multiply(s))}function a(e){return(0,r.LC)(e,(0,r.fV)(n.qM))}function l(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function u(e){return e.multiply(2).subtract(1)}function c(e,t){const i=(0,r.fV)(2**t);return(0,r.zi)((0,r.RI)(e.divide(i)),(0,r.fV)(2))}function h(e,t){return(0,r.MM)(c(e,t),(0,r.fV)(.5))}function d(e,t){return c(e,t+s.U5)}function p(e,t){return c(e,t)}function m(e){const t=c(e.z,7),i=(0,r.fV)(1).subtract(t),s=e.xyz.subtract((0,r.eR)(0,0,(0,r.fV)(128)));return i.multiply(e).add(t.multiply(s))}function g(e){const t=(0,r.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,r.Om)(e,t)}function f(e){return(0,r.T9)((0,r.T9)((0,r.T9)(e.x,e.y),e.z),e.w)}function y(e){return new r.nt(1).subtract(e)}function x(e){return e.subtract(new r.nt(1))}function b(e,t){return e.subtract(new r.nt(t))}function w(e,t,i,s){let n=new r.Zb(0);const o=new r.Zb(0);return n=v(n,e,o),n=v(n,t,o),n=v(n,i,o),n=v(n,s,o),n}function v(e,t,i){const s=t.subtract(i),r=e.add(s);return i=r.subtract(e).subtract(s),r}},61229:(e,t,i)=>{i.d(t,{$Q:()=>a,Sd:()=>c,b5:()=>u,b7:()=>h});var s=i(31633),r=i(76797),n=i(19247),o=i(66486);async function a(e,t,s){if("extent"===s.type)return function(e,t,i){const{width:s,height:r}=e,n=new Uint8Array(s*r),a=t.width/s,l=t.height/r;if(i.width/a<.5||i.height/l<.5)return new o.A({pixelType:e.pixelType,width:s,height:r,mask:n,pixels:[...e.pixels]});const{xmin:u,xmax:c,ymin:h,ymax:d}=t,{xmin:p,xmax:m,ymin:g,ymax:f}=i,y=Math.max(u,p),x=Math.min(c,m),b=Math.max(h,g),w=Math.min(d,f),v=.5*a,C=.5*l;if(x-y<v||w-b<C||x<u+v||y>c-v||b>d-C||w<h+C)return new o.A({pixelType:e.pixelType,width:s,height:r,mask:n,pixels:[...e.pixels]});const _=Math.max(0,(y-u)/a),T=Math.min(s,Math.max(0,(x-u)/a)),P=Math.max(0,(d-w)/l),S=Math.min(r,Math.max(0,(d-b)/l)),R=Math.round(_),M=Math.round(T)-1,I=Math.round(P),F=Math.round(S)-1;if(R===M&&_%1>.5&&T%1<.5||I===F&&P%1>.5&&S%1<.5)return new o.A({pixelType:e.pixelType,width:s,height:r,mask:n,pixels:[...e.pixels]});if(0===R&&0===I&&M===s&&F===r)return e;const z=e.mask;for(let o=I;o<=F;o++)for(let e=R;e<=M;e++){const t=o*s+e;n[t]=z?z[t]:255}return new o.A({pixelType:e.pixelType,width:s,height:r,mask:n,pixels:[...e.pixels]})}(e,t,s);const{width:r,height:n}=e,a=new Uint8Array(r*n);return(await Promise.all([i.e(6871),i.e(6364),i.e(6175),i.e(426),i.e(6483)]).then(i.bind(i,38165))).execute(t,s)?"polyline"===s.type?function(e,t,i){const{width:s,height:r}=e,n=new Uint8Array(s*r),a=t.width/s,l=t.height/r,{xmin:u,ymax:c}=t,{paths:h}=i,d=e.mask;for(let o=0;o<h.length;o++){const e=h[o];for(let t=0;t<e.length-1;t++){const[i,o]=e[t],[h,p]=e[t+1],m=Math.min(o,p),g=Math.max(o,p),f=Math.max(0,Math.floor((c-g)/l)),y=Math.min(r-1,Math.floor((c-m)/l));if(!(y<f))if(f===y){const e=Math.min(i,h),t=Math.max(i,h),r=Math.max(0,Math.floor((e-u)/a)),o=Math.min(s-1,Math.floor((t-u)/a));if(o<r)continue;const l=f*s;for(let i=l+r;i<=l+o;i++)n[i]=d?d[i]:255}else{const e=(i-u)/a,t=(h-i)/(p-o)/a,r=l*t;for(let i=f;i<=y;i++){const a=t*(c-i*l-o)+e,u=Math.max(0,Math.floor(r>0?a-r:a)),h=Math.min(s-1,Math.floor(r>0?a:a-r));if(h<u)continue;const p=i*s;for(let e=p+u;e<=p+h;e++)n[e]=d?d[e]:255}}}}return new o.A({pixelType:e.pixelType,width:s,height:r,mask:n,pixels:[...e.pixels]})}(e,t,s):(await Promise.all([i.e(6871),i.e(6364),i.e(6175),i.e(426),i.e(3528)]).then(i.bind(i,32138))).execute(s,t)?e:l(e,t,s):new o.A({pixelType:e.pixelType,width:r,height:n,mask:a,maskIsAlpha:!1,pixels:[...e.pixels]})}function l(e,t,i){if(!e)return e;const{width:s,height:r}=e,n=u({geometry:i,size:[s,r],srcExtent:t,srcMask:e.mask});return new o.A({pixelType:e.pixelType,width:s,height:r,mask:n,maskIsAlpha:!1,pixels:[...e.pixels]})}function u(e){const{geometry:t,size:i,srcExtent:s,srcMask:r}=e,[n,o]=i;let a;const l=s.width/n,u=s.height/o,{xmin:c,ymax:h}=s;if("extent"===t.type){const e=(t.xmin-c)/l,i=(t.xmax-c)/l,s=(h-t.ymax)/u,r=(h-t.ymin)/u;a=[[[e,s],[e,r],[i,r],[i,s],[e,s]]]}else a=t.rings.map(e=>e.map(e=>{let[t,i]=e;return[(t-c)/l,(h-i)/u]}));return function(e,t,i){const[s,r]=t,n=new OffscreenCanvas(s,r).getContext("2d");n.fillStyle="#f00",n.beginPath(),e.forEach(e=>{n.moveTo(e[0][0],e[0][1]);for(let t=0;t<e.length;t++)n.lineTo(e[t][0],e[t][1]);n.closePath()}),n.fill();const o=n.getImageData(0,0,s,r).data,a=s*r,l=new Uint8Array(a);let u=!1;for(let c=0;c<a;c++)i&&!i[c]||(o[4*c+3]>127?l[c]=255:u=!0);return u||i?l:void 0}(a,i,r)}function c(e,t){const{extent:i}=h(e,t,new n.A({x:e.pixelSize.x,y:e.pixelSize.y,spatialReference:e.spatialReference})),{extent:s}=e.extent;if(i.xmax=Math.min(i.xmax,s.xmax),i.ymax=Math.min(i.ymax,s.ymax),i.xmin<i.xmax&&i.ymin<i.ymax){const{x:t,y:s}=e.pixelSize,r=Math.round(i.width/t),n=Math.round(i.height/s);e.extent=i,e.width=r,e.height=n}}function h(e,t,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const{spatialReference:o}=e,{x:a,y:l}=function(e,t){if(e.spatialReference.equals(t))return e;const i=(0,s.GA)(e.spatialReference),r=(0,s.GA)(t);if(i===r)return e;const n=i/r;return{x:e.x*n,y:e.y*n}}(i,o);let u,c,h;const d="extent"===t.type?t:t.extent;let{xmin:p,xmax:m,ymax:g,ymin:f}=d;const{xmin:y,ymax:x}=e.extent;return n?(p=y+(p>y?a*Math.round((p-y)/a):0),g=x-(g<x?l*Math.round((x-g)/l):0),m=y+(m>y?a*Math.round((m-y)/a):0),f=x-(f<x?l*Math.round((x-f)/l):0),u=new r.A({xmin:p,ymax:g,xmax:m,ymin:f,spatialReference:o}),c=Math.round(u.width/a),h=Math.round(u.height/l)):(c=Math.floor((m-p)/a+.8),h=Math.floor((g-f)/l+.8),p=y+(p>y?a*Math.floor((p-y)/a+.1):0),g=x-(g<x?l*Math.floor((x-g)/l+.1):0),m=p+c*a,f=g-h*l,u=new r.A({xmin:p,ymax:g,xmax:m,ymin:f,spatialReference:o})),{extent:u,width:c,height:h}}},71853:(e,t,i)=>{i.d(t,{WL:()=>u,b4:()=>o,hE:()=>l,kc:()=>a});i(72745);var s=i(93345),r=i(80895),n=i(96673);function o(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest";const o=!(arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&"u8"===t.pixelType),a=o?s.ld.FLOAT:s.ld.UNSIGNED_BYTE,l=null==t.pixels||0===t.pixels.length?null:o?t.getAsRGBAFloat():t.getAsRGBA(),u=e.capabilities.textureFloatLinear,c=new n.R(t.width,t.height);return c.internalFormat=o?s.H0.RGBA32F:6408,c.samplingMode=!u||"bilinear"!==i&&"cubic"!==i?9728:9729,c.dataType=a,c.wrapMode=33071,new r.g(e,c,l)}function a(e,t){const{spacing:i,offsets:o,coefficients:a,size:[l,u]}=t,c=i[0]>1,h=new n.R(c?4*l:l,u);h.internalFormat=s.H0.RGBA32F,h.dataType=s.ld.FLOAT,h.samplingMode=9728,h.wrapMode=33071;const d=new Float32Array(c?l*u*16:2*o.length);if(c&&null!=a)for(let s=0,r=0;s<a.length;s++)d[r++]=a[s],s%3==2&&(d[r++]=1);else for(let s=0;s<u;s++)for(let e=0;e<l;e++){const t=4*(s*l+e),i=2*(e*u+s);d[t]=o[i],d[t+1]=o[i+1],d[t+3]=-1===o[i]?0:1}return new r.g(e,h,d)}function l(e,t){const i=new n.R(t.length/4,1);return i.internalFormat=6408,i.samplingMode=9728,i.wrapMode=33071,new r.g(e,i,t)}function u(e,t,i){const o=new n.R(i[0],i[1]);return o.internalFormat=6406,o.pixelFormat=6406,o.dataType=s.ld.UNSIGNED_BYTE,o.samplingMode=9728,o.wrapMode=33071,new r.g(e,o,t)}},75146:(e,t,i)=>{i.d(t,{A:()=>s});class s{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new s;return e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},81892:(e,t,i)=>{i.d(t,{r:()=>n});var s=i(60984);function r(e){const t=function(e){const t=new s.nt(1/6),i=e.multiply(e),r=i.multiply(e),n=t.multiply(r.multiply(-1).add(new s.nt(3).multiply(i)).subtract(new s.nt(3).multiply(e)).add(1)),o=t.multiply(r.multiply(3).subtract(i.multiply(6)).add(4)),a=t.multiply(r.multiply(-3).add(i.multiply(3)).add(e.multiply(3)).add(1)),l=t.multiply(r);return new s.Zb(n,o,a,l)}(e),i=t.x.add(t.y),r=t.z.add(t.w),n=new s.nt(1).subtract(t.y.divide(i)).add(e),o=new s.nt(1).add(t.w.divide(r)).subtract(e);return new s.Zb(n,o,i,r)}function n(e,t,i){const n=new s.ZY(new s.nt(1).divide(i.x),0),o=new s.ZY(0,new s.nt(1).divide(i.y)),a=t.multiply(i).subtract(.5),l=r((0,s.jc)(a).x).xyz,u=r((0,s.jc)(a).y).xyz;let c=t.add(l.x.multiply(n)),h=t.subtract(l.y.multiply(n));const d=c.add(u.x.multiply(o)),p=h.add(u.x.multiply(o));c=c.subtract(u.y.multiply(o)),h=h.subtract(u.y.multiply(o));let m=(0,s.US)(e,h),g=(0,s.US)(e,c);const f=(0,s.US)(e,p),y=(0,s.US)(e,d);return m=(0,s.jh)(m,f,u.z),g=(0,s.jh)(g,y,u.z),m=(0,s.jh)(m,g,l.z),m}},90113:(e,t,i)=>{i.d(t,{$w:()=>u,Fb:()=>o,Fz:()=>g,J5:()=>a,M:()=>h,Ni:()=>c,V5:()=>n,Xx:()=>m,YV:()=>w,au:()=>l,b5:()=>y,bB:()=>T,bg:()=>x,cZ:()=>C,cn:()=>p,eo:()=>v,kx:()=>f,os:()=>s,qM:()=>d,rp:()=>r,ti:()=>b,v9:()=>_});const s=3.14159265359/180,r=3.14159265359/128,n=1,o=1.1,a=1,l=24,u=8,c=1e-5,h=.05,d=1e-30,p=4,m=0,g=2,f=2,y=3,x=0,b=3,w=16777216,v=1.1,C=16,_=128,T=1},90321:(e,t,i)=>{function s(e,t){return e?t?4:3:t?3:2}function r(e,t,i,r){if(null===t||void 0===t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],u=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:h}=t,d=s(i,r);let p=0;for(const s of c){const e=n(u,h,p,s,i,r);e&&l.push(e),p+=s*d}if(l.sort((e,t)=>{let s=e[2]-t[2];return 0===s&&i&&(s=e[4]-t[4]),s}),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,i&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<u[0]||a[0]>u[1]||a[1]<u[2]||a[1]>u[3]||i&&(a[2]<u[4]||a[2]>u[5]))&&(a.length=0)}if(!a.length){const e=t.lengths[0]?o(h,0,c[0],i,r):null;if(!e)return null;a[0]=e[0],a[1]=e[1],i&&e.length>2&&(a[2]=e[2])}return e}function n(e,t,i,r,n,o){const a=s(n,o);let l=i,u=i+a,c=0,h=0,d=0,p=0,m=0;for(let s=0,f=r-1;s<f;s++,l+=a,u+=a){const i=t[l],s=t[l+1],r=t[l+2],o=t[u],a=t[u+1],g=t[u+2];let f=i*a-o*s;p+=f,c+=(i+o)*f,h+=(s+a)*f,n&&(f=i*g-o*r,d+=(r+g)*f,m+=f),i<e[0]&&(e[0]=i),i>e[1]&&(e[1]=i),s<e[2]&&(e[2]=s),s>e[3]&&(e[3]=s),n&&(r<e[4]&&(e[4]=r),r>e[5]&&(e[5]=r))}if(p>0&&(p*=-1),m>0&&(m*=-1),!p)return null;const g=[c,h,.5*p];return n&&(g[3]=d,g[4]=.5*m),g}function o(e,t,i,r,n){const o=s(r,n);let h=t,d=t+o,p=0,m=0,g=0,f=0;for(let s=0,y=i-1;s<y;s++,h+=o,d+=o){const t=e[h],i=e[h+1],s=e[h+2],n=e[d],o=e[d+1],y=e[d+2],x=r?l(t,i,s,n,o,y):a(t,i,n,o);if(x)if(p+=x,r){const e=c(t,i,s,n,o,y);m+=x*e[0],g+=x*e[1],f+=x*e[2]}else{const e=u(t,i,n,o);m+=x*e[0],g+=x*e[1]}}return p>0?r?[m/p,g/p,f/p]:[m/p,g/p]:i>0?r?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,i,s){const r=i-e,n=s-t;return Math.sqrt(r*r+n*n)}function l(e,t,i,s,r,n){const o=s-e,a=r-t,l=n-i;return Math.sqrt(o*o+a*a+l*l)}function u(e,t,i,s){return[e+.5*(i-e),t+.5*(s-t)]}function c(e,t,i,s,r,n){return[e+.5*(s-e),t+.5*(r-t),i+.5*(n-i)]}i.d(t,{Q:()=>r})},90356:(e,t,i)=>{i.d(t,{i:()=>s});const s={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}},91449:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ai});var s=i(89379),r=i(6326),n=i(54901),o=i(76460),a=i(50346),l=i(68134),u=i(46053),c=i(81806),h=(i(47249),i(87990)),d=i(68347),p=i(64022),m=i(23246),g=i(69539),f=i(15941),y=i(17775),x=i(52297),b=i(61229),w=i(52494),v=i(2413),C=i(28632),_=i(85827),T=i(30726),P=i(86300),S=i(59422),R=i(8794),M=i(71853);const I={bandCount:3,minOutput:0,maxOutput:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class F extends R.q{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this._textureInvalidated=!0,this._colormapTextureInvalidated=!0,this._rasterTexture=null,this._maskTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,this._colormapTexture=null,this._colormap=null,this._supportsBilinearTexture=!0,this._processedTexture=null,this._highlightTexture=null,this.functionTextures=[],this.projected=!1,this.stencilRef=0,this.coordScale=[1,1],this._processed=!1,this._highlighted=!1,this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._mask=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.source=e,this.transformGrid=t,this.interpolation=i}destroy(){super.destroy(),this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}get highlightTexture(){return this._highlightTexture}set highlightTexture(e){var t;this._highlightTexture!==e&&(null!==(t=this._highlightTexture)&&void 0!==t&&t.dispose(),this._highlightTexture=e),null==e&&(this._highlighted=!1)}get rasterTexture(){return this._rasterTexture}set rasterTexture(e){var t;this._rasterTexture!==e&&(null!==(t=this._rasterTexture)&&void 0!==t&&t.dispose(),this._rasterTexture=e),null==e&&(this.projected=!1)}get processed(){return this._processed}set processed(e){this._processed=e,e||(this.processedTexture=(0,T.WD)(this.processedTexture),this.invalidateTexture())}get highlighted(){return this._highlighted}get symbolizerParameters(){return this._symbolizerParameters||I}set symbolizerParameters(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0)}get source(){return this._source}set source(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture=(0,T.WD)(this._rasterTexture),this._rasterTextureBandIds=null),this.projected=!1,this.invalidateTexture())}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._maskTexture=(0,T.WD)(this._maskTexture))}get suspended(){return this._suspended}set suspended(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}get bandIds(){return this._bandIds}set bandIds(e){this._bandIds=e,this._isBandIdsChanged(e)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?9729:9728)}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid!==e&&(this._transformGrid=e,this._transformGridTexture=(0,T.WD)(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(){var e,t;const i=arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.projected;return[i?this.width:(null===(e=this.source)||void 0===e?void 0:e.width)||this.width,i?this.height:(null===(t=this.source)||void 0===t?void 0:t.height)||this.height]}getRasterCellSize(){var e;const t=null===(e=this.rawPixelData)||void 0===e?void 0:e.srcPixelSize,{projected:i,resolution:s}=this;return t&&!i?[t.x,t.y]:[s,s]}_createTransforms(){return{displayViewScreenMat3:(0,_.vt)()}}setTransform(e){const t=(0,P.D_)(this.transforms.displayViewScreenMat3),[i,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),r=this.resolution/this.pixelRatio/e.resolution,n=r*this.width,o=r*this.height,a=Math.PI*this.rotation/180;(0,P.Tl)(t,t,(0,S.fA)(i,s)),(0,P.Tl)(t,t,(0,S.fA)(n/2,o/2)),(0,P.e$)(t,t,-a),(0,P.Tl)(t,t,(0,S.fA)(-n/2,-o/2)),(0,P.Oe)(t,t,(0,S.fA)(n,o)),(0,P.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}getTextures(){var e;let{forProcessing:t=!1,useProcessedTexture:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=i&&null!==(e=this._processedTexture)&&void 0!==e?e:this._rasterTexture,r=[],n=[];return s?(this._transformGridTexture&&!this.projected&&(n.push(this._transformGridTexture),r.push("u_transformGrid")),n.push(s),r.push("u_image"),!this._colormapTexture||!i&&t||(n.push(this._colormapTexture),r.push("u_colormap")),this._maskTexture&&(n.push(this._maskTexture),r.push("u_mask")),{names:r,textures:n}):{names:r,textures:n}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture(e){let{context:t}=e;if(!this.stage)return void this._disposeTextures();const i=this._isValidSource(this.source);i&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(t)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(t),this._rasterTexture&&(i?(this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,M.kc)(t,this.transformGrid)),this._mask&&!this._maskTexture&&(this._maskTexture=(0,M.WL)(t,this._mask,[this.width,this.height]))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}updateProcessedTexture(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this._highlighted=null!=this.highlightTexture);const{functionTextures:e}=this;0!==e.length&&(this.processedTexture=e.shift(),e.forEach(e=>null===e||void 0===e?void 0:e.dispose()),e.length=0,this.processed=!!this.processedTexture)}_createOrDestroyRasterTexture(e){var t;const i=null===(t=this.source)||void 0===t?void 0:t.extractBands(this.bandIds);if(!this._isValidSource(i))return void(this._rasterTexture&&(this._rasterTexture=(0,T.WD)(this._rasterTexture),this._rasterTextureBandIds=null));const s=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(s)return;this._rasterTexture=(0,T.WD)(this._rasterTexture),this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!e.capabilities.textureFloatLinear;const r=this._getTextureSamplingMethod(this.interpolation),n=this.isRendereredSource;this._rasterTexture=(0,M.b4)(e,i,r,n),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}_isBandIdsChanged(e){const t=this._rasterTextureBandIds;return!(null==t&&null==e||t&&e&&t.join("")===e.join(""))}_isValidSource(e){var t;return null!=e&&(null===(t=e.pixels)||void 0===t?void 0:t.length)>0}_getTextureSamplingMethod(e){const{type:t}=this.symbolizerParameters,i="lut"===t&&!this.symbolizerParameters.isClassBreaks||"hillshade"===t||"stretch"===t&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||i||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"}_updateColormapTexture(e){const t=this._colormap,i=this.symbolizerParameters.colormap;return i?t?i.length!==t.length||i.some((e,i)=>e!==t[i])?(this._colormapTexture&&(this._colormapTexture=(0,T.WD)(this._colormapTexture)),this._colormapTexture=(0,M.hE)(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=(0,M.hE)(e,i),void(this._colormap=i)):(this._colormapTexture&&(this._colormapTexture=(0,T.WD)(this._colormapTexture)),void(this._colormap=null))}_disposeTextures(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.projected&&(this._transformGridTexture=(0,T.WD)(this._transformGridTexture)):(this._rasterTexture=(0,T.WD)(this._rasterTexture),this._colormapTexture=(0,T.WD)(this._colormapTexture),this._transformGridTexture=(0,T.WD)(this._transformGridTexture),this._maskTexture=(0,T.WD)(this._maskTexture),this._rasterTextureBandIds=null,this._colormap=null,this._colormapTextureInvalidated=!0),this._processedTexture=(0,T.WD)(this._processedTexture),this._highlightTexture=(0,T.WD)(this._highlightTexture)}}var z=i(78440);class A extends z.Y{constructor(e,t,i,s,r,n){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(e,t,i,s,r,n),this.bitmap=null,this.bitmap=new F(o,null,null),this.bitmap.coordScale=[r,n],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:(0,_.vt)(),tileMat3:(0,_.vt)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var k=i(46550),B=i(70479),D=i(90356),O=i(6951),V=i(60984),Z=i(60853);class q extends O.ZA{}(0,r.Cg)([(0,O.C5)(0,V.ZY)],q.prototype,"position",void 0);class E extends O.HS{}class U extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],U.prototype,"inputTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],U.prototype,"sumTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],U.prototype,"numOfNoDataTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],U.prototype,"numTexels",void 0);class j extends O.A{constructor(){super(...arguments),this.type="TextureStatisticsDiffShader"}vertex(e){const t=e.position;return{uv:t,glPosition:new V.Zb((0,Z.nb)(t),0,1)}}fragment(e){const{inputTexture:t,numOfNoDataTexture:i,sumTexture:s}=this.config,r=new O.mm,n=(0,V.US)(t,e.uv),o=(0,V.nP)(s,new V.Cq(0,0),new V.Ai(0)),a=(0,V.nP)(i,new V.Cq(0,0),new V.Ai(0)).r,l=this.config.numTexels.subtract(a),u=o.divide(l),c=(0,V.PM)(n.a,new V.nt(0)),h=new V.nt(1).subtract(c).multiply(n.subtract(u));return r.fragColor=h.multiply(h),r}}(0,r.Cg)([(0,O.Pi)(U)],j.prototype,"config",void 0),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(q))],j.prototype,"vertex",null),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(E))],j.prototype,"fragment",null);var G=i(90113);class L extends O.ZA{}(0,r.Cg)([(0,O.C5)(0,V.ZY)],L.prototype,"position",void 0);class N extends O.HS{}class H extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],H.prototype,"minTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],H.prototype,"maxTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],H.prototype,"sumTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],H.prototype,"numOfNoDataTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.Ai)],H.prototype,"width",void 0),(0,r.Cg)([(0,O.Pi)(V.Ai)],H.prototype,"height",void 0),(0,r.Cg)([(0,O.Pi)(V.Ai)],H.prototype,"isFirstPass",void 0);class W extends O.A{constructor(){super(...arguments),this.type="TextureStatisticsMinMaxSumShader"}vertex(e){const t=e.position;return{uv:t,glPosition:new V.Zb((0,Z.nb)(t),0,1)}}fragment(e){const t=new O.mm,{minTexture:i,maxTexture:s,sumTexture:r,numOfNoDataTexture:n}=this.config,o=e.glFragCoord.xy,a=new V.Cq(o.multiply(2)),l=new V.Ai(0),u=(0,V.nP)(i,a,l),c=(0,V.nP)(i,a.add(new V.Cq(-1,0)),l),h=(0,V.nP)(i,a.add(new V.Cq(0,-1)),l),d=(0,V.nP)(i,a.add(new V.Cq(-1,-1)),l),p=Y(Y(u,Y(c,new V.Zb(G.YV))),Y(h,Y(d,new V.Zb(G.YV)))),m=(0,V.nP)(s,a,l),g=(0,V.nP)(s,a.add(new V.Cq(-1,0)),l),f=(0,V.nP)(s,a.add(new V.Cq(0,-1)),l),y=(0,V.nP)(s,a.add(new V.Cq(-1,-1)),l),x=Q(Q(m,Q(g,new V.Zb(-G.YV))),Q(f,Q(y,new V.Zb(-G.YV)))),b=(0,V.nP)(r,a,l),w=(0,V.nP)(r,a.add(new V.Cq(-1,0)),l),v=(0,V.nP)(r,a.add(new V.Cq(0,-1)),l),C=(0,V.nP)(r,a.add(new V.Cq(-1,-1)),l),_=(0,Z.y_)($(b),$(w),$(v),$(C)),T=(0,V.nP)(n,a,l),P=(0,V.nP)(n,a.add(new V.Cq(-1,0)),l),S=(0,V.nP)(n,a.add(new V.Cq(0,-1)),l),R=(0,V.nP)(n,a.add(new V.Cq(-1,-1)),l),M=new V.nt(this.config.isFirstPass),I=(0,Z.y_)(K(T,M),K(P,M),K(S,M),K(R,M));return t.fragData0=p,t.fragData1=x,t.fragData2=_,t.fragData3=I,t}}function Y(e,t){const i=(0,V.PM)(e.a,new V.nt(0));return(0,V.jk)(e,t).multiply(new V.nt(1).subtract(i)).add(t.multiply(i))}function Q(e,t){const i=(0,V.PM)(e.a,new V.nt(0));return(0,V.T9)(e,t).multiply(new V.nt(1).subtract(i)).add(t.multiply(i))}function $(e){const t=(0,V.PM)(e.a,new V.nt(0)),i=new V.nt(1).subtract(t);return e.multiply(i)}function K(e,t){const i=(0,V.PM)(e.a,new V.nt(0)),s=new V.nt(1).subtract(t);return t.multiply(i).multiply(new V.Zb(1)).add(s.multiply(e))}(0,r.Cg)([(0,O.Pi)(H)],W.prototype,"config",void 0),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(L))],W.prototype,"vertex",null),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(N))],W.prototype,"fragment",null);class X extends O.ZA{}(0,r.Cg)([(0,O.C5)(0,V.ZY)],X.prototype,"position",void 0);class J extends O.HS{}class ee extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],ee.prototype,"minTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],ee.prototype,"maxTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],ee.prototype,"sumTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],ee.prototype,"numOfNoDataTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],ee.prototype,"diffSqTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],ee.prototype,"numTexels",void 0);class te extends O.A{constructor(){super(...arguments),this.type="TextureStatisticsStdDevShader"}vertex(e){const t=e.position;return{uv:t,glPosition:new V.Zb((0,Z.nb)(t),0,1)}}fragment(e){const t=new O.mm,{minTexture:i,maxTexture:s,numOfNoDataTexture:r,sumTexture:n,diffSqTexture:o}=this.config,a=e.glFragCoord.xy,l=new V.Cq(a),u=new V.Ai(0),c=(0,V.nP)(i,l,u),h=(0,V.nP)(s,l,u),d=(0,V.nP)(n,l,u),p=(0,V.nP)(r,l,u).r,m=(0,V.nP)(o,l,u),g=this.config.numTexels.subtract(p),f=d.divide(g),y=m.divide(g),x=(0,V.RZ)(y);return t.fragData0=c,t.fragData1=h,t.fragData2=f,t.fragData3=x,t}}(0,r.Cg)([(0,O.Pi)(ee)],te.prototype,"config",void 0),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(X))],te.prototype,"vertex",null),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(J))],te.prototype,"fragment",null);class ie extends O.ZA{}(0,r.Cg)([(0,O.C5)(0,V.ZY)],ie.prototype,"position",void 0);class se extends O.HS{}class re extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],re.prototype,"sumTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.Ai)],re.prototype,"width",void 0),(0,r.Cg)([(0,O.Pi)(V.Ai)],re.prototype,"height",void 0);class ne extends O.A{constructor(){super(...arguments),this.type="TextureStatisticsSumOfSquaredDiffShader"}vertex(e){const t=e.position;return{uv:t,glPosition:new V.Zb((0,Z.nb)(t),0,1)}}fragment(e){const t=new O.mm,{sumTexture:i}=this.config,s=e.glFragCoord.xy,r=new V.Cq(s.multiply(2)),n=new V.Ai(0),o=(0,V.nP)(i,r,n),a=(0,V.nP)(i,r.add(new V.Cq(-1,0)),n),l=(0,V.nP)(i,r.add(new V.Cq(0,-1)),n),u=(0,V.nP)(i,r.add(new V.Cq(-1,-1)),n),c=(0,Z.y_)(o,a,l,u);return t.fragData0=c,t.fragData1=new V.Zb(0),t.fragData2=new V.Zb(0),t.fragData3=new V.Zb(0),t}}(0,r.Cg)([(0,O.Pi)(re)],ne.prototype,"config",void 0),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(ie))],ne.prototype,"vertex",null),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(se))],ne.prototype,"fragment",null);var oe=i(9685),ae=i(93345),le=i(12331),ue=i(80895),ce=i(96673);const he=1048576;class de extends B.j{constructor(){super(...arguments),this.type=32,this._width=0,this._height=0,this._framebuffers=null,this._minTexture=null,this._maxTexture=null,this._sumTexture=null,this._numOfNoDataTexture=null,this._resultsFramebuffer=null,this._startFramebuffer=null,this._diffFramebuffer=null,this._scaleFbo=null,this.shaders={textureStatisticsMinMaxSum:new W,textureStatisticsSum:new ne,textureStatisticsDiff:new j,textureStatisticsStdDev:new te}}dispose(){this.shaders.textureStatisticsMinMaxSum=null,this._framebuffers&&(this._framebuffers.forEach(e=>(0,T.WD)(e)),this._framebuffers=null),(0,T.WD)(this._resultsFramebuffer),(0,T.WD)(this._startFramebuffer),(0,T.WD)(this._diffFramebuffer),(0,T.WD)(this._scaleFbo),(0,T.WD)(this._minTexture),(0,T.WD)(this._maxTexture),(0,T.WD)(this._sumTexture),(0,T.WD)(this._numOfNoDataTexture)}get minValuesTexture(){return this._minTexture||null}get maxValuesTexture(){return this._maxTexture||null}get meanValuesTexture(){var e;return(null===(e=this._resultsFramebuffer)||void 0===e?void 0:e.getColorTexture(ae.Fq))||null}get stdDevValuesTexture(){var e;return(null===(e=this._resultsFramebuffer)||void 0===e?void 0:e.getColorTexture(ae.M4))||null}get statsFbo(){return this._resultsFramebuffer}render(e,t){const{context:i,painter:r}=e;let n=t.fbo.width,o=t.fbo.height,a=t.fbo;const l=i.gl,u=i.getBoundFramebufferObject();if(n*o>he||!(0,f.r6)(n)||!(0,f.r6)(o)){const e=n/o;if(n*o>he){const t=Math.max(Math.floor(Math.sqrt(he/e)),1);n=Math.max(Math.floor(e*t),1),o=t}if((0,f.r6)(n)||(n=fe(n)),(0,f.r6)(o)||(o=fe(o)),this._scaleFbo)this._scaleFbo.resize(n,o);else{const{dataType:e,internalFormat:s}=t.fbo.getColorTexture(ae.r6).descriptor,r=null!==s&&void 0!==s?s:ae.H0.RGBA8;this._scaleFbo=me(i,n,o,e,r)}i.bindFramebuffer(this._scaleFbo),i.setViewport(0,0,n,o),r.blitTexture(i,a.getColorTexture(ae.r6),9728),a=this._scaleFbo}this._updateResources(e,a),r.setPipelineState((0,s.A)((0,s.A)({},D.i),{},{color:{write:[!0,!0,!0,!0],blendMode:"none"}}));const c=this._applyReductionPass(e);l.readBuffer(l.COLOR_ATTACHMENT3),c.copyToTexture(0,0,1,1,0,0,this._numOfNoDataTexture),l.readBuffer(l.COLOR_ATTACHMENT2),c.copyToTexture(0,0,1,1,0,0,this._sumTexture),l.readBuffer(l.COLOR_ATTACHMENT1),c.copyToTexture(0,0,1,1,0,0,this._maxTexture),l.readBuffer(l.COLOR_ATTACHMENT0),c.copyToTexture(0,0,1,1,0,0,this._minTexture);const h=t.fbo.getColorTexture(ae.r6);if(!h)throw new Error("Start buffer color texture is not available, cannot compute diff.");this._computeDiff(e,h,this._sumTexture,this._numOfNoDataTexture,n,o);const d=this._applySecondReductionPass(e,n,o).getColorTexture(ae.r6);this._computeSdtDev(e,this._minTexture,this._maxTexture,this._sumTexture,this._numOfNoDataTexture,d,n,o),i.bindFramebuffer(u),i.setViewport(0,0,t.fbo.width,t.fbo.height),i.setDrawBuffers([ae.r6]),r.setPipelineState(D.i)}_applyReductionPass(e){const{context:t,painter:i}=e,s=this.shaders.textureStatisticsMinMaxSum,r=this._framebuffers;if(null===r)throw new Error("Framebuffers are not initialized, cannot apply reduction pass.");t.setDrawBuffers([ae.r6,ae.yI,ae.Fq]);const n=this._startFramebuffer;let o=n.getColorTexture(ae.r6),a=n.getColorTexture(ae.yI),l=n.getColorTexture(ae.Fq),u=n.getColorTexture(ae.M4);const c=r;let h=0;for(const d of c){t.setViewport(0,0,d.width,d.height),t.bindFramebuffer(d),t.setClearColor(0,0,0,0),t.clear(16384);const e={shader:s,uniforms:{config:{minTexture:{texture:o,unit:1},maxTexture:{texture:a,unit:2},sumTexture:{texture:l,unit:3},numOfNoDataTexture:{texture:u,unit:4},width:d.width,height:d.height,isFirstPass:0===h?1:0}},defines:null,optionalAttributes:null,useComputeBuffer:!1};i.submitDrawMesh(t,e,i.quadMesh),o=d.getColorTexture(ae.r6),a=d.getColorTexture(ae.yI),l=d.getColorTexture(ae.Fq),u=d.getColorTexture(ae.M4),h++}return r.at(-1)}_applySecondReductionPass(e,t,i){const{context:s,painter:r}=e,n=this.shaders.textureStatisticsSum,o=this._framebuffers;if(null===o||null==this._diffFramebuffer)throw new Error("Framebuffers are not initialized, cannot apply reduction pass.");s.setDrawBuffers([ae.r6]);let a=this._diffFramebuffer.getColorTexture(ae.r6);const l=o;for(const u of l){s.setViewport(0,0,u.width,u.height),s.bindFramebuffer(u),s.setClearColor(0,0,0,0),s.clear(16384);const e={shader:n,uniforms:{config:{sumTexture:{texture:a,unit:2},width:u.width,height:u.height}},defines:null,optionalAttributes:null,useComputeBuffer:!1};r.submitDrawMesh(s,e,r.quadMesh),a=u.getColorTexture(ae.r6)}return o.at(-1)}_updateResources(e,t){const{context:i}=e,s=t.width,r=t.height;if(null===this._startFramebuffer){if(!(0,oe.C)().supportsColorBufferFloat)throw new Error("WebGL does not support color buffer float, cannot compute texture statistics.");const e=t.getColorTexture(ae.r6);if(!e)throw new Error("Input FBO does not have a color attachment 0, cannot compute texture statistics.");const n=e.descriptor,{dataType:o,internalFormat:a}=n,l=me(i,s,r,o,null!==a&&void 0!==a?a:ae.H0.RGBA8,4),u=l.getColorTexture(ae.r6),c=l.getColorTexture(ae.yI),h=l.getColorTexture(ae.Fq),d=l.getColorTexture(ae.M4);t.copyToTexture(0,0,s,r,0,0,u),t.copyToTexture(0,0,s,r,0,0,c),t.copyToTexture(0,0,s,r,0,0,h),t.copyToTexture(0,0,s,r,0,0,d),this._startFramebuffer=l,this._diffFramebuffer=me(i,s,r,ae.ld.FLOAT,ae.H0.RGBA32F),this._resultsFramebuffer=me(i,1,1,ae.ld.FLOAT,ae.H0.RGBA32F,4),this._minTexture=ge(i,1,1,ae.ld.FLOAT,ae.H0.RGBA32F),this._maxTexture=ge(i,1,1,ae.ld.FLOAT,ae.H0.RGBA32F),this._sumTexture=ge(i,1,1,ae.ld.FLOAT,ae.H0.RGBA32F),this._numOfNoDataTexture=ge(i,1,1,ae.ld.FLOAT,ae.H0.R32F)}else{const e=this._startFramebuffer;e.resize(s,r);const i=e.getColorTexture(ae.r6),n=e.getColorTexture(ae.yI),o=e.getColorTexture(ae.Fq),a=e.getColorTexture(ae.M4);t.copyToTexture(0,0,s,r,0,0,i),t.copyToTexture(0,0,s,r,0,0,n),t.copyToTexture(0,0,s,r,0,0,o),t.copyToTexture(0,0,s,r,0,0,a),this._diffFramebuffer.resize(s,r)}if(this._width===s&&this._height===r&&null!==this._framebuffers)return;const n=(this._framebuffers||[]).reverse();this._framebuffers=null,this._width=s,this._height=r,this._framebuffers=this._updateFramebuffers(i,s,r,n,4)}_updateFramebuffers(e,t,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const n=[];let o=t,a=i;for(;o>1||a>1;){const t=Math.max(1,Math.floor(o/2)),i=Math.max(1,Math.floor(a/2)),l=pe(e,t,i,s,r);n.push(l),o=t,a=i}return n.at(-1),s.forEach(e=>(0,T.WD)(e)),s.length=0,n}_computeDiff(e,t,i,s,r,n){const{context:o,painter:a}=e;o.bindFramebuffer(this._diffFramebuffer),o.setDrawBuffers([ae.r6]),o.setViewport(0,0,r,n),o.setClearColor(0,0,0,0),o.clear(16384);const l={shader:this.shaders.textureStatisticsDiff,uniforms:{config:{inputTexture:{texture:t,unit:1},sumTexture:{texture:i,unit:2},numOfNoDataTexture:{texture:s,unit:3},numTexels:r*n}},defines:null,optionalAttributes:null,useComputeBuffer:!1};a.submitDrawMesh(o,l,a.quadMesh)}_computeSdtDev(e,t,i,s,r,n,o,a){const{context:l,painter:u}=e;l.bindFramebuffer(this._resultsFramebuffer),l.setDrawBuffers([ae.r6,ae.yI,ae.Fq,ae.M4]),l.setViewport(0,0,1,1),l.setClearColor(0,0,0,0),l.clear(16384);const c={shader:this.shaders.textureStatisticsStdDev,uniforms:{config:{minTexture:{texture:t,unit:1},maxTexture:{texture:i,unit:2},sumTexture:{texture:s,unit:3},numOfNoDataTexture:{texture:r,unit:4},diffSqTexture:{texture:n,unit:5},numTexels:o*a}},defines:null,optionalAttributes:null,useComputeBuffer:!1};u.submitDrawMesh(l,c,u.quadMesh)}}function pe(e,t,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=s.pop();return void 0!==n?n.resize(t,i):n=me(e,t,i,ae.ld.FLOAT,ae.H0.RGBA32F,r),n}function me(e,t,i,s,r){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(n<1||n>4)throw new Error("Number of color attachments must be between 1 and 4.");const o=new le.H(e,ge(e,t,i,s,r));for(let a=1;a<n;a++){const n=ge(e,t,i,s,r);o.attachColorTexture(n,ae.r6+a)}return o}function ge(e,t,i,s,r){const n=new ce.R(t,i);return n.samplingMode=9728,n.wrapMode=33071,n.pixelFormat=6408,n.dataType=s,n.internalFormat=r,new ue.g(e,n)}function fe(e){const t=(0,f.yR)(e),i=t/2;return Math.abs(t-e)<Math.abs(i-e)?t:i}function ye(e,t){const i=new ce.R(e,t);return i.internalFormat=ae.H0.RGBA32F,i.samplingMode=9728,i.dataType=ae.ld.FLOAT,i.isImmutable=!0,i.wrapMode=33071,i}function xe(e,t,i){const s=ye(t,i);return new ue.g(e,s)}function be(e,t,i){const s=ye(t,i);return new le.H(e,s)}function we(e){const{symbolizerParameters:t}=e,{type:i}=t,s="lut"===i?"nearest":e.interpolation,r="bilinear"===s&&"lut"!==i&&("stretch"!==i||1===t.bandCount);return{bilinear:r,bicubic:"cubic"===s,nearestOnEdge:r}}var ve=i(81892);class Ce extends O.k2{}function _e(e,t){const{transformTexture:i,targetImageSize:s,transformSpacing:r}=t,n=(0,V.RI)(e.multiply(s)),o=new V.ZY(4,1),a=(0,V.RI)(n.divide(r)).multiply(o),l=(0,V.jc)(n.add(new V.ZY(.5,.5)).divide(r)),u=new V.Cq((0,V.Wh)(a.x),(0,V.Wh)(a.y)),c=new V.eB(l,1);return(0,V.Tk)((0,V.$5)(l.x,l.y),function(e,t,i){const s=(0,V.nP)(e,t,new V.Ai(0)),r=new V.Cq(t.x.add(1),t.y),n=(0,V.nP)(e,r,new V.Ai(0));return new V.ZY((0,V.Om)(s.rgb,i),(0,V.Om)(n.rgb,i))}(i,u,c),function(e,t,i){const s=new V.Cq(t.x.add(2),t.y),r=(0,V.nP)(e,s,new V.Ai(0)),n=new V.Cq(t.x.add(3),t.y),o=(0,V.nP)(e,n,new V.Ai(0));return new V.ZY((0,V.Om)(r.rgb,i),(0,V.Om)(o.rgb,i))}(i,u,c))}function Te(e,t){return t?arguments.length>2&&void 0!==arguments[2]&&arguments[2]?function(e,t){const i=(0,V.US)(t.transformTexture,e);return new V.ZY(i.r,i.g)}(e,t):_e(e,t):e}function Pe(e,t,i){const{bicubic:s=!1,bilinear:r=!1,nearestOnEdge:n=!1}=null!==i&&void 0!==i?i:{};return s||r?s?(0,ve.r)(t.texture,e,t.srcImageSize):function(e,t,i,s){const r=(0,V.RI)(t.multiply(i)),n=new V.Cq(new V.Ai(r.x),new V.Ai(r.y)),o=new V.Cq(n.x.add(1),n.y),a=new V.Cq(n.x,n.y.add(1)),l=new V.Cq(n.x.add(1),n.y.add(1)),u=(0,V.nP)(e,n,new V.Ai(0)),c=(0,V.nP)(e,o,new V.Ai(0)),h=(0,V.nP)(e,a,new V.Ai(0)),d=(0,V.nP)(e,l,new V.Ai(0)),p=(0,V.jc)(t.multiply(i)),m=(0,V.jh)(u,c,p.x),g=(0,V.jh)(h,d,p.x),f=(0,V.jh)(m,g,p.y);if(!s)return f;const y=new V.Zb(u.a,c.a,h.a,d.a),x=y.xy.multiply(y.zw),b=(0,V.RI)(x.x.multiply(x.y).add(.5)),w=f.multiply(b),v=(0,Z.zb)(b).multiply((0,V.US)(e,t));return w.add(v)}(t.texture,e,t.srcImageSize,n):(0,V.US)(t.texture,e)}(0,r.Cg)([(0,O.Pi)(V.z7)],Ce.prototype,"transformTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Ce.prototype,"targetImageSize",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Ce.prototype,"transformSpacing",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Ce.prototype,"transformGridSize",void 0);class Se extends O.ZA{}(0,r.Cg)([(0,O.C5)(0,V.ZY)],Se.prototype,"position",void 0);class Re extends O.HS{}class Me extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],Me.prototype,"texture",void 0),(0,r.Cg)([(0,O.Pi)(V.U)],Me.prototype,"dvsMat3",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Me.prototype,"coordScale",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Me.prototype,"srcImageSize",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Me.prototype,"opacity",void 0);class Ie extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],Ie.prototype,"maskTexture",void 0);class Fe extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],Fe.prototype,"highlightTexture",void 0);class ze extends O.A{constructor(){super(...arguments),this.applyProjection=!0,this.lookupProjection=!1,this.bilinear=!1,this.bicubic=!1,this.nearestOnEdge=!1,this.applyPixelMask=!1,this.applyPixelHighlights=!1}vertex(e){const t=e.position,{dvsMat3:i,coordScale:s}=this.config,r=i.multiply(new V.eB(t.multiply(s),1));return{uv:t,glPosition:new V.Zb(r,1)}}fragment(e){const t=new O.mm,i=Te(e.uv,this.applyProjection?this.projectionConfig:void 0,this.lookupProjection);let s=this._colorize(i,e.uv);this.applyPixelHighlights&&(s=this._highlightPixels(e.uv,s));const r=(0,V.Tk)(function(e){const t=(0,V.PM)(new V.ZY(-1e-5,-1e-5),e).multiply((0,V.PM)(e,new V.ZY(1.00001,1.00001))),i=(0,Z.zb)(t.x.multiply(t.y));return new V.x(i)}(i),new V.Zb(0),s);let n=r.a.multiply(this.config.opacity);if(this.applyPixelMask){const t=this._getPixelMask(e.uv);n=n.multiply(t)}return t.fragColor=new V.Zb(r.rgb,1).multiply(n),t}_getPixel(e){const{config:t,bicubic:i,bilinear:s,nearestOnEdge:r}=this;return Pe(e,t,{bicubic:i,bilinear:s,nearestOnEdge:r})}_getPixelMask(e){const{maskTexture:t}=this.pixelMaskConfig,i=(0,V.US)(t,e);return(0,V._S)(i.a)}_highlightPixels(e,t){const{highlightTexture:i}=this.highlightConfig,s=(0,V.US)(i,e),r=(0,V._S)(s.a);return(0,V.jh)(t,s,r)}}(0,r.Cg)([O.E8],ze.prototype,"applyProjection",void 0),(0,r.Cg)([O.E8],ze.prototype,"lookupProjection",void 0),(0,r.Cg)([O.E8],ze.prototype,"bilinear",void 0),(0,r.Cg)([O.E8],ze.prototype,"bicubic",void 0),(0,r.Cg)([O.E8],ze.prototype,"nearestOnEdge",void 0),(0,r.Cg)([O.E8],ze.prototype,"applyPixelMask",void 0),(0,r.Cg)([O.E8],ze.prototype,"applyPixelHighlights",void 0),(0,r.Cg)([(0,O.Pi)(Me)],ze.prototype,"config",void 0),(0,r.Cg)([(0,O.uK)(Ce)],ze.prototype,"projectionConfig",void 0),(0,r.Cg)([(0,O.uK)(Ie)],ze.prototype,"pixelMaskConfig",void 0),(0,r.Cg)([(0,O.uK)(Fe)],ze.prototype,"highlightConfig",void 0),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(Se))],ze.prototype,"vertex",null),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(Re))],ze.prototype,"fragment",null);class Ae extends O.k2{}function ke(e,t,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const{colormapTexture:r,colormapOffset:n,colormapMaxIndex:o}=i,a=e.r.multiply(t).subtract(n),l=(0,V.qE)(a,new V.nt(0),o),u=new V.ZY(l.add(.5).divide(o.add(1)),0),c=(0,V.US)(r,u),h=new V.Zb(c.rgb,c.a.multiply(e.a));if(s)return h;const d=(0,V.PM)(new V.nt(0),a).multiply((0,V.PM)(a,i.colormapMaxIndex));return h.multiply(d)}(0,r.Cg)([(0,O.Pi)(V.z7)],Ae.prototype,"colormapTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Ae.prototype,"colormapOffset",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Ae.prototype,"colormapMaxIndex",void 0);class Be extends ze{constructor(){super(...arguments),this.type="RasterColorizerLUTShader"}_colorize(e){return ke(this._getPixel(e),new V.nt(1),this.colormapConfig,!1)}}function De(e){const t=new V.Zb(0,-1/3,2/3,-1),i=(0,V.Tk)((0,V.Xe)(e.y,e.z),new V.Zb(e.zy,t.wz),new V.Zb(e.yz,t.xy)),s=(0,V.Tk)((0,V.Xe)(e.x,i.x),new V.Zb(i.xyw,e.x),new V.Zb(e.x,i.yzx)),r=s.x.subtract((0,V.jk)(s.w,s.y)),n=new V.nt(1e-10),o=s.w.subtract(s.y),a=r.multiply(6).add(n),l=(0,V.tn)(o.divide(a).add(s.z)),u=s.x.add(n),c=(0,V.jk)(r.divide(u),new V.nt(1));return new V.eB(l,c,s.x)}function Oe(e){const t=new V.Zb(1,2/3,1/3,3),i=(0,V.tn)((0,V.jc)(e.xxx.add(t.xyz)).multiply(6).subtract(t.www)),s=(0,V.qE)(i.subtract(t.xxx),new V.eB(0,0,0),new V.eB(1));return e.z.multiply((0,V.jh)(t.xxx,s,e.y))}(0,r.Cg)([(0,O.Pi)(Ae)],Be.prototype,"colormapConfig",void 0);class Ve extends O.k2{}function Ze(e){const t=(0,V.tn)(e),i=(0,V.PM)(t,new V.ZY(1,1)).multiply(t),s=new V.nt(2).subtract(t),r=(0,V.PM)(new V.nt(1),t).multiply(s);return i.add(r)}function qe(e,t,i){const s=new V.nt(1).divide(i),r=(0,V.US)(e,Ze(s.multiply(new V.ZY(-1,-1)).add(t))),n=(0,V.US)(e,Ze(s.multiply(new V.ZY(0,-1)).add(t))),o=(0,V.US)(e,Ze(s.multiply(new V.ZY(1,-1)).add(t))),a=(0,V.US)(e,Ze(s.multiply(new V.ZY(-1,0)).add(t))),l=(0,V.US)(e,Ze(t)),u=(0,V.US)(e,Ze(s.multiply(new V.ZY(1,0)).add(t))),c=(0,V.US)(e,Ze(s.multiply(new V.ZY(-1,1)).add(t))),h=(0,V.US)(e,Ze(s.multiply(new V.ZY(0,1)).add(t))),d=(0,V.US)(e,Ze(s.multiply(new V.ZY(1,1)).add(t))),p=new V.Zb(r.a,n.a,o.a,a.a),m=new V.Zb(u.a,c.a,h.a,d.a),g=p.multiply(m),f=g.xy.multiply(g.zw),y=f.x.multiply(f.y).multiply(l.a),x=new V.My(new V.nt(0),10);return x[0]=r.r,x[1]=n.r,x[2]=o.r,x[3]=a.r,x[4]=l.r,x[5]=u.r,x[6]=c.r,x[7]=h.r,x[8]=d.r,x[9]=y,x}function Ee(e,t){const i=new V.Zb(e[5],e[3],e[7],e[1]).multiply(2),s=new V.eB(e[2],i[0],e[8]),r=new V.eB(e[0],i[1],e[6]),n=(0,V.Om)(s.subtract(r),new V.eB(1)),o=new V.eB(e[6],i[2],e[8]),a=new V.eB(e[0],i[3],e[2]),l=(0,V.Om)(o.subtract(a),new V.eB(1));return new V.ZY(n,l).multiply(t)}function Ue(e,t,i){const{factor:s}=t,r=Ee(e,s),n=(0,V.RZ)((0,V.Om)(r,r).add(1)),o=e[9],{sinZsinAs:a,sinZcosAs:l,cosZs:u,weights:c}=t;if(!i){const e=je({sinZsinA:a[0],sinZcosA:l[0],cosZ:u[0],weights:new V.nt(1),dzxy:r,dzd:n});return new V.Zb(e,e,e,o)}const h=je({sinZsinA:new V.eB(a[0],a[1],a[2]),sinZcosA:new V.eB(l[0],l[1],l[2]),cosZ:new V.eB(u[0],u[1],u[2]),weights:new V.eB(c[0],c[1],c[2]),dzxy:r,dzd:n}),d=je({sinZsinA:new V.eB(a[3],a[4],a[5]),sinZcosA:new V.eB(l[3],l[5],l[5]),cosZ:new V.eB(u[3],u[4],u[5]),weights:new V.eB(c[3],c[4],c[5]),dzxy:r,dzd:n}),p=(0,V.Om)(h.add(d),new V.eB(1));return new V.Zb(p,p,p,o)}function je(e){const t=e.sinZsinA.multiply(e.dzxy.y),i=e.sinZcosA.multiply(e.dzxy.x),s=t.subtract(i),r=e.cosZ.add(s).divide(e.dzd);return r.multiply((0,V.PM)(new V.nt(0),r)).multiply(e.weights)}function Ge(e,t){const{pixelSizeFactor:i}=e,s=[e.factor[0]/t[0],e.factor[1]/t[1]];if(i>0){const{zFactor:r,pixelSizePower:n,gcsFactor:o}=e,a=t[0]*o,l=t[1]*o;s[0]=(r+a**n*i)/(8*a),s[1]=(r+l**n*i)/(8*l)}return s}(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,6))],Ve.prototype,"sinZcosAs",void 0),(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,6))],Ve.prototype,"sinZsinAs",void 0),(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,6))],Ve.prototype,"cosZs",void 0),(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,6))],Ve.prototype,"weights",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Ve.prototype,"minValue",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Ve.prototype,"maxValue",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Ve.prototype,"factor",void 0);class Le extends ze{constructor(){super(...arguments),this.type="RasterColorizerShadedReliefShader",this.applyColormap=!1,this.isMultidirectional=!1}_colorize(e){const{texture:t}=this.config,i=Ue(qe(t,e,this.config.srcImageSize),this.hillshadeConfig,this.isMultidirectional);if(!this.applyColormap)return new V.Zb(i.x,i.x,i.x,i.a);const{minValue:s,maxValue:r}=this.hillshadeConfig,n=this._getPixel(e),o=r.subtract(s),a=n.r.subtract(s),l=(0,V.qE)(a.divide(o),new V.nt(0),new V.nt(1)),u=ke(new V.Zb(l,l,l,1),new V.nt(255),this.colormapConfig),c=De(u.xyz),h=Oe(new V.eB(c.xy,i.x));return new V.Zb(h,u.a.multiply(i.a))}}function Ne(e){const t=(0,V._S)(e),i=e.add((0,V.tn)(t).subtract(1));return t.multiply(t).divide(i)}function He(e){return new V.Zb((0,V.RI)(e.rgb.add(.5)),e.a)}function We(e,t){return(0,V.PM)(t.x,e).multiply((0,V.PM)(e,t.y))}(0,r.Cg)([O.E8],Le.prototype,"applyColormap",void 0),(0,r.Cg)([O.E8],Le.prototype,"isMultidirectional",void 0),(0,r.Cg)([(0,O.Pi)(Ve)],Le.prototype,"hillshadeConfig",void 0),(0,r.Cg)([(0,O.uK)(Ae)],Le.prototype,"colormapConfig",void 0);class Ye extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.nt)],Ye.prototype,"minOutput",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Ye.prototype,"maxOutput",void 0),(0,r.Cg)([(0,O.Pi)(V.eB)],Ye.prototype,"minCutOff",void 0),(0,r.Cg)([(0,O.Pi)(V.eB)],Ye.prototype,"maxCutOff",void 0),(0,r.Cg)([(0,O.Pi)(V.eB)],Ye.prototype,"factor",void 0),(0,r.Cg)([(0,O.Pi)(V.eB)],Ye.prototype,"gamma",void 0),(0,r.Cg)([(0,O.Pi)(V.eB)],Ye.prototype,"gammaCorrection",void 0);class Qe extends O.k2{}function $e(e,t){const{minCutOff:i,maxCutOff:s,factor:r,minOutput:n}=t;return(0,V.qE)(e,i,s).subtract(i).multiply(r).add(n)}function Ke(e,t){const{minCutOff:i,maxCutOff:s,minOutput:r,maxOutput:n,gamma:o,gammaCorrection:a}=t,l=(0,V.qE)(e,i,s).subtract(i),u=s.subtract(i),c=l.divide(u),h=(0,V.PM)(new V.nt(1),o),d=(0,V._S)(o.subtract(1)),p=n.subtract(r),m=new V.eB(1),g=(0,V.n7)(m.divide(p),c.multiply(a)),f=(0,Z.zb)(h.multiply(d).multiply(g)),y=(0,V.n7)(c,m.divide(o)),x=f.multiply(p).multiply(y).add(r);return(0,V.qE)(x,r,n)}function Xe(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;const r=i?Ke(e.rgb,t).divide(s):$e(e.rgb,t);return new V.Zb(r,e.a)}(0,r.Cg)([(0,O.Pi)(V.z7)],Qe.prototype,"minTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],Qe.prototype,"maxTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],Qe.prototype,"meanTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],Qe.prototype,"stddevTexture",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Qe.prototype,"numberOfStandardDeviations",void 0);class Je extends ze{constructor(){super(...arguments),this.type="RasterColorizerStretchShader",this.isMultiband=!0,this.applyColormap=!1,this.useGamma=!1,this.noOp=!1,this.draStretchType=0}_colorize(e){const t=this._getPixel(e);if(this.noOp)return t;const{draStretchType:i,stretchConfig:r,useGamma:n,statisticsConfig:o}=this;let a=0===i?Xe(t,r,n):function(e,t,i,r,n){const o=new V.Cq(0,0),a=new V.Ai(0);let l=(0,V.nP)(i.minTexture,o,a).rgb,u=(0,V.nP)(i.maxTexture,o,a).rgb;if(n){const e=(0,V.nP)(i.meanTexture,o,a).rgb,t=(0,V.nP)(i.stddevTexture,o,a).rgb.multiply(i.numberOfStandardDeviations);l=(0,V.T9)(l,e.subtract(t)),u=(0,V.jk)(u,e.add(t))}const c=u.subtract(l),h=new V.eB(Ne(c.x),Ne(c.y),Ne(c.z)),d=t.maxOutput.subtract(t.minOutput).multiply(h),p=(0,s.A)((0,s.A)({},t),{},{minCutOff:l,maxCutOff:u,factor:d}),m=r?Ke(e.rgb,p).divide(255):$e(e.rgb,p);return new V.Zb(m,e.a)}(t,r,o,n,2===i);if(this.isMultiband)return a;if(a=new V.Zb(a.rrr,a.a),this.applyColormap){const e=this.useGamma?255:1;a=ke(a,new V.nt(e),this.colormapConfig)}return a}}(0,r.Cg)([O.E8],Je.prototype,"isMultiband",void 0),(0,r.Cg)([O.E8],Je.prototype,"applyColormap",void 0),(0,r.Cg)([O.E8],Je.prototype,"useGamma",void 0),(0,r.Cg)([O.E8],Je.prototype,"noOp",void 0),(0,r.Cg)([O.E8],Je.prototype,"draStretchType",void 0),(0,r.Cg)([(0,O.Pi)(Ye)],Je.prototype,"stretchConfig",void 0),(0,r.Cg)([(0,O.uK)(Ae)],Je.prototype,"colormapConfig",void 0),(0,r.Cg)([(0,O.uK)(Qe)],Je.prototype,"statisticsConfig",void 0);const et=new Set(["f32","f64","u16","s16","u32","s32"]);class tt extends B.j{constructor(){super(...arguments),this.name="BrushRasterColorizer",this.type=0,this.shaders={lut:new Be,stretch:new Je,shadedRelief:new Le},this._mosaicFbo=null,this._statisticsTechnique=null,this._draTimer=0}shutdown(e){super.shutdown(e),this._mosaicFbo=(0,T.WD)(this._mosaicFbo),this._statisticsTechnique=(0,T.WD)(this._statisticsTechnique)}render(e,t){const i=t.bitmaps.some(it);i||(this._mosaicFbo=(0,T.WD)(this._mosaicFbo),this._statisticsTechnique=(0,T.WD)(this._statisticsTechnique));const s=i?this._computeStatisticsTextures(e,t):void 0;for(const r of t.bitmaps){if(!r.source||r.suspended)continue;e.timeline.begin(this.name);const{painter:t}=e;t.setPipelineState({depth:!1,stencil:{test:{mask:255,compare:514,op:{fail:7680,zFail:7680,zPass:7680}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"composite"}}),r.updateTexture(e),r.updateProcessedTexture();const{type:i}=r.symbolizerParameters,n="stretch"===i?this._getStretchOptions(r,s):"lut"===i?this._getLutOptions(r):this._getShadedReliefOptions(r);"bilinear"!==r.interpolation||e.context.capabilities.textureFloatLinear||(n.defines.bilinear=!0),t.submitDrawMesh(e.context,n,t.quadMesh,r),e.timeline.end(this.name)}}_computeStatisticsTextures(e,t){var i;null!==(i=this._statisticsTechnique)&&void 0!==i||(this._statisticsTechnique=new de);const s=this._statisticsTechnique;let r=(0,c.A)("esri-2d-dra-delay");if(null==r){const e=t.bitmaps.find(it),{stretchType:i,bandCount:s}=e.symbolizerParameters,{pixelType:n}=e.source;"minMax"===i&&s>=3&&et.has(n)&&(r=160)}if(r){const i=performance.now();(i-this._draTimer>=r||e.stationary||!s.minValuesTexture)&&(this._mosaic(e,t),s.render(e,{fbo:this._mosaicFbo}),this._draTimer=i)}else this._mosaic(e,t),s.render(e,{fbo:this._mosaicFbo});return{minTexture:s.minValuesTexture,maxTexture:s.maxValuesTexture,meanTexture:s.meanValuesTexture,stddevTexture:s.stdDevValuesTexture}}_mosaic(e,t){const{context:i,painter:s}=e,r=i.getBoundFramebufferObject();if(this._mosaicFbo)this._mosaicFbo.resize(r.width,r.height);else{const e=function(e,t,i){const s=new ce.R(t,i);return s.internalFormat=ae.H0.RGBA32F,s.samplingMode=9728,s.dataType=ae.ld.FLOAT,s.wrapMode=33071,new ue.g(e,s)}(i,r.width,r.height);this._mosaicFbo=new le.H(i,e)}i.bindFramebuffer(this._mosaicFbo);const n="RasterColorizerMosaic";for(const o of t.bitmaps){if(!it(o))continue;e.timeline.begin(n),s.setPipelineState({depth:!1,stencil:{test:{mask:255,compare:514,op:{fail:7680,zFail:7680,zPass:7680}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"composite"}});const t=o.interpolation;o.interpolation="nearest",o.updateTexture(e),o.updateProcessedTexture();const i=this._getStretchOptions(o);i.defines.noOp=!0,s.submitDrawMesh(e.context,i,s.quadMesh,o),o.interpolation=t,e.timeline.end(n)}i.bindFramebuffer(r)}_getLutOptions(e){const{config:t,projectionConfig:i,colormapConfig:r,pixelMaskConfig:n,highlightConfig:o,projectionDefines:a}=this._getCommonConfig(e),l=we(e);return{shader:this.shaders.lut,uniforms:{projectionConfig:i,config:t,colormapConfig:r,pixelMaskConfig:n,highlightConfig:o},defines:(0,s.A)((0,s.A)((0,s.A)({},a),l),{},{applyPixelMask:!!n,applyPixelHighlights:!!o}),optionalAttributes:null,useComputeBuffer:!1}}_getStretchOptions(e,t){const i=e.symbolizerParameters,{config:r,projectionConfig:n,colormapConfig:o,pixelMaskConfig:a,highlightConfig:l,projectionDefines:u,textureUnit:c}=this._getCommonConfig(e),h=we(e),d=t?{minTexture:{texture:t.minTexture,unit:c},maxTexture:{texture:t.maxTexture,unit:c+1},meanTexture:{texture:t.meanTexture,unit:c+2},stddevTexture:{texture:t.stddevTexture,unit:c+3},numberOfStandardDeviations:i.numberOfStandardDeviations||2}:void 0,p=t?"standardDeviation"===i.stretchType?2:1:0;return{shader:this.shaders.stretch,uniforms:{projectionConfig:n,config:r,stretchConfig:i,colormapConfig:o,pixelMaskConfig:a,highlightConfig:l,statisticsConfig:d},defines:(0,s.A)((0,s.A)((0,s.A)({},u),h),{},{isMultiband:i.bandCount>1,applyColormap:!!o,useGamma:i.useGamma,noOp:e.isRendereredSource&&!e.processed,applyPixelMask:!!a,applyPixelHighlights:!!l,draStretchType:p}),optionalAttributes:null,useComputeBuffer:!1}}_getShadedReliefOptions(e){const t=e.symbolizerParameters,{config:i,projectionConfig:r,colormapConfig:n,pixelMaskConfig:o,highlightConfig:a,projectionDefines:l}=this._getCommonConfig(e),u=we(e);return{shader:this.shaders.shadedRelief,uniforms:{projectionConfig:r,config:i,hillshadeConfig:t,colormapConfig:n,pixelMaskConfig:o,highlightConfig:a},defines:(0,s.A)((0,s.A)((0,s.A)({},l),u),{},{isMultidirectional:t.hillshadeType>0,applyColormap:!!n,applyPixelMask:!!o,applyPixelHighlights:!!a}),optionalAttributes:null,useComputeBuffer:!1}}_getCommonConfig(e){const{coordScale:t,computedOpacity:i,transforms:s}=e,{names:r,textures:n}=e.getTextures({useProcessedTexture:e.processed}),o=n[r.indexOf("u_image")],a=e.getRasterTextureSize();let l=0;const u={texture:{texture:o,unit:l++},dvsMat3:s.displayViewScreenMat3,coordScale:t,srcImageSize:a,opacity:i},c=n[r.indexOf("u_transformGrid")],{transformGrid:h}=e,d=!(!c||!h),p=d?{transformTexture:{texture:c,unit:l++},targetImageSize:[e.width,e.height],transformSpacing:h.spacing,transformGridSize:h.size}:void 0,m=n[r.indexOf("u_colormap")],{colormap:g,colormapOffset:f}=e.symbolizerParameters,y=m&&g?{colormapTexture:{texture:m,unit:l++},colormapOffset:null!==f&&void 0!==f?f:0,colormapMaxIndex:g.length/4-1}:void 0,x=n[r.indexOf("u_mask")],b=x?{maskTexture:{texture:x,unit:l++}}:void 0,{highlightTexture:w}=e;return{config:u,projectionConfig:p,colormapConfig:y,pixelMaskConfig:b,highlightConfig:w?{highlightTexture:{texture:w,unit:l++}}:void 0,projectionDefines:{applyProjection:d,lookupProjection:d&&1===h.spacing[0]},textureUnit:l}}}function it(e){return!e.suspended&&null!=e.source&&!e.isRendereredSource&&"stretch"===e.symbolizerParameters.type&&!!e.symbolizerParameters.dynamicRangeAdjustment}var st=i(5095);class rt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,2*w.et))],rt.prototype,"ranges",void 0),(0,r.Cg)([(0,O.Pi)(V.U)],rt.prototype,"bandSwap",void 0),(0,r.Cg)([(0,O.Pi)(V.Zb)],rt.prototype,"color",void 0);class nt extends ze{constructor(){super(...arguments),this.type="RasterRangeHighlightShader",this.hasExistingHighlights=!1}_colorize(e,t){const i=this._getPixel(e),{ranges:s,color:r,bandSwap:n}=this.rangeHighlightConfig,o=function(e,t){let i=new V.eB(0,0,0);const s=new V.eB(e);for(let r=0;r<w.et/3;r++){const e=6*r,n=new V.eB(t[e],t[e+2],t[e+4]),o=new V.eB(t[e+1],t[e+3],t[e+5]);i=i.add((0,V.PM)(n,s).multiply((0,V.PM)(s,o)))}return(0,V._S)((0,V.Om)(i,new V.eB(1,1,1)))}(n.multiply(i.rgb).x,s).multiply((0,V._S)(i.a)),a=(0,V.jh)(new V.Zb(0),r,o);if(this.hasExistingHighlights){const{highlightTexture:e}=this.highlightConfig,i=(0,V.US)(e,t);return(0,V.jh)(i,a,o)}return a}}(0,r.Cg)([O.E8],nt.prototype,"hasExistingHighlights",void 0),(0,r.Cg)([(0,O.Pi)(rt)],nt.prototype,"rangeHighlightConfig",void 0);class ot extends B.j{constructor(){super(...arguments),this.name="BrushRasterHighlight",this.type=2,this.shaders={range:new nt}}shutdown(e){var t;super.shutdown(e),null!==(t=this._fbo)&&void 0!==t&&t.dispose(),this._fbo=void 0}render(e,t){const{context:i}=e;if(!this._fbo){const t=at(e.context,st.CQ,st.CQ);this._fbo=new le.H(i,t)}const r=i.getBoundFramebufferObject(),n=i.getViewport(),{pixelHighlightOptions:o}=e;for(const l of t.bitmaps){var a;if(!o||!l.source||l.highlighted||l.suspended||l.isRendereredSource)continue;const t=null!==(a=l.bandIds)&&void 0!==a&&a.length?l.bandIds.indexOf(o.bandId):0;if(t<0||t>2)continue;e.timeline.begin(this.name);const{painter:r}=e;r.setPipelineState({depth:!1,stencil:{test:!1,write:!1},color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0}}}),l.updateTexture(e),l.updateProcessedTexture(!1);const{config:n,projectionConfig:u,highlightConfig:c,projectionDefines:h}=this._getCommonConfig(l),d=we(l);"bilinear"!==l.interpolation||e.context.capabilities.textureFloatLinear||(d.bilinear=!0);const p=new Float32Array(9);p[3*t]=1;const m=(0,s.A)((0,s.A)({},o),{},{bandSwap:p}),g={shader:this.shaders.range,uniforms:{projectionConfig:u,config:n,rangeHighlightConfig:m,highlightConfig:c},defines:(0,s.A)((0,s.A)((0,s.A)({},h),d),{},{applyPixelMask:!1,applyPixelHighlights:!1,hasExistingHighlights:!!c}),optionalAttributes:null,useComputeBuffer:!1};i.bindFramebuffer(this._fbo),i.setViewport(0,0,st.CQ,st.CQ),r.submitDrawMesh(e.context,g,r.quadMesh);const f=at(e.context,st.CQ,st.CQ);this._fbo.copyToTexture(0,0,st.CQ,st.CQ,0,0,f),l.highlightTexture=f,e.timeline.end(this.name)}i.bindFramebuffer(r),i.setViewport(n.x,n.y,n.width,n.height)}_getCommonConfig(e){const{names:t,textures:i}=e.getTextures({forProcessing:!0,useProcessedTexture:e.processed}),s=i[t.indexOf("u_image")],r=e.getRasterTextureSize(),n={texture:{texture:s,unit:0},dvsMat3:new Float32Array([2,0,0,0,2,0,-1,-1,0]),coordScale:[1,1],srcImageSize:r,opacity:1},o=i[t.indexOf("u_transformGrid")],{transformGrid:a}=e,l=!(!o||!a),u=l?{transformTexture:{texture:o,unit:1},targetImageSize:[e.width,e.height],transformSpacing:a.spacing,transformGridSize:a.size}:void 0,{highlightTexture:c}=e;return{config:n,projectionConfig:u,highlightConfig:c?{highlightTexture:{texture:c,unit:2}}:void 0,projectionDefines:{applyProjection:l,lookupProjection:l&&1===a.spacing[0]}}}}function at(e,t,i){const s=new ce.R(t,i);return s.internalFormat=ae.H0.RGBA8,s.samplingMode=9728,s.dataType=ae.ld.UNSIGNED_BYTE,s.isImmutable=!0,s.wrapMode=33071,new ue.g(e,s)}class lt extends B.j{shutdown(e){var t;super.shutdown(e),null!==(t=this._fbo)&&void 0!==t&&t.dispose(),this._fbo=void 0}render(e,t){const{rasterFunction:i}=e;if(!i)return;const{context:s}=e,r="indexedColormap"in i.parameters?(0,M.hE)(s,i.parameters.indexedColormap):void 0,n="Reproject"===i.name,o=s.getBoundFramebufferObject(),a=s.getViewport();for(const u of t.bitmaps){const o=n?!(u.rasterTexture&&u.projected):!u.processed;if(!u.source||!o||u.suspended)continue;e.timeline.begin(this.name);const{painter:a}=e;a.setPipelineState({depth:!1,stencil:{test:!1,write:!1},color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0}}}),n||(u.processedTexture=(0,T.WD)(u.processedTexture)),u.updateTexture(e);const[c,h]=u.getRasterTextureSize(n),d=c===st.CQ&&h===st.CQ,p=d?t.processorFbo:be(s,c,h);s.bindFramebuffer(p),s.setViewport(0,0,p.width,p.height),this._process(e,u,r);const m=xe(e.context,c,h);if(p.copyToTexture(0,0,c,h,0,0,m),n)u.rasterTexture=m;else{var l;const t=e.hasBranches?i.id:0;null!==(l=u.functionTextures[t])&&void 0!==l&&l.dispose(),u.functionTextures[t]=m}d||p.dispose(),e.timeline.end(this.name)}null!==r&&void 0!==r&&r.dispose(),s.bindFramebuffer(o),s.setViewport(a.x,a.y,a.width,a.height)}_getCommonConfig(e,t){var i,s,r,n;const{rasterFunction:o,hasBranches:a}=e,{raster:l,rasters:u}=o.parameters,c=a?null!==(i=null!==(s=null===l||void 0===l?void 0:l.id)&&void 0!==s?s:null===u||void 0===u||null===(r=u.find(e=>"Constant"!==e.name))||void 0===r?void 0:r.id)&&void 0!==i?i:-1:0,h=null!==(n=t.functionTextures[c])&&void 0!==n?n:t.rasterTexture,d="Reproject"===o.name;return{texture:{texture:h,unit:0},srcImageSize:t.getRasterTextureSize(d)}}_getMultipleInputConfig(e,t){return null!==t&&void 0!==t&&t.length?2===t.length?{twoRasterConfig:this._getTwoInputConfig(t,e)}:3===t.length?{threeRasterConfig:this._getThreeInputConfig(t,e)}:{}:{}}_getConstantCount(e){var t;return null!==(t=null===e||void 0===e?void 0:e.filter(e=>"Constant"===e.name).length)&&void 0!==t?t:0}_getTextures(e,t){return e.filter(e=>"Constant"!==e.name).map(e=>null!=e.id&&"Identity"!==e.name?t.functionTextures[e.id]:t.rasterTexture)}_getTwoInputConfig(e,t){const i=this._getTextures(e,t),s=i[1]?{texture:i[1],unit:1}:void 0,r=e.findIndex(e=>"Constant"===e.name),n=0===r?new Float32Array([0,1,0,1,0,0,0,0,0]):new Float32Array([1,0,0,0,1,0,0,0,0]);return{image1:s,image1Const:r>-1?e[r].parameters.value:0,imageSwap:n}}_getThreeInputConfig(e,t){const i=this._getTextures(e,t);let s=0,r=0,n=new Float32Array([1,0,0,0,1,0,0,0,1]);const o=i[1]?{texture:i[1],unit:1}:void 0,a=i[2]?{texture:i[2],unit:2}:void 0,l=[];if(e.forEach((e,t)=>"Constant"===e.name&&l.push(t)),1===l.length)s=e[l[0]].parameters.value,n=0===l[0]?new Float32Array([0,1,0,0,0,1,1,0,0]):1===l[0]?new Float32Array([1,0,0,0,0,1,0,1,0]):new Float32Array([1,0,0,0,1,0,0,0,1]);else if(2===l.length){s=e[l[0]].parameters.value,r=e[l[1]].parameters.value;const t=e.findIndex(e=>"Constant"!==e.name);n=0===t?new Float32Array([1,0,0,0,1,0,0,0,1]):1===t?new Float32Array([0,1,0,1,0,0,0,0,1]):new Float32Array([0,0,1,1,0,0,0,1,0])}return{image1:o,image2:a,image1Const:s,image2Const:r,imageSwap:n}}}class ut extends O.ZA{}(0,r.Cg)([(0,O.C5)(0,V.ZY)],ut.prototype,"position",void 0);class ct extends O.HS{}class ht extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],ht.prototype,"texture",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],ht.prototype,"srcImageSize",void 0);class dt extends O.A{vertex(e){return{uv:e.position,glPosition:new V.Zb((0,Z.nb)(e.position),0,1)}}fragment(e){const t=new O.mm,i=Te(e.uv),s=this._process(i);return t.fragColor=new V.Zb(s.rgb,1).multiply(s.a),t}_getPixel(e){return Pe(e,this.config)}}(0,r.Cg)([(0,O.Pi)(ht)],dt.prototype,"config",void 0),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(ut))],dt.prototype,"vertex",null),(0,r.Cg)([(0,r.Qj)(0,(0,O.hF)(ct))],dt.prototype,"fragment",null);class pt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.ZY)],pt.prototype,"cellSize",void 0);class mt extends dt{constructor(){super(...arguments),this.type="AspectShader"}_process(e){const{texture:t}=this.config,i=qe(t,e,this.config.srcImageSize),s=new V.ZY(1).divide(this.aspectConfig.cellSize.multiply(8)),{x:r,y:n}=Ee(i,s),o=(0,V.ze)(n),a=i[9].multiply((0,V._S)((0,V.tn)(r).add((0,V.tn)(o)))),l=(0,V.tn)((0,V._S)(r)),u=new V.nt(3.14159265359),c=new V.nt(0),h=(0,V.PM)(c,o).multiply(.5).multiply(u).add((0,V.PM)(o,c).multiply(1.5).multiply(u)),d=(0,V.zi)(new V.nt(2.5).multiply(u).add((0,V.rY)(o,(0,V.ze)(r))),new V.nt(2).multiply(u)),p=(0,V.jh)(h,d,l).multiply(180).divide(u);return new V.Zb(p,p,p,a)}}(0,r.Cg)([(0,O.Pi)(pt)],mt.prototype,"aspectConfig",void 0);class gt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.U)],gt.prototype,"bandIndexMat3",void 0);class ft extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.eB)],ft.prototype,"adjustments",void 0);class yt extends dt{constructor(){super(...arguments),this.type="BandArithmeticShader",this.isOutputRounded=!1}_process(e){const t=this._getPixel(e),i=this.bandArithmeticConfig.bandIndexMat3.multiply(t.rgb),s=this._processIndex(i),r=new V.Zb(s,s,s,t.a);return this.isOutputRounded?He(r):r}_processIndex(e){var t;const{r:i,g:s}=e,r=null===(t=this.adjustmentConfig)||void 0===t?void 0:t.adjustments;switch(this.indexType){case"ndxi":{const e=i.subtract(s),t=i.add(s);return e.multiply(Ne(t))}case"sr":return i.multiply(Ne(s));case"ci":return i.multiply(Ne(s)).subtract(1);case"savi":{const{x:e}=r,t=i.subtract(s),n=i.add(s).add(e);return t.multiply(Ne(n)).multiply(e.add(1))}case"tsavi":{const{x:e,y:t,z:n}=r,o=n.multiply(e.multiply(e).add(1)).subtract(t.multiply(e)),a=e.multiply(i.subtract(e.multiply(s)).subtract(t)),l=t.multiply(i).add(s).add(o);return a.multiply(Ne(l))}case"msavi":{const e=i.multiply(2).add(1),t=e.multiply(e).subtract(i.subtract(s).multiply(8));return e.subtract((0,V.RZ)(t)).multiply(.5)}case"gemi":{const e=i.multiply(i).subtract(s.multiply(s)).multiply(2).add(i.multiply(1.5)).add(s.multiply(.5)),t=i.add(s).add(.5),r=e.multiply(Ne(t)),n=r.multiply((0,Z.zb)(r.multiply(.25))),o=s.subtract(.125).multiply(Ne((0,Z.zb)(s)));return n.subtract(o)}case"pvi":{const{x:e,y:t}=r,n=(0,V.RZ)(e.multiply(e).add(1));return i.subtract(s.multiply(e)).subtract(t).multiply(Ne(n))}case"vari":{const t=e.g.subtract(e.r),i=e.g.add(e.r).subtract(e.b);return t.multiply(Ne(i))}case"rtvicore":return i.subtract(s).multiply(100).subtract(i.subtract(e.b).multiply(10));case"bai":{const e=(0,V.n7)(new V.nt(.1).subtract(s),new V.nt(2)),t=(0,V.n7)(new V.nt(.06).subtract(i),new V.nt(2));return Ne(e.add(t))}case"evi":{const t=e.b,r=i.add(s.multiply(6)).subtract(t.multiply(7.5)).add(1);return i.subtract(s).multiply(2.5).multiply(Ne(r))}case"wndwi":{const{r:t,g:i,b:s}=e,n=r.x,o=n.multiply(i),a=n.multiply(s),l=t.add(o).add(s).subtract(a);return t.subtract(o).subtract(s).add(a).multiply(Ne(l))}case"mtvi":{const t=e.b,r=(0,V.n7)(i.multiply(2).add(1),new V.nt(2)),n=i.multiply(6).subtract((0,V.RZ)(s).multiply(5)),o=(0,V.RZ)(r.subtract(n).subtract(.5)),a=i.subtract(t).multiply(1.2),l=s.subtract(t).multiply(2.5);return a.subtract(l).multiply(1.5).multiply(Ne(o))}default:return i}}}(0,r.Cg)([O.E8],yt.prototype,"indexType",void 0),(0,r.Cg)([O.E8],yt.prototype,"isOutputRounded",void 0),(0,r.Cg)([(0,O.Pi)(gt)],yt.prototype,"bandArithmeticConfig",void 0),(0,r.Cg)([(0,O.uK)(ft)],yt.prototype,"adjustmentConfig",void 0);class xt extends dt{constructor(){super(...arguments),this.type="ColormapToRGBShader"}_process(e){const t=ke(this._getPixel(e),new V.nt(1),this.colormapConfig,!1);return new V.Zb(t.xyz.multiply(255),t.a)}}(0,r.Cg)([(0,O.Pi)(Ae)],xt.prototype,"colormapConfig",void 0);class bt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],bt.prototype,"image1",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],bt.prototype,"image1Const",void 0),(0,r.Cg)([(0,O.Pi)(V.U)],bt.prototype,"imageSwap",void 0);class wt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.z7)],wt.prototype,"image1",void 0),(0,r.Cg)([(0,O.Pi)(V.z7)],wt.prototype,"image2",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],wt.prototype,"image1Const",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],wt.prototype,"image2Const",void 0),(0,r.Cg)([(0,O.Pi)(V.U)],wt.prototype,"imageSwap",void 0);const vt=e=>{const t=e;class i extends t{constructor(){super(...arguments),this.constantCount=0,this.imageCount=1}_getRasterValues(e){const{imageCount:t}=this;if(1===t){const t=(0,V.US)(this.config.texture,e);return{a:t.r,b:t.g,c:t.b,alpha:t.a}}if(2===t){const t=this._getTwoValues(e);return{a:t.a,b:t.b,c:t.b,alpha:t.alpha}}return this._getThreeValues(e)}_getTwoValues(e){const t=(0,V.US)(this.config.texture,e);if(1===this.constantCount){const{imageSwap:e,image1Const:i}=this.twoRasterConfig,s=e.multiply(new V.eB(t.r,i,0));return{a:s.x,b:s.y,alpha:t.a}}const{image1:i}=this.twoRasterConfig,s=(0,V.US)(i,e);return{a:t.r,b:s.r,alpha:t.a.multiply(s.a)}}_getThreeValues(e){const t=(0,V.US)(this.config.texture,e),{imageSwap:i,image1:s,image2:r,image1Const:n,image2Const:o}=this.threeRasterConfig;if(2===this.constantCount){const e=i.multiply(new V.eB(t.r,n,o));return{a:e.x,b:e.y,c:e.z,alpha:t.a}}if(1===this.constantCount){const r=(0,V.US)(s,e),o=i.multiply(new V.eB(t.r,r.r,n));return{a:o.x,b:o.y,c:o.z,alpha:t.a.multiply(r.a)}}const a=(0,V.US)(s,e),l=(0,V.US)(r,e);return{a:t.r,b:a.r,c:l.r,alpha:t.a.multiply(a.a).multiply(l.a)}}}return(0,r.Cg)([O.E8],i.prototype,"constantCount",void 0),(0,r.Cg)([O.E8],i.prototype,"imageCount",void 0),(0,r.Cg)([(0,O.uK)(bt)],i.prototype,"twoRasterConfig",void 0),(0,r.Cg)([(0,O.uK)(wt)],i.prototype,"threeRasterConfig",void 0),i};class Ct extends(vt(dt)){constructor(){super(...arguments),this.type="CompositeBandShader"}_process(e){const{a:t,b:i,c:s,alpha:r}=this._getRasterValues(e);return new V.Zb(t,i,s,r)}}class _t extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.ZY)],_t.prototype,"domainRange",void 0);class Tt extends(vt(dt)){constructor(){super(...arguments),this.type="LocalShader",this.isOutputRounded=!1}_process(e){if("conditional"===this.operationName)return this._conditional(e);const{a:t,b:i,alpha:s}=this._getRasterValues(e),{value:r,alpha:n}=this._compute(t,i,s);return this._processResult(r,n)}_processResult(e,t){const i=We(e,this.domainRangeConfig.domainRange),s=new V.Zb(e,e,e,t).multiply(i);return this.isOutputRounded?He(s):s}_compute(e,t,i){const{operationName:s}=this;let r;switch(s){case"plus":r=e.add(t);break;case"minus":r=e.subtract(t);break;case"times":r=e.multiply(t);break;case"divide":case"floatdivide":r=e.multiply(Ne(t)),i=i.multiply((0,V.fV)((0,V.tn)((0,V._S)(t))));break;case"floordivide":r=(0,V.RI)(e.multiply(Ne(t))),i=i.multiply((0,V.fV)((0,V.tn)((0,V._S)(t))));break;case"square":r=e.multiply(e);break;case"sqrt":r=(0,V.RZ)(e);break;case"power":r=(0,V.n7)(e,t);break;case"ln":r=(0,V.Tk)((0,V.MM)(e,new V.nt(0)),(0,V.Rm)(e),new V.nt(0)),i=i.multiply(this._isAboveZero(e));break;case"log10":r=(0,V.Tk)((0,V.MM)(e,new V.nt(0)),(0,V.p6)(e).multiply(Ne((0,V.p6)(new V.nt(10)))),new V.nt(0)),i=i.multiply(this._isAboveZero(e));break;case"log2":r=(0,V.Tk)((0,V.MM)(e,new V.nt(0)),(0,V.p6)(e),new V.nt(0)),i=i.multiply(this._isAboveZero(e));break;case"exp":r=(0,V.oN)(e);break;case"exp10":r=(0,V.n7)(new V.nt(10),e);break;case"exp2":r=(0,V.n7)(new V.nt(2),e);break;case"rounddown":r=(0,V.RI)(e);break;case"roundup":r=(0,V.mk)(e);break;case"int":r=(0,V._S)(e).multiply((0,V.RI)((0,V.tn)(e)));break;case"mod":r=(0,V.zi)(e,t);break;case"negate":r=(0,V.ze)(e);break;case"abs":r=(0,V.tn)(e);break;case"acos":{const t=this._isAbsBiggerThanOne(e);r=(0,V.Tk)(t,new V.nt(0),(0,V.HQ)(e)),i=(0,V.Tk)(t,new V.nt(0),i);break}case"acosh":r=(0,V.YN)(e);break;case"asin":{const t=this._isAbsBiggerThanOne(e);r=(0,V.Tk)(t,new V.nt(0),(0,V.qR)(e)),i=(0,V.Tk)(t,new V.nt(0),i);break}case"asinh":r=(0,V.yH)(e);break;case"atan":r=(0,V.rY)(e);break;case"atanh":{const t=this._isAbsBiggerThanOne(e);r=(0,V.Tk)(t,new V.nt(0),(0,V.rf)(e)),i=(0,V.Tk)(t,new V.nt(0),i);break}case"atan2":r=(0,V.rY)(e,t);break;case"cos":r=(0,V.gn)(e);break;case"cosh":r=(0,V.yI)(e);break;case"sin":r=(0,V.F8)(e);break;case"sinh":r=(0,V.L0)(e);break;case"tan":r=(0,V.Ml)(e);break;case"tanh":r=(0,V.ym)(e);break;case"bitwiseand":r=new V.nt((0,V.nf)(new V.Ai(e),new V.Ai(t)));break;case"bitwiseor":r=new V.nt((0,V.pu)(new V.Ai(e),new V.Ai(t)));break;case"bitwiseleftshift":r=new V.nt((0,V.wH)(new V.Ai(e),new V.Ai(t)));break;case"bitwiserightshift":r=new V.nt((0,V.Sj)(new V.Ai(e),new V.Ai(t)));break;case"bitwisenot":r=new V.nt((0,V.FM)(new V.Ai(e)));break;case"bitwisexor":r=new V.nt((0,V.hC)(new V.Ai(e),new V.Ai(t)));break;case"booleanand":r=(0,V.fV)((0,V.Uo)((0,V.Ec)(e,new V.nt(0)),(0,V.Ec)(t,new V.nt(0))));break;case"booleanor":r=(0,V.fV)((0,V.or)((0,V.Ec)(e,new V.nt(0)),(0,V.Ec)(t,new V.nt(0))));break;case"booleannot":r=(0,V.fV)((0,V.LC)(e,new V.nt(0)));break;case"booleanxor":r=(0,V.fV)((0,V.I8)((0,V.Ec)(e,new V.nt(0)),(0,V.Ec)(t,new V.nt(0))));break;case"greaterthan":r=(0,V.fV)((0,V.MM)(e,t));break;case"greaterthanequal":r=(0,V.fV)((0,V.aX)(e,t));break;case"lessthan":r=(0,V.fV)((0,V.Xe)(e,t));break;case"lessthanequal":r=(0,V.fV)((0,V.$5)(e,t));break;case"equalto":r=(0,V.fV)((0,V.LC)(e,t));break;case"notequal":r=(0,V.fV)((0,V.Ec)(e,t));break;case"isnull":r=(0,V.fV)((0,V.LC)(i,new V.nt(0))),i=new V.nt(1);break;case"setnull":{const s=(0,V.fV)((0,V.LC)(e,new V.nt(0)));r=s.multiply(t),i=i.multiply(s);break}default:r=e}return{value:r,alpha:i}}_conditional(e){const{a:t,b:i,c:s,alpha:r}=this._getRasterValues(e),n=new V.nt((0,V.tn)((0,V._S)(t))),o=(0,V.jh)(s,i,n);return this._processResult(o,r)}_isAboveZero(e){return(0,V.fV)((0,V.MM)(e,new V.nt(0)))}_isAbsBiggerThanOne(e){return(0,V.MM)((0,V.tn)(e),new V.nt(1))}}(0,r.Cg)([O.E8],Tt.prototype,"operationName",void 0),(0,r.Cg)([O.E8],Tt.prototype,"isOutputRounded",void 0),(0,r.Cg)([(0,O.Pi)(_t)],Tt.prototype,"domainRangeConfig",void 0);class Pt extends(vt(dt)){constructor(){super(...arguments),this.type="ComputeChangeShader",this.isOutputRounded=!1}_process(e){const{a:t,b:i,alpha:s}=this._getRasterValues(e);let r=t.subtract(i);"relative-difference"===this.method&&(r=r.multiply(Ne((0,V.T9)((0,V.tn)(t),(0,V.tn)(i)))));const n=We(r,this.domainRangeConfig.domainRange),o=new V.Zb(r,r,r,s).multiply(n);return this.isOutputRounded?He(o):o}}(0,r.Cg)([O.E8],Pt.prototype,"method",void 0),(0,r.Cg)([O.E8],Pt.prototype,"isOutputRounded",void 0),(0,r.Cg)([(0,O.Pi)(_t)],Pt.prototype,"domainRangeConfig",void 0);class St extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.nt)],St.prototype,"contrastOffset",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],St.prototype,"brightnessOffset",void 0);class Rt extends dt{constructor(){super(...arguments),this.type="ContrastBrightnessShader"}_process(e){const{rgb:t,a:i}=this._getPixel(e),{contrastOffset:s,brightnessOffset:r}=this.contrastBrightnessConfig,n=new V.nt(255),o=new V.nt(128),a=t.multiply(200),l=n.multiply(100),u=n.multiply(2).multiply(r),c=a.subtract(l).add(u),h=(0,V.j1)([(0,V.LC)(s,new V.nt(-100)),new V.eB(o)],[(0,V.LC)(s,new V.nt(100)),(0,V._S)(c).add(1).divide(2).multiply(n)],[(0,V.MM)(s,new V.nt(0)),c.divide(new V.nt(100).subtract(s).multiply(2)).add(o)],[!0,c.multiply(s.add(100)).divide(2e4).add(o)]);return He(new V.Zb(h,i))}}(0,r.Cg)([(0,O.Pi)(St)],Rt.prototype,"contrastBrightnessConfig",void 0);class Mt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V._i.ofType(V.nt,5,5,!0))],Mt.prototype,"kernel",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Mt.prototype,"clampRange",void 0);class It extends dt{constructor(){super(...arguments),this.type="ConvolutionShader",this.rows=3,this.cols=3}_process(e){const{rows:t,cols:i}=this,s=new V.ZY(Math.floor(t/2),Math.floor(i/2)),{texture:r,srcImageSize:n}=this.config,o=new V.nt(1).divide(n),{kernel:a}=this.convolutionConfig,l=(0,V.$T)(a,{initialValue:new V.Zb(0,0,0,1),xRange:[0,t],yRange:[0,i],callback:(t,i,n,a)=>{const l=new V.ZY(new V.nt(n),new V.nt(a)).subtract(s).multiply(o),u=(0,V.US)(r,Ze(e.add(l))),c=u.rgb.multiply(i).add(t.rgb),h=u.a.multiply(t.a);return new V.Zb(c,h)}}),{clampRange:u}=this.convolutionConfig;return new V.Zb((0,V.qE)(l.rgb,u.x,u.y),1).multiply(l.a)}}(0,r.Cg)([O.E8],It.prototype,"rows",void 0),(0,r.Cg)([O.E8],It.prototype,"cols",void 0),(0,r.Cg)([(0,O.Pi)(Mt)],It.prototype,"convolutionConfig",void 0);class Ft extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.nt)],Ft.prototype,"zlFactor",void 0);class zt extends dt{constructor(){super(...arguments),this.type="CurvatureShader"}_process(e){const{texture:t}=this.config,i=qe(t,e,this.config.srcImageSize),s=i[3].add(i[5]).multiply(.5).subtract(i[4]),r=i[1].add(i[7]).multiply(.5).subtract(i[4]),{zlFactor:n}=this.curvatureConfig,{curvatureType:o}=this;let a;if("standard"===o)a=(0,V.ze)(n).multiply(s.add(r));else{const e=i[2].subtract(i[0]).add(i[6]).subtract(i[8]).divide(4),t=i[5].subtract(i[3]).divide(2),l=i[1].subtract(i[7]).divide(2),u=t.multiply(t),c=l.multiply(l),h=t.multiply(l),d=n.divide(u.add(c));a="profile"===o?(0,V.Om)(new V.eB(s,r,e),new V.eB(u,c,h)).multiply(d):(0,V.Om)(new V.eB(s,r,(0,V.ze)(e)),new V.eB(c,u,h)).multiply((0,V.ze)(d))}return new V.Zb(a,a,a,i[9])}}(0,r.Cg)([O.E8],zt.prototype,"curvatureType",void 0),(0,r.Cg)([(0,O.Pi)(Ft)],zt.prototype,"curvatureConfig",void 0);class At extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.U)],At.prototype,"bandIndexMat3",void 0);class kt extends dt{constructor(){super(...arguments),this.type="ExtractBandShader"}_process(e){const t=this._getPixel(e),i=this.extractBandConfig.bandIndexMat3.multiply(t.rgb);return new V.Zb(i,t.a)}}(0,r.Cg)([(0,O.Pi)(At)],kt.prototype,"extractBandConfig",void 0);class Bt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.ZY)],Bt.prototype,"clampRange",void 0);class Dt extends dt{constructor(){super(...arguments),this.type="FocalStatisticsShader",this.rows=3,this.cols=3,this.fill=!1}_process(e){const t=this._process1(e),i=(0,V.PM)(new V.nt(1),t.a);if(!this.fill)return this._clamp(t.rgb,i);const s=this._getPixel(e),r=(0,V.jh)(t.rgb,s.rgb,s.a);return this._clamp(r,i)}_clamp(e,t){const{clampRange:i}=this.focalStatisticsConfig;return new V.Zb((0,V.qE)(e,i.x,i.y),1).multiply(t)}_process1(e){const{texture:t,srcImageSize:i}=this.config,{rows:s,cols:r}=this,n=new V.ZY(Math.floor(s/2),Math.floor(r/2)),o=new V.nt(1).divide(i),a=this._getPixel(e),{statisticsType:l}=this,u="min"===l||"max"===l?new V.Zb(a.rgb,0):new V.Zb(0,0,0,0);switch(l){case"min":return this._stat(s,r,u,(i,s,r)=>{const a=new V.ZY(new V.nt(s),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,Ze(e.add(a))),u=(0,V.jk)(i.rgb,l.rgb);return new V.Zb(u,i.a.add(l.a))});case"max":return this._stat(s,r,u,(i,s,r)=>{const a=new V.ZY(new V.nt(s),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,Ze(e.add(a))),u=(0,V.T9)(i.rgb,l.rgb);return new V.Zb(u,i.a.add(l.a))});case"mean":{const i=this._stat(s,r,u,(i,s,r)=>{const a=new V.ZY(new V.nt(s),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,Ze(e.add(a))),u=i.rgb.add(l.rgb.multiply(l.a));return new V.Zb(u,i.a.add(l.a))}),a=i.rgb.multiply(Ne(i.a));return new V.Zb(a,i.a)}case"stddev":{const i=this._stat(s,r,u,(i,s,r)=>{const a=new V.ZY(new V.nt(s),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,Ze(e.add(a))),u=i.rgb.add(l.rgb.multiply(l.a));return new V.Zb(u,i.a.add(l.a))}),a=this._stat(s,r,u,(i,s,r)=>{const a=new V.ZY(new V.nt(s),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,Ze(e.add(a))),u=i.rgb.add(l.a.multiply(l.rgb).multiply(l.rgb));return new V.Zb(u,i.a.add(l.a))}),l=Ne(a.a),c=(0,V.RZ)(a.subtract(i.multiply(i).multiply(l)).multiply(l));return new V.Zb(c.rgb,i.a)}default:return a}}_stat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;const r=new V.Ai(0).setMutable().setDebugName("StatColIterator"),n=new V.Ai(0).setMutable().setDebugName("StatRowIterator"),o=i.setMutable().setDebugName("StatAccumulator"),a=s(o,r,n).setDebugName("StatPredicate"),l=(0,V.om)({iterX:r,iterY:n,accumulator:o},V.Zb,a,i=>{let{out:s,iterX:r,iterY:n,accumulator:o,subgraph:a}=i;return"\n  for (".concat(n," = 0; ").concat(n," < ").concat(e,"; ").concat(n,"++) {\n    for (").concat(r," = 0; ").concat(r," < ").concat(t,"; ").concat(r,"++) {\n  \n    ").concat(a.body,"\n  \n    ").concat(o," = ").concat(a.varName,";\n    }\n  }\n  ").concat(s," = ").concat(o,";\n  ")}).setDebugName("statBody");return l}}(0,r.Cg)([O.E8],Dt.prototype,"rows",void 0),(0,r.Cg)([O.E8],Dt.prototype,"cols",void 0),(0,r.Cg)([O.E8],Dt.prototype,"statisticsType",void 0),(0,r.Cg)([O.E8],Dt.prototype,"fill",void 0),(0,r.Cg)([(0,O.Pi)(Bt)],Dt.prototype,"focalStatisticsConfig",void 0);class Ot extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.eB)],Ot.prototype,"weights",void 0);class Vt extends dt{constructor(){super(...arguments),this.type="GrayscaleShader"}_process(e){const t=this._getPixel(e),{weights:i}=this.grayscaleConfig,s=(0,V.Om)(i,t.rgb);return new V.Zb(s,s,s,t.a)}}(0,r.Cg)([(0,O.Pi)(Ot)],Vt.prototype,"grayscaleConfig",void 0);class Zt extends dt{constructor(){super(...arguments),this.type="HillshadeShader",this.isMultidirectional=!1}_process(e){const{texture:t}=this.config,i=Ue(qe(t,e,this.config.srcImageSize),this.hillshadeConfig,this.isMultidirectional);return new V.Zb(i.rgb.multiply(255),i.a)}}(0,r.Cg)([O.E8],Zt.prototype,"isMultidirectional",void 0),(0,r.Cg)([(0,O.Pi)(Ve)],Zt.prototype,"hillshadeConfig",void 0);class qt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,6))],qt.prototype,"includedRanges",void 0),(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,w.et))],qt.prototype,"noDataValues",void 0);class Et extends dt{constructor(){super(...arguments),this.type="MaskShader",this.isMultiband=!0}_process(e){const t=this._getPixel(e),i=this._computeNoDataFactor(t.r),s=this._computeRangeFactor(t.rgb);let r;if(this.isMultiband){const e=this._computeNoDataFactor(t.g),n=this._computeNoDataFactor(t.b),o=new V.eB(i,e,n).multiply(s);r=o.x.multiply(o.y).multiply(o.z)}else r=i.multiply(s.x);return t.multiply(r)}_computeNoDataFactor(e){const{noDataValues:t}=this.maskConfig;let i=new V.eB(1);for(let s=0;s<w.et/3;s++){const r=3*s,n=new V.eB(t[r+0],t[r+1],t[r+2]),o=(0,V.tn)((0,V._S)(n.subtract(e)));i=i.multiply(o)}return i.x.multiply(i.y).multiply(i.z)}_computeRangeFactor(e){const{includedRanges:t}=this.maskConfig,i=new V.eB(t[0],t[2],t[4]),s=new V.eB(t[1],t[3],t[5]);return(0,V.PM)(i,e).multiply((0,V.PM)(e,s))}}(0,r.Cg)([O.E8],Et.prototype,"isMultiband",void 0),(0,r.Cg)([(0,O.Pi)(qt)],Et.prototype,"maskConfig",void 0);class Ut extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.U)],Ut.prototype,"bandIndexMat3",void 0);class jt extends dt{constructor(){super(...arguments),this.type="NDVIShader",this.scaled=!0}_process(e){const t=this._getPixel(e),{r:i,g:s}=this.ndviConfig.bandIndexMat3.multiply(t.rgb),r=i.subtract(s),n=i.add(s),o=r.multiply(Ne(n));if(!this.scaled)return new V.Zb(o,o,o,t.a);const a=(0,V.RI)(o.multiply(100).add(100.5));return new V.Zb(a,a,a,t.a)}}(0,r.Cg)([O.E8],jt.prototype,"scaled",void 0),(0,r.Cg)([(0,O.Pi)(Ut)],jt.prototype,"ndviConfig",void 0);class Gt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,3*w.et))],Gt.prototype,"rangeMaps",void 0),(0,r.Cg)([(0,O.Pi)(V.My.ofType(V.nt,2*w.et))],Gt.prototype,"noDataRanges",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Gt.prototype,"unmatchMask",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Gt.prototype,"replacementValue",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Gt.prototype,"clampRange",void 0);class Lt extends dt{constructor(){super(...arguments),this.type="RemapShader"}_process(e){const t=this._getPixel(e),{rangeMaps:i,unmatchMask:s,clampRange:r,replacementValue:n}=this.remapConfig,{mapValue:o,includeMask:a}=function(e,t,i){const s=new V.eB(e);let r=new V.eB(0,0,0),n=new V.nt(0);for(let o=0;o<i/3;o++){const e=9*o,i=new V.eB(t[e],t[e+3],t[e+6]),a=new V.eB(t[e+1],t[e+4],t[e+7]),l=(0,V.PM)(i,s).multiply((0,V.PM)(s,a)),u=new V.eB(t[e+2],t[e+5],t[e+8]);n=(0,V.jh)(n,u.x,l.x),n=(0,V.jh)(n,u.y,l.y),n=(0,V.jh)(n,u.z,l.z),r=r.add(l)}return{mapValue:n,includeMask:(0,V._S)((0,V.Om)(r,new V.eB(1,1,1)))}}(t.r,i,w.et),l=this.replaceUnmatched?n:s.multiply(t.r),u=(0,V.jh)(l,o,a),c=(0,V.qE)(u,r.x,r.y),h=this._computeNoDataFactor(t.rrr).multiply((0,V.T9)(s,a));return new V.Zb(c,c,c,t.a).multiply(h)}_computeNoDataFactor(e){const{noDataRanges:t}=this.remapConfig;let i=new V.eB(0,0,0);for(let s=0;s<w.et/3;s++){const r=6*s,n=new V.eB(t[r],t[r+2],t[r+4]),o=new V.eB(t[r+1],t[r+3],t[r+5]);i=i.add((0,V.PM)(n,e).multiply((0,V.PM)(e,o)))}return(0,Z.zb)((0,V._S)((0,V.Om)(i,new V.eB(1,1,1))))}}(0,r.Cg)([(0,O.Pi)(Gt)],Lt.prototype,"remapConfig",void 0),(0,r.Cg)([O.E8],Lt.prototype,"replaceUnmatched",void 0);class Nt extends ze{constructor(){super(...arguments),this.type="ReprojectShader"}_colorize(e){return this._getPixel(e)}}class Ht extends Zt{constructor(){super(...arguments),this.type="ShadedReliefShader"}_process(e){const t=super._process(e),{minValue:i,maxValue:s}=this.hillshadeConfig,r=this._getPixel(e),n=s.subtract(i),o=r.r.subtract(i),a=(0,V.qE)(o.divide(n),new V.nt(0),new V.nt(1)),l=ke(new V.Zb(a,a,a,1),new V.nt(255),this.colormapConfig),u=De(l.xyz),c=Oe(new V.eB(u.xy,t.x.divide(255))).multiply(255);return new V.Zb(c,l.a.multiply(t.a))}}(0,r.Cg)([(0,O.Pi)(Ae)],Ht.prototype,"colormapConfig",void 0);class Wt extends O.k2{}(0,r.Cg)([(0,O.Pi)(V.nt)],Wt.prototype,"pixelSizePower",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Wt.prototype,"pixelSizeFactor",void 0),(0,r.Cg)([(0,O.Pi)(V.nt)],Wt.prototype,"zFactor",void 0),(0,r.Cg)([(0,O.Pi)(V.ZY)],Wt.prototype,"cellSize",void 0);class Yt extends dt{constructor(){super(...arguments),this.type="SlopeShader",this.isOutputRounded=!1,this.percentRise=!1}_process(e){const{cellSize:t,pixelSizePower:i,pixelSizeFactor:s,zFactor:r}=this.slopeConfig,n=(0,V.n7)(t,new V.ZY(i)).multiply(s).add(r).divide(t.multiply(8)),{texture:o}=this.config,a=qe(o,e,this.config.srcImageSize),{x:l,y:u}=Ee(a,n),c=(0,V.RZ)(l.multiply(l).add(u.multiply(u))),h=this.percentRise?c.multiply(100):(0,V.rY)(c).multiply(57.2957795),d=new V.Zb(h,h,h,a[9]);return this.isOutputRounded?He(d):d}}(0,r.Cg)([O.E8],Yt.prototype,"isOutputRounded",void 0),(0,r.Cg)([O.E8],Yt.prototype,"percentRise",void 0),(0,r.Cg)([(0,O.Pi)(Wt)],Yt.prototype,"slopeConfig",void 0);class Qt extends dt{constructor(){super(...arguments),this.type="StretchShader",this.isMultiband=!0,this.isOutputRounded=!1,this.useGamma=!1}_process(e){let t=Xe(this._getPixel(e),this.stretchConfig,this.useGamma,1);return this.isMultiband||(t=new V.Zb(t.rrr,t.a)),this.isOutputRounded?He(t):t}}(0,r.Cg)([O.E8],Qt.prototype,"isMultiband",void 0),(0,r.Cg)([O.E8],Qt.prototype,"isOutputRounded",void 0),(0,r.Cg)([O.E8],Qt.prototype,"useGamma",void 0),(0,r.Cg)([(0,O.Pi)(Ye)],Qt.prototype,"stretchConfig",void 0);const $t=new Map([["Aspect",class extends lt{constructor(){super(...arguments),this.name="RasterAspectProcessor",this.type=3,this.shaders={aspect:new mt}}_process(e,t){const i={cellSize:t.getRasterCellSize()},s=this._getCommonConfig(e,t),r={shader:this.shaders.aspect,uniforms:{config:s,aspectConfig:i},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["BandArithmetic",class extends lt{constructor(){super(...arguments),this.name="RasterBandArithmeticProcessor",this.type=4,this.shaders={bandArithmetic:new yt}}_process(e,t){const i=e.rasterFunction.parameters,s={indexType:i.indexType,isOutputRounded:i.isOutputRounded},r={bandIndexMat3:i.bandIndexMat3},n=i.adjustments?{adjustments:[...i.adjustments]}:void 0,o=this._getCommonConfig(e,t),a={shader:this.shaders.bandArithmetic,uniforms:{config:o,bandArithmeticConfig:r,adjustmentConfig:n},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:u}=e;l.submitDrawMesh(u,a,l.quadMesh)}}],["ColormapToRGB",class extends lt{constructor(){super(...arguments),this.name="RasterColormapToRGBProcessor",this.type=5,this.shaders={colormapToRGB:new xt}}_process(e,t,i){const s=e.rasterFunction.parameters,r={colormapTexture:{texture:i,unit:1},colormapOffset:s.offset,colormapMaxIndex:s.indexedColormap.length/4-1},n=this._getCommonConfig(e,t),o={shader:this.shaders.colormapToRGB,uniforms:{config:n,colormapConfig:r},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["CompositeBand",class extends lt{constructor(){super(...arguments),this.name="RasterCompositeBandProcessor",this.type=6,this.shaders={compositeBand:new Ct}}_process(e,t){var i;const{rasters:r}=e.rasterFunction.parameters,n={constantCount:this._getConstantCount(r),imageCount:null!==(i=null===r||void 0===r?void 0:r.length)&&void 0!==i?i:1},o=this._getMultipleInputConfig(t,r),a=this._getCommonConfig(e,t),l={shader:this.shaders.compositeBand,uniforms:(0,s.A)({config:a},o),defines:n,optionalAttributes:null,useComputeBuffer:!1},{painter:u,context:c}=e;u.submitDrawMesh(c,l,u.quadMesh)}}],["ComputeChange",class extends lt{constructor(){super(...arguments),this.name="RasterComputeChangeProcessor",this.type=7,this.shaders={computeChange:new Pt}}_process(e,t){const i=e.rasterFunction.parameters,{rasters:s}=i,r={constantCount:this._getConstantCount(s),imageCount:s.length,method:i.method,isOutputRounded:i.isOutputRounded},n={domainRange:i.domainRange},{twoRasterConfig:o}=this._getMultipleInputConfig(t,s),a=this._getCommonConfig(e,t),l={shader:this.shaders.computeChange,uniforms:{config:a,domainRangeConfig:n,twoRasterConfig:o},defines:r,optionalAttributes:null,useComputeBuffer:!1},{painter:u,context:c}=e;u.submitDrawMesh(c,l,u.quadMesh)}}],["ContrastBrightness",class extends lt{constructor(){super(...arguments),this.name="RasterContrastBrightnessProcessor",this.type=8,this.shaders={contrastBrightness:new Rt}}_process(e,t){const i=this._getCommonConfig(e,t),s=e.rasterFunction.parameters,r={shader:this.shaders.contrastBrightness,uniforms:{config:i,contrastBrightnessConfig:s},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["Convolution",class extends lt{constructor(){super(...arguments),this.name="RasterConvolutionProcessor",this.type=9,this.shaders={convolution:new It}}_process(e,t){const i=e.rasterFunction.parameters,s={rows:i.kernelRows,cols:i.kernelCols},r={kernel:[...i.kernel],clampRange:i.clampRange},n=this._getCommonConfig(e,t),o={shader:this.shaders.convolution,uniforms:{config:n,convolutionConfig:r},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Curvature",class extends lt{constructor(){super(...arguments),this.name="RasterCurvatureProcessor",this.type=10,this.shaders={curvature:new zt}}_process(e,t){const i=e.rasterFunction.parameters,s={curvatureType:i.curvatureType},r=t.getRasterCellSize(),n={zlFactor:200*i.zFactor/r[0]/r[1]},o=this._getCommonConfig(e,t),a={shader:this.shaders.curvature,uniforms:{config:o,curvatureConfig:n},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:u}=e;l.submitDrawMesh(u,a,l.quadMesh)}}],["ExtractBand",class extends lt{constructor(){super(...arguments),this.name="RasterExtractBandProcessor",this.type=11,this.shaders={extractBand:new kt}}_process(e,t){const i={bandIndexMat3:e.rasterFunction.parameters.bandIndexMat3},s=this._getCommonConfig(e,t),r={shader:this.shaders.extractBand,uniforms:{config:s,extractBandConfig:i},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["Grayscale",class extends lt{constructor(){super(...arguments),this.name="RasterGrayscaleProcessor",this.type=12,this.shaders={grayscale:new Vt}}_process(e,t){const i={weights:e.rasterFunction.parameters.weights},s=this._getCommonConfig(e,t),r={shader:this.shaders.grayscale,uniforms:{config:s,grayscaleConfig:i},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["Hillshade",class extends lt{constructor(){super(...arguments),this.name="RasterHillshadeProcessor",this.type=13,this.shaders={hillshade:new Zt}}_process(e,t){const i=e.rasterFunction.parameters,r={isMultidirectional:i.hillshadeType>0},n=Ge(i,t.getRasterCellSize()),o=(0,s.A)((0,s.A)({},i),{},{factor:n,minValue:0,maxValue:8e3}),a=this._getCommonConfig(e,t),l={shader:this.shaders.hillshade,uniforms:{config:a,hillshadeConfig:o},defines:r,optionalAttributes:null,useComputeBuffer:!1},{painter:u,context:c}=e;u.submitDrawMesh(c,l,u.quadMesh)}}],["Local",class extends lt{constructor(){super(...arguments),this.name="RasterLocalProcessor",this.type=14,this.shaders={local:new Tt}}_process(e,t){var i;const r=e.rasterFunction.parameters,n={constantCount:this._getConstantCount(r.rasters),imageCount:r.imageCount,operationName:r.operationName,isOutputRounded:r.isOutputRounded},o={domainRange:r.domainRange},a="conditional"===r.operationName?r.rasters:null===(i=r.rasters)||void 0===i?void 0:i.slice(0,2),l=this._getMultipleInputConfig(t,a),u=this._getCommonConfig(e,t),c={shader:this.shaders.local,uniforms:(0,s.A)({config:u,domainRangeConfig:o},l),defines:n,optionalAttributes:null,useComputeBuffer:!1},{painter:h,context:d}=e;h.submitDrawMesh(d,c,h.quadMesh)}}],["Mask",class extends lt{constructor(){super(...arguments),this.name="RasterMaskProcessor",this.type=15,this.shaders={mask:new Et}}_process(e,t){const i=e.rasterFunction.parameters,s={isMultiband:i.bandCount>1},r={includedRanges:[...i.includedRanges],noDataValues:[...i.noDataValues]},n=this._getCommonConfig(e,t),o={shader:this.shaders.mask,uniforms:{config:n,maskConfig:r},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["NDVI",class extends lt{constructor(){super(...arguments),this.name="RasterNDVIProcessor",this.type=16,this.shaders={ndvi:new jt}}_process(e,t){const i=e.rasterFunction.parameters,s={scaled:i.scaled},r={bandIndexMat3:i.bandIndexMat3},n=this._getCommonConfig(e,t),o={shader:this.shaders.ndvi,uniforms:{config:n,ndviConfig:r},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Remap",class extends lt{constructor(){super(...arguments),this.name="RasterRemapProcessor",this.type=17,this.shaders={remap:new Lt}}_process(e,t){var i;const s=e.rasterFunction.parameters,r={replaceUnmatched:s.allowUnmatched&&null!=s.replacementValue},n={rangeMaps:[...s.rangeMaps],noDataRanges:[...s.noDataRanges],unmatchMask:s.allowUnmatched?1:0,replacementValue:null!==(i=s.replacementValue)&&void 0!==i?i:0,clampRange:s.clampRange},o=this._getCommonConfig(e,t),a={shader:this.shaders.remap,uniforms:{config:o,remapConfig:n},defines:r,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:u}=e;l.submitDrawMesh(u,a,l.quadMesh)}}],["Reproject",class extends lt{constructor(){super(...arguments),this.name="RasterReprojectProcessor",this.type=18,this.shaders={reproject:new Nt}}_process(e,t){const i=e.rasterFunction.parameters,r=this._getInterpolationDefines(t.interpolation,!!i.requireNNEdge),{config:n,projectionConfig:o,projectionDefines:a}=this._getReprojectConfig(t),l={shader:this.shaders.reproject,uniforms:{config:n,projectionConfig:o},defines:(0,s.A)((0,s.A)((0,s.A)({},a),r),{},{applyPixelMask:!1,applyPixelHighlights:!1}),optionalAttributes:null,useComputeBuffer:!1},{interpolation:u}=t;t.interpolation="nearest";const{painter:c,context:h}=e;c.submitDrawMesh(h,l,c.quadMesh),t.interpolation=u,t.projected=!0}_getReprojectConfig(e){const{source:t}=e,{names:i,textures:s}=e.getTextures({forProcessing:!0}),r={texture:{texture:s[i.indexOf("u_image")],unit:0},dvsMat3:new Float32Array([2,0,0,0,2,0,-1,-1,0]),coordScale:[1,1],srcImageSize:[t.width,t.height],opacity:1},n=s[i.indexOf("u_transformGrid")],{transformGrid:o}=e,a=!(!n||!o);return{config:r,projectionConfig:a?{transformTexture:{texture:n,unit:1},targetImageSize:[e.width,e.height],transformSpacing:o.spacing,transformGridSize:o.size}:void 0,projectionDefines:{applyProjection:a,lookupProjection:a&&1===o.spacing[0]}}}_getInterpolationDefines(e,t){const i="bilinear"===e&&t;return{bilinear:i,bicubic:"cubic"===e,nearestOnEdge:i}}}],["ShadedRelief",class extends lt{constructor(){super(...arguments),this.name="RasterShadedReliefProcessor",this.type=19,this.shaders={shadedRelief:new Ht}}_process(e,t,i){const r=e.rasterFunction.parameters,n={isMultidirectional:r.hillshadeType>0},o=Ge(r,t.getRasterCellSize()),a=(0,s.A)((0,s.A)({},r),{},{factor:o}),l={colormapTexture:{texture:i,unit:1},colormapOffset:r.offset,colormapMaxIndex:r.indexedColormap.length/4-1},u=this._getCommonConfig(e,t),c={shader:this.shaders.shadedRelief,uniforms:{config:u,hillshadeConfig:a,colormapConfig:l},defines:n,optionalAttributes:null,useComputeBuffer:!1},{painter:h,context:d}=e;h.submitDrawMesh(d,c,h.quadMesh)}}],["Slope",class extends lt{constructor(){super(...arguments),this.name="RasterSlopeProcessor",this.type=20,this.shaders={slope:new Yt}}_process(e,t){const i=e.rasterFunction.parameters,s={isOutputRounded:i.isOutputRounded,percentRise:"percent-rise"===i.slopeType},r={cellSize:t.getRasterCellSize(),pixelSizePower:"adjusted"===i.slopeType?i.pixelSizePower:0,pixelSizeFactor:"adjusted"===i.slopeType?i.pixelSizeFactor:0,zFactor:i.zFactor},n=this._getCommonConfig(e,t),o={shader:this.shaders.slope,uniforms:{config:n,slopeConfig:r},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Statistics",class extends lt{constructor(){super(...arguments),this.name="RasterFocalStatisticsProcessor",this.type=21,this.shaders={focalStatistics:new Dt}}_process(e,t){const i=e.rasterFunction.parameters,s={rows:i.kernelRows,cols:i.kernelCols,statisticsType:i.statisticsType,fill:i.fillNoDataOnly},r={clampRange:i.clampRange},n=this._getCommonConfig(e,t),o={shader:this.shaders.focalStatistics,uniforms:{config:n,focalStatisticsConfig:r},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Stretch",class extends lt{constructor(){super(...arguments),this.name="RasterStretchProcessor",this.type=22,this.shaders={stretch:new Qt}}_process(e,t){const i=e.rasterFunction.parameters,s={isMultiband:i.bandCount>1,isOutputRounded:i.isOutputRounded,useGamma:i.useGamma},r=this._getCommonConfig(e,t),n={shader:this.shaders.stretch,uniforms:{config:r,stretchConfig:i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:a}=e;o.submitDrawMesh(a,n,o.quadMesh)}}]]);class Kt extends B.j{constructor(){super(...arguments),this.type=1,this.shaders={},this._techniques=new Map}shutdown(e){var t;super.shutdown(e),null!==(t=this._fbo)&&void 0!==t&&t.dispose(),this._fbo=void 0;for(const i of this._techniques.values())i.shutdown();this._techniques.clear()}render(e,t){var i;null!==(i=this._fbo)&&void 0!==i||(this._fbo=be(e.context,st.CQ,st.CQ));let{name:r}=e.rasterFunction;if("Arithmetic"===r&&(r="Local"),!this._techniques.has(r)){const e=$t.get(r);if(!e)return;this._techniques.set(r,new e)}this._techniques.get(r).render(e,(0,s.A)((0,s.A)({},t),{},{processorFbo:this._fbo}))}}class Xt extends k.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1}get pixelHighlights(){return this._pixelHighlights}set pixelHighlights(e){this._pixelHighlights=e,this.children.forEach(e=>{let{bitmap:t}=e;return t.highlightTexture=null}),this.requestRender()}createTile(e){const t=this._getTileBounds(e),[i,s]=this.tileInfoView.tileInfo.size,r=this.tileInfoView.getTileResolution(e.level);return new A(e,r,t[0],t[3],i,s)}onAttach(){super.onAttach(),this._colorizerTechnique=new tt,this._processorTechnique=new Kt,this._highlightTechnique=new ot}onDetach(){var e,t,i;super.onDetach(),null!==(e=this._colorizerTechnique)&&void 0!==e&&e.shutdown(),this._colorizerTechnique=void 0,null!==(t=this._processorTechnique)&&void 0!==t&&t.shutdown(),this._processorTechnique=void 0,null!==(i=this._highlightTechnique)&&void 0!==i&&i.shutdown(),this._highlightTechnique=void 0}doRender(e){var t,i;if(!this.visible||1!==e.drawPhase||!this._colorizerTechnique)return;const{rasterFunctionChain:s}=this;if(null!==s&&void 0!==s&&null!==(t=s.functions)&&void 0!==t&&t.length){if(!this._processorTechnique)return;const{functions:t,hasBranches:i}=s;for(const s of t){if("Constant"===s.name||"Identity"===s.name)continue;e.rasterFunction=s,e.hasBranches=i,super.doRender(e);const t=this.children.map(e=>e.bitmap);this._processorTechnique.render(e,{bitmaps:t})}}if(null!==(i=this._pixelHighlights)&&void 0!==i&&i.length&&this._highlightTechnique)for(const n of this._pixelHighlights){e.pixelHighlightOptions=n,super.doRender(e);const t=this.children.map(e=>e.bitmap);this._highlightTechnique.render(e,{bitmaps:t})}e.rasterFunction=null,e.pixelHighlightOptions=void 0,super.doRender(e);const r=this.children.map(e=>e.bitmap);this._colorizerTechnique.render(e,{bitmaps:r})}_getTileBounds(e){const t=this.tileInfoView.getTileBounds((0,v.vt)(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this.tileInfoView,s=(0,C.FT)(i.spatialReference);if(s){const r=i.lodAt(e.level);if(!r)return t;const{resolution:n}=r,o=n*i.size[0];t[0]=s*e.world+i.origin.x+e.col*o,t[2]=t[0]+o}}return t}}var Jt=i(91967),ei=i(19451),ti=i(76797),ii=i(19247),si=i(66486),ri=i(88235),ni=i(12838),oi=i(59844),ai=i(40181),li=(i(93453),i(15389)),ui=i(96345),ci=i(59752);const hi=[0,0];let di=class extends Jt.A{constructor(){var e;super(...arguments),e=this,this._updatingHandles=new ei.U,this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=[],this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._maxIndexedColormapSize=0,this._rasterFunctionState="na",this._globalUpdateRequested=!1,this.attached=!1,this.timeExtent=null,this.redrawOrRefetch=(0,a.sg)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=e._rasterFunctionState,s=t.reprocess||"gpu"===i&&!e.canUseWebGLForProcessing||"cpu"===i&&e.canUseWebGLForProcessing;if(s&&(await e._updatingHandles.addPromise(e.layer.updateRasterFunction()),e.updateRasterFunctionParameters()),!e.previousLOD||e.layerView.suspended)return;const r=e._rasterFunctionState,{type:n}=e;return t.refetch||"raster"!==n&&s||"cpu"===r||"cpu"===i?e._updatingHandles.addPromise(e.doRefresh()):e._updatingHandles.addPromise(e._redrawImage(t.signal))})}destroy(){this._updatingHandles.destroy()}get canUseWebGLForProcessing(){return!1}get canUseLocalSymbolizerParams(){return(this.canUseWebGLForProcessing||"rasterVF"===this.type)&&!this.layerView.hasTilingEffects}get isCPUBasedDRA(){const{renderer:e}=this.layer;return"raster-stretch"===(null===e||void 0===e?void 0:e.type)&&e.dynamicRangeAdjustment&&(!this.canUseWebGLForProcessing||!("min-max"===e.stretchType||"standard-deviation"===e.stretchType))}get useWebGLForProcessing(){var e;return null===(e=this._get("useWebGLForProcessing"))||void 0===e||e}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){var e;return null===(e=this._get("useProgressiveUpdate"))||void 0===e||e}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new ui.A({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:s}=e.state,r=this._tileInfoView.getClosestInfoForScale(s);if(this.layer.raster){var n;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[r.level],s="toJSON"in t?t:ti.A.fromJSON(t);(0,ni.yo)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,s,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null===(n=this.previousLOD)||void 0===n?void 0:n.level)!==r.level&&(this.previousLOD=r,null!=this._symbolizerParams&&this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.isCPUBasedDRA&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()}));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){var e;return this._globalUpdateRequested||(null===(e=this._updatingHandles)||void 0===e?void 0:e.updating)}attach(){const e=(0,oe.C)();this._maxIndexedColormapSize=4*(e.maxTextureSize||4096),this._initializeTileInfo(),this._tileInfoView=new ai.A(this.layerView.tileInfo,this.layerView.fullExtent);const t=this._computeFetchConcurrency();this._fetchQueue=new li.A({tileInfoView:this._tileInfoView,concurrency:t,process:(e,t)=>this._fetchTile(e,t),priority:ci.W6.MAPVIEW_FETCH_QUEUE,scheduler:this.scheduler});const i=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new ui.A({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:i,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,ni.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.isCPUBasedDRA||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",()=>{e.destroy(),this.layerView.requestUpdate()}),this.layerView.requestUpdate()}createEmptyTilePixelBlock(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[i,s]=e,r=new si.A({width:i,height:s,pixels:[new Uint8Array(i*s)],mask:new Uint8Array(i*s),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=r),r}_getBandIds(){if(this.container&&(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain))return this.layer.bandIds;const{bandIds:e,raster:t}=this.layer,i="rasterFunction"in t?t.rasterFunction.rawInputBandIds:null;return null!==e&&void 0!==e&&e.length&&null!==i&&void 0!==i&&i.length&&1!==t.rasterInfo.bandCount?e.map(e=>i[Math.min(e,i.length-1)]):"rasterFunction"in t?i:e}updateRasterFunctionParameters(){}_fetchTile(e,t){const i=this._getFetchOptions(e.level,t.signal);return this.fetchTile(e,i)}_getFetchOptions(e,t){var i;const{canUseWebGLForProcessing:s}=this,{layerView:r}=this,{tileInfo:n}=r,o=!n.isWrappable&&null!=(0,oi.FT)(r.view.spatialReference),a=s&&this.layer.raster.hasUniqueSourceStorageInfo,{layer:l}=this.layerView,u=null!==(i=l.serviceRasterInfo)&&void 0!==i&&i.storageInfo.isBsqTile?l.getRawDisplayBandIds():void 0;return{allowPartialFill:!0,datumTransformation:r.datumTransformation,interpolation:s?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:a,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:t,srcResolution:this._srcResolutions[e],timeExtent:r.timeExtent,tileInfo:n,bandIds:u,disableWrapAround:o}}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const{layerView:e}=this,t=e.view.spatialReference;if(this._canUseLayerLODs()){const{origin:i,lods:s}=this.layer.tileInfo,r=s.map(e=>{let{scale:t}=e;return t}),n=ri.A.create({spatialReference:t,size:st.CQ,scales:r,origin:i});return e.set("tileInfo",n),void(this._srcResolutions=s.map(e=>{let{resolution:t}=e;return{x:t,y:t}}))}const{scales:i,srcResolutions:s,isCustomTilingScheme:r}=(0,oi.dK)(this.layer.serviceRasterInfo,t,{tileSize:st.CQ,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1}),n=ri.A.create({spatialReference:t,size:st.CQ,scales:i}),o=0===n.origin.x;(0,T.Lw)(e.fullExtent);const{xmin:a,ymax:l}=e.fullExtent;(o||r&&n.origin.x>a)&&(n.origin=new ii.A({x:a,y:l,spatialReference:t})),this._isCustomTilingScheme=r,e.set("tileInfo",n),this._srcResolutions=null!==s&&void 0!==s?s:[]}_canUseLayerLODs(){var e;const{layer:t,layerView:i}=this;if("Map"!==t.raster.tileType)return!1;const{lods:s}=t.tileInfo,r=null===(e=i.view.constraints)||void 0===e?void 0:e.effectiveLODs;return(null===r||void 0===r?void 0:r.length)===s.length&&r.every((e,t)=>{let{scale:i}=e;return Math.abs(i-s[t].scale)<.001})}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.serviceRasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{let t=e.once("detach",()=>t=void 0);const r=await this._fetchQueue.push(e.key),n=this._getBandIds();let l=!this.useProgressiveUpdate||this.isCPUBasedDRA&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){l=!1;try{var i;await this._redrawImage(null===(i=this._abortController)||void 0===i?void 0:i.signal)}catch(s){(0,a.zf)(s)&&o.A.getLogger(this).error(s)}this._globalUpdateRequested=!1}if(!t)return;this.canUseLocalSymbolizerParams&&null==this._symbolizerParams&&this._updateSymbolizerParams();const u=this._tileInfoView.getTileCoords(hi,e.key),c=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:r,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:l,bandIds:n,coords:u,resolution:c}),t&&(e.once("attach",()=>this.layerView.requestUpdate()),this.container.addChild(e),t.remove())}catch(s){(0,a.zf)(s)||o.A.getLogger(this).error(s)}this.layerView.requestUpdate()}}async _redrawImage(e){if(!this.attached||0===this.container.children.length)return;if(await this.layer.updateRenderer(),this.isCPUBasedDRA?await this._updateGlobalSymbolizerParams(e):(this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._globalSymbolizerParams=null),!this.attached||null!==e&&void 0!==e&&e.aborted)return;const t=this.container.children.map(async t=>this.updateTileSymbolizerParameters(t,{local:this._symbolizerParams,global:this._globalSymbolizerParams},e));await Promise.allSettled(t),this.attached&&(null===e||void 0===e||!e.aborted)&&this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t=this._getFetchOptions(this.previousLOD.level,e),i=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,(0,s.A)((0,s.A)({},t),{},{interpolation:"nearest",requestRawData:!1,skipRasterFunction:!1}));if(null===i||void 0===i||!i.pixelBlock)return;const{resolution:r}=this.previousLOD,{isBsqTile:n}=this.layer.raster.rasterInfo.storageInfo,o=n?null:this._getBandIds(),a=this.layer.symbolizer.generateWebGLParameters({pixelBlock:i.pixelBlock.extractBands(o),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:r,y:r},bandIds:o});!this.canUseWebGLForProcessing&&a&&"stretch"===a.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(a.factor=a.factor.map(e=>255*e),a.minOutput=Math.round(255*a.minOutput),a.maxOutput=Math.round(255*a.maxOutput)),this._globalSymbolizerParams=a}_updateSymbolizerParams(){const{resolution:e}=this.previousLOD,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:e,y:e},bandIds:t})}_updateBlockCacheRegistry(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{layer:t,layerView:i}=this,{raster:s}=t,{multidimensionalDefinition:r}=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:i.timeExtent}),n=s.rasterInfo.multidimensionalInfo?s.getSliceIndex(r):null,o=s.rasterInfo.storageInfo.isBsqTile?t.getRawDisplayBandIds():null,a=(0,ni.ph)(s.rasterId,n,o);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,ni.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,ni.kz)(a,s.rasterInfo),e){const{view:e}=i,t=this._tileInfoView.getClosestInfoForScale(e.scale),r=this._srcResolutions[t.level];(0,ni.yo)(a,this._blockCacheRegistryId,e.extent,e.resolution,r,s.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){if(!this.attached||!this.previousLOD||this.layerView.suspended)return;await this.layer.updateRenderer(),this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._globalUpdateRequested=this.isCPUBasedDRA||!this.useProgressiveUpdate,this._tileStrategy.refresh(t=>e.push(this._enqueueTileFetch(t))),await this._updatingHandles.addPromise(Promise.allSettled(e))}};(0,r.Cg)([(0,u.MZ)()],di.prototype,"_globalUpdateRequested",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"attached",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"canUseWebGLForProcessing",null),(0,r.Cg)([(0,u.MZ)()],di.prototype,"canUseLocalSymbolizerParams",null),(0,r.Cg)([(0,u.MZ)()],di.prototype,"isCPUBasedDRA",null),(0,r.Cg)([(0,u.MZ)()],di.prototype,"container",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"layer",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"layerView",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"scheduler",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"type",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"useWebGLForProcessing",null),(0,r.Cg)([(0,u.MZ)()],di.prototype,"useProgressiveUpdate",null),(0,r.Cg)([(0,u.MZ)()],di.prototype,"timeExtent",void 0),(0,r.Cg)([(0,u.MZ)()],di.prototype,"updating",null),di=(0,r.Cg)([(0,h.$)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],di);var pi=i(13692),mi=i(1723),gi=i(1898);let fi=class extends di{constructor(){super(...arguments),this.type="raster"}get canUseWebGLForProcessing(){var e;const{loaded:t,symbolizer:i}=this.layer;if(!t||!i)return!1;const s=null===(e=i.lookup.colormapLut)||void 0===e?void 0:e.indexedColormap,r=s&&s.length>this._maxIndexedColormapSize,n=(0,x.xN)(this.layer.serviceRasterInfo);return!((0,c.A)("ios")&&n>4)&&this.useWebGLForProcessing&&i.canRenderInWebGL&&!r&&!("majority"===this.layer.interpolation&&(0,pi.H_)(this.layer))}attach(){super.attach(),this.container=new Xt(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}updateRasterFunctionParameters(){var e;const{raster:t,type:i}=this.layer,{container:s}=this;if("Function"!==t.datasetFormat||"wcs"===i)return s.rasterFunctionChain=null,s.children.forEach(e=>{const{bitmap:t}=e;t&&(t.suspended=!0,t.processed=!1,t.projected&&(t.invalidateTexture(),t.rasterTexture=null))}),void(this._rasterFunctionState="na");const r=this._rasterFunctionState,{rasterFunction:n,primaryRasters:o}=t,a=n.supportsGPU&&(!o||o.rasters.length<=1),l=a?n.flatWebGLFunctionChain:null,{renderer:u}=this.layer,c=!a||!(null!==l&&void 0!==l&&l.functions.length)||"raster-stretch"===(null===u||void 0===u?void 0:u.type)&&u.dynamicRangeAdjustment||!this.canUseWebGLForProcessing;s.rasterFunctionChain=c?null:this._addProjection(l);const h=null==n?"na":s.rasterFunctionChain?"gpu":"cpu",d=r===h||"na"===r&&"cpu"===h&&0===(null===l||void 0===l||null===(e=l.functions)||void 0===e?void 0:e.length);s.children.forEach(e=>{const{bitmap:t}=e;t&&(t.suspended=!d,t.processed=!1,t.processedTexture=null)}),this._rasterFunctionState=h}async updateTileSource(e,t){const i=this._getBandIds(),s=this._getLayerInterpolation(),{canUseWebGLForProcessing:r}=this,{source:n,globalSymbolizerParams:o,suspended:a,coords:l,resolution:u}=t,c=this.isCPUBasedDRA?o:t.symbolizerParams,{bitmap:h}=e;if([h.x,h.y]=l,h.resolution=u,null!=(null===n||void 0===n?void 0:n.pixelBlock)){const e={extent:n.extent,pixelBlock:n.pixelBlock,srcPixelSize:n.srcTilePixelSize};if(h.rawPixelData=e,r)h.source=n.pixelBlock,h.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===(null===o||void 0===o?void 0:o.type)?o:void 0);h.source=t,h.isRendereredSource=!0}h.symbolizerParameters=r?c:null,h.transformGrid=r?n.transformGrid:null}else{const e=this.createEmptyTilePixelBlock();h.source=e,h.symbolizerParameters=r?c:null,h.transformGrid=null}const{isBsqTile:d}=this.layer.raster.rasterInfo.storageInfo;h.bandIds=r&&!d?i:null,h.width=this._tileInfoView.tileInfo.size[0],h.height=this._tileInfoView.tileInfo.size[1],h.interpolation=s,h.suspended=a;const{raster:p}=this.layer;if((0,y.qg)(p)){const t=p.getClippingGeometry(this.layerView.view.spatialReference);if(t){const i=p.getTileExtentFromTileInfo(e.key.level,e.key.row,e.key.col,this._tileInfoView.tileInfo);i&&(h.mask=(0,b.b5)({srcExtent:i,geometry:t,size:[h.width,h.height]}))}}h.invalidateTexture()}async updateTileSymbolizerParameters(e,t,i){const{local:s,global:r}=t,n=this._getBandIds(),o=this._getLayerInterpolation(),{canUseWebGLForProcessing:a}=this,{bitmap:l}=e,{rawPixelData:u}=l;a||null==u?(l.isRendereredSource&&null!=u&&(l.source=u.pixelBlock),l.isRendereredSource=!1):(l.source=await this.layer.applyRenderer(u,"stretch"===(null===r||void 0===r?void 0:r.type)?r:void 0,{signal:i}),l.isRendereredSource=!0),l.symbolizerParameters=a?this.layerView.hasTilingEffects?r:s:null;const{isBsqTile:c}=this.layer.raster.rasterInfo.storageInfo;l.bandIds=a&&!c?n:null,l.interpolation=o,l.suspended=!1}updateHighlightOptions(e){if(!e.length)return void(this.container.pixelHighlights=void 0);const t=[],{highlights:i}=this.layerView.view;e.sort((e,t)=>i.findIndex(e=>{let{name:i}=e;return i===(0,gi.i)(t.options)})-i.findIndex(t=>{let{name:i}=t;return i===(0,gi.i)(e.options)}));for(const{target:o,options:a}of e){var s,r,n;const{pixelRanges:e}=o,l=Array.from({length:2*w.et},()=>0);for(let t=0;t<e.length;t++)l[2*t]=e[t][0],l[2*t+1]=e[t][1];for(let t=e.length;t<w.et;t++)l[2*t]=f.pq,l[2*t+1]=-f.pq;const u=null!==(s=o.bandId)&&void 0!==s?s:0,c=(0,gi.i)(a),h=null!==(r=null===(n=i.find(e=>e.name===c))||void 0===n?void 0:n.color)&&void 0!==r?r:mi.fT,d=g.A.toUnitRGBA(h);t.push({ranges:l,bandId:u,color:d})}this.container.pixelHighlights=t}_getLayerInterpolation(){const{interpolation:e,renderer:t}=this.layer;if(!t)return e;const i=t.type;return"raster-colormap"===i||"unique-value"===i?"nearest":"raster-stretch"===t.type&&null!=t.colorRamp?"bilinear"===e||"cubic"===e?"bilinear":"nearest":e}_addProjection(e){var t;return null!==e&&void 0!==e&&null!==(t=e.functions)&&void 0!==t&&t.length&&!e.hasFocalFunction&&e.functions.unshift({name:"Reproject",parameters:{targetImageSize:this._tileInfoView.tileInfo.size,requireNNEdge:e.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1}),e}};(0,r.Cg)([(0,u.MZ)()],fi.prototype,"canUseWebGLForProcessing",null),(0,r.Cg)([(0,u.MZ)()],fi.prototype,"container",void 0),(0,r.Cg)([(0,u.MZ)()],fi.prototype,"layer",void 0),(0,r.Cg)([(0,u.MZ)()],fi.prototype,"type",void 0),fi=(0,r.Cg)([(0,h.$)("esri.views.2d.layers.imagery.ImageryTileView2D")],fi);var yi=i(99846),xi=i(17331),bi=i(86386);class wi extends z.Y{constructor(e,t,i,s,r,n){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(e,t,i,s,r,n),this.tileData=new bi.X(o),this.tileData.coordScale=[r,n],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,_.vt)(),tileMat3:(0,_.vt)()}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,r]=this.tileData.offset,n=[this.x+s*this.resolution,this.y-r*this.resolution],[o,a]=e.toScreenNoRotation([0,0],n),{symbolTileSize:l}=this.tileData.symbolizerParameters,u=Math.round((this.width-this.tileData.offset[0])/l)*l,c=Math.round((this.height-this.tileData.offset[1])/l)*l,h=u/this.rangeX*t,d=c/this.rangeY*t;(0,P.hZ)(i,h,0,0,0,d,0,o,a,1),(0,P.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,i),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}class vi extends k.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const t=this.tileInfoView.getTileBounds((0,v.vt)(),e),[i,s]=this.tileInfoView.tileInfo.size,r=this.tileInfoView.getTileResolution(e.level);return new wi(e,r,t[0],t[3],i,s)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[xi.A],target:()=>this.children.map(e=>e.tileData),drawPhase:1});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&1===e.drawPhase&&this.symbolTypes.forEach(t=>{e.renderPass=t,super.doRender(e)})}}let Ci=class extends di{constructor(){super(...arguments),this._handle=null,this.type="rasterVF"}async fetchTile(e,t){var i;t=(0,s.A)((0,s.A)({},t),{},{interpolation:"nearest",requestProjectedLocalDirections:!0});const r=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===(null===(i=this.layer.serviceRasterInfo)||void 0===i?void 0:i.dataType)&&null!==r&&void 0!==r&&r.pixelBlock&&(r.pixelBlock=await this.layer.convertVectorFieldData(r.pixelBlock,"vector-magdir",t)),r}updateTileSource(e,t){const i=t.symbolizerParams,{tileData:s}=e;s.key=e.key,s.width=this._tileInfoView.tileInfo.size[0],s.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:r}=i,{source:n}=t;if(s.offset=this._getTileSymbolOffset(s.key,r),null!=(null===n||void 0===n?void 0:n.pixelBlock)){const e={extent:n.extent,pixelBlock:n.pixelBlock};s.rawPixelData=e,s.symbolizerParameters=i,s.source=this._sampleVectorFieldData(n.pixelBlock,i,s.offset)}else{const e=[Math.round((this._tileInfoView.tileInfo.size[0]-s.offset[0])/r),Math.round((this._tileInfoView.tileInfo.size[1]-s.offset[1])/r)],t=this.createEmptyTilePixelBlock(e);s.source=t,s.symbolizerParameters=i}return s.invalidateVAO(),Promise.resolve()}updateTileSymbolizerParameters(e,t){var i;const s=t.local,{symbolTileSize:r}=s,{tileData:n}=e;n.offset=this._getTileSymbolOffset(n.key,r);const o=n.symbolizerParameters.symbolTileSize;n.symbolizerParameters=s;const a=null===(i=n.rawPixelData)||void 0===i?void 0:i.pixelBlock;return null!=a&&o!==r&&(n.source=this._sampleVectorFieldData(a,n.symbolizerParameters,n.offset)),Promise.resolve()}attach(){super.attach(),this.container=new vi(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,l.wB)(()=>this.layer.renderer,e=>this._updateSymbolType(e))}detach(){var e;super.detach(),this.container.removeAllChildren(),null!==(e=this._handle)&&void 0!==e&&e.remove(),this._handle=null,this.container=null}_getTileSymbolOffset(e,t){const i=e.col*this._tileInfoView.tileInfo.size[0]%t,s=e.row*this._tileInfoView.tileInfo.size[1]%t;return[i>t/2?t-i:-i,s>t/2?t-s:-s]}_sampleVectorFieldData(e,t,i){const{symbolTileSize:s}=t;return(0,yi.Wu)(e,"vector-uv",s,i)}_updateSymbolType(e){"vector-field"===(null===e||void 0===e?void 0:e.type)&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}};(0,r.Cg)([(0,u.MZ)()],Ci.prototype,"container",void 0),(0,r.Cg)([(0,u.MZ)()],Ci.prototype,"layer",void 0),(0,r.Cg)([(0,u.MZ)()],Ci.prototype,"type",void 0),Ci=(0,r.Cg)([(0,h.$)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],Ci);var _i=i(39356),Ti=i(50076),Pi=i(51939),Si=i(31516),Ri=i(2257);const Mi=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch(e){return null}}get timeExtent(){var e;return(0,Si.F)(this.layer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){const{renderer:e}=this.layer;return!("raster-stretch"!==(null===e||void 0===e?void 0:e.type)||!e.dynamicRangeAdjustment||"min-max"===e.stretchType||"standard-deviation"===e.stretchType)}get datumTransformation(){try{return this.layer.loaded?(0,oi.vI)(this.layer.fullExtent,this.view.spatialReference,!0):null}catch(e){return null}}supportsSpatialReference(e){try{return!this.layer.loaded||!!(0,oi.eh)(this.layer.serviceRasterInfo,e)}catch(t){return!1}}async fetchPopupFeaturesAtLocation(e,t){const{layer:i}=this;if(!e)throw new Ti.A("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:s}=i,r=(0,Ri.D8)(i,t);if(!s||null==r)return[];const n=[],{value:o,magdirValue:a,processedValue:l}=await i.identify(e,{timeExtent:this.timeExtent,signal:null===t||void 0===t?void 0:t.signal});let u="";if(null!==o&&void 0!==o&&o.length){var c,h,d;u="imagery-tile"===i.type&&i.hasStandardTime()&&null!=o[0]?o.map(e=>i.getStandardTimeValue(e)).join(", "):o.join(", ");const e={ObjectId:0};e[Pi.F_.servicePixelValue]="imagery-tile"===i.type&&(0,y.qg)(i.raster)?null===l||void 0===l?void 0:l.join(", "):u,e[Pi.F_.rawServicePixelValue]=u;const t=null!==(c=null===(h=i.raster)||void 0===h?void 0:h.rasterInfo)&&void 0!==c?c:i.serviceRasterInfo,s=null===t||void 0===t?void 0:t.attributeTable;if(null!=s){const{fields:t,features:i}=s,r=t.find(e=>{let{name:t}=e;return"value"===t.toLowerCase()}),n=e[Pi.F_.servicePixelValue],o=r?i.find(e=>String(e.attributes[r.name])===n):null;if(o)for(const s in o.attributes)o.attributes.hasOwnProperty(s)&&(e[Pi.ER+s]=o.attributes[s])}const r=null===t||void 0===t?void 0:t.dataType;"vector-magdir"!==r&&"vector-uv"!==r||(e[Pi.F_.magnitude]=null===a||void 0===a?void 0:a[0],e[Pi.F_.direction]=null===a||void 0===a?void 0:a[1]);const{multidimensionalDefinition:p}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});(0,Pi.eS)(i.rasterFields,e,p);const{graphicOrigin:m}=i,g=new _i.A({geometry:null===(d=this.fullExtent)||void 0===d?void 0:d.clone(),attributes:e,layer:i,origin:m,sourceLayer:i});n.push(g)}return n}async getSourceScale(){return await this.layer.load(),(0,oi.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return(0,oi.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}};return(0,r.Cg)([(0,u.MZ)()],i.prototype,"fullExtent",null),(0,r.Cg)([(0,u.MZ)()],i.prototype,"layer",void 0),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],i.prototype,"timeExtent",null),(0,r.Cg)([(0,u.MZ)()],i.prototype,"tileInfo",void 0),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],i.prototype,"hasTilingEffects",null),(0,r.Cg)([(0,u.MZ)()],i.prototype,"datumTransformation",null),i=(0,r.Cg)([(0,h.$)("esri.views.layers.ImageryTileLayerView")],i),i};var Ii=i(91196),Fi=i(771);let zi=class extends(Mi((0,Fi.I)((0,m.e)(Ii.A)))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this._pixelHighlights=[],this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}get displayParameters(){const{layer:e}=this,t=this._get("displayParameters");return e.renderer&&e.visible?{bandIds:e.bandIds,renderer:e.renderer,interpolation:e.interpolation,multidimensionalDefinition:e.multidimensionalDefinition,rasterFunction:"imagery-tile"===e.type?e.rasterFunction:null}:t}update(e){var t;null!==(t=this.subview)&&void 0!==t&&t.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,l.wB)(()=>this.displayParameters,(e,t)=>{var i,s,r;const n=e.interpolation!==(null===t||void 0===t?void 0:t.interpolation)&&("majority"===e.interpolation||"majority"===(null===t||void 0===t?void 0:t.interpolation))&&(0,pi.H_)(this.layer),l=!(null===(i=this.layer.serviceRasterInfo)||void 0===i||null===(i=i.storageInfo)||void 0===i||!i.isBsqTile)&&(null===(s=e.bandIds)||void 0===s?void 0:s.join())!==(null===t||void 0===t||null===(r=t.bandIds)||void 0===r?void 0:r.join()),u=e.renderer!==(null===t||void 0===t?void 0:t.renderer)&&this._getSubviewType(null===t||void 0===t?void 0:t.renderer)!==this._getSubviewType(e.renderer);u&&this._updateSubview();const c=e.multidimensionalDefinition!==(null===t||void 0===t?void 0:t.multidimensionalDefinition),h=e.rasterFunction!==(null===t||void 0===t?void 0:t.rasterFunction),d=h&&!this._useWebGLForProcessing,p=c||n||u||d||l;this.subview.redrawOrRefetch({refetch:p,reprocess:h}).catch(e=>{(0,a.zf)(e)||o.A.getLogger(this).error(e)}),this.notifyChange("updating")}),(0,l.wB)(()=>{var e;return null!==(e=this.layer.multidimensionalSubset)&&void 0!==e?e:null},(e,t)=>{const{multidimensionalDefinition:i}=this.layer;null!=i&&(0,d.sx)(i,e)!==(0,d.sx)(i,t)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(e=>{(0,a.zf)(e)||o.A.getLogger(this).error(e)}),this.notifyChange("updating"))},l.OH),(0,l.wB)(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch({refetch:!0}).catch(e=>{(0,a.zf)(e)||o.A.getLogger(this).error(e)})},l.Vh),(0,l.wB)(()=>this.view.highlights.items.map(e=>{let{name:t,color:i}=e;return{name:t,color:i}}),()=>this._updateHighlightOptions(this.subview),l.Vh)])}detach(){var e;this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null!==(e=this.subview)&&void 0!==e&&e.destroy(),this.subview=null}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}highlight(e,t){var i;if(null===(i=e.pixelRanges)||void 0===i||!i.length)return(0,n.hA)();const r={target:(0,s.A)({},e),options:(0,s.A)({},t)};return this._pixelHighlights.push(r),this._updateHighlightOptions(this.subview),(0,n.hA)(()=>{const e=this._pixelHighlights.indexOf(r);-1!==e&&(this._pixelHighlights.splice(e,1),this._updateHighlightOptions(this.subview))})}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){const{renderer:e}=this.layer;if(!e)return;const t=this._getSubviewType(e);if(this.subview){var i;if(this.subview.type===t)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null!==(i=this.subview)&&void 0!==i&&i.destroy(),this.subview=null}const{layer:s}=this;let r;if(r="rasterVF"===t?new Ci({layer:s,layerView:this,scheduler:this.scheduler}):"flow"===t?new p.A({layer:s,layerView:this,scheduler:this.scheduler}):new fi({layer:s,layerView:this,scheduler:this.scheduler}),"useWebGLForProcessing"in r&&(r.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in r&&(r.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in r){const{subview:e}=this;r.previousLOD=e&&"previousLOD"in e?e.previousLOD:null}this._attachSubview(r),this._updateHighlightOptions(r),this.subview=r,this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0))}_detachSubview(e){(null===e||void 0===e?void 0:e.attached)&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}_getSubviewType(e){const t=null===e||void 0===e?void 0:e.type;return"vector-field"===t?"rasterVF":"flow"===t?"flow":"raster"}_updateHighlightOptions(e){"raster"===(null===e||void 0===e?void 0:e.type)&&e.updateHighlightOptions(this._pixelHighlights)}};(0,r.Cg)([(0,u.MZ)()],zi.prototype,"subview",void 0),(0,r.Cg)([(0,u.MZ)()],zi.prototype,"useWebGLForProcessing",null),(0,r.Cg)([(0,u.MZ)()],zi.prototype,"useProgressiveUpdate",null),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],zi.prototype,"displayParameters",null),zi=(0,r.Cg)([(0,h.$)("esri.views.2d.layers.ImageryTileLayerView2D")],zi);const Ai=zi},97255:(e,t,i)=>{i.d(t,{$B:()=>r,Qf:()=>u,Qh:()=>a,RS:()=>n,ez:()=>d,i5:()=>p,lM:()=>o,qK:()=>h});var s=i(78393);function r(e){return 32+e.length}const n=16;function o(e){if(!e)return 0;let t=h;for(const i in e)e.hasOwnProperty(i)&&(t+=l(e[i],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return u(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return c(e,8);let i=d;for(let s=0;s<t;s++)i+=l(e[s]);return i}(e);let t=h;for(const i in e)e.hasOwnProperty(i)&&(t+=l(e[i]));return t}function l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?a(e):h;case"string":return r(e);case"number":return n;case"boolean":return 4;default:return 8}}function u(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.reduce((e,t)=>e+(t?(0,s.iu)(t)?t.byteLength+p:Array.isArray(t)?c(t,n):0:0),0)}function c(e,t){return d+e.length*t}const h=32,d=16,p=145}}]);
//# sourceMappingURL=2011.f9bb0a70.chunk.js.map
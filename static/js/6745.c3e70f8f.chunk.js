"use strict";(self.webpackChunktest_app=self.webpackChunktest_app||[]).push([[6745],{46745:(e,t,n)=>{n.r(t),n.d(t,{TextureCompressionWorkerOutput:()=>d,compress:()=>p,compressRGBADataToKTX2:()=>v,createTextureDataKTX2:()=>m,destroy:()=>h,initializeBasisEncoder:()=>f,initializeDXTEncoder:()=>w});var l=n(28899);let a,r;var i=n(93345);let s,o,u=null,c=null;class d{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}function h(){u=null,s=null,c=null,o=null,a=null,r=null}async function p(e){let t;t=e.data instanceof ImageBitmap?function(e){const t=new OffscreenCanvas(e.width,e.height),n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height).data}(e.data):function(e,t,n,l,a){const r=new Uint8ClampedArray(e).subarray(0,t*n*l);if(!a)return r;const i=new Uint8ClampedArray(r.length),s=t*l;for(let o=0;o<n;o++){const e=o*s,t=(n-o-1)*s;i.set(r.subarray(e,e+s),t)}return i}(e.data,e.width,e.height,e.components,e.needsFlip);try{if(e.hasS3TC){var n;c||await w();const r=new Uint8Array(t.length);if(null!==(n=c)&&void 0!==n&&n.encode(t,e.width,e.height,e.preMultiplyAlpha,r)){var l,a;const e=function(e,t){const n=new Int32Array(e.buffer,e.byteOffset,y);let l,a;switch(n[b]){case D:l=8,a=i.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case X:l=16,a=i.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case B:l=16,a=i.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let r=1,s=n[A],o=n[g];(3&s||3&o)&&(s=s+3&-4,o=o+3&-4);const u=s,c=o;let d,h;n[T]&S&&!1!==t&&(r=Math.max(1,n[E]));let p=e.byteOffset+n[C]+4;const f=[];for(let i=0;i<r;++i)h=(s+3>>2)*(o+3>>2)*l,d=new Uint8Array(e.buffer,p,h),f.push(d),p+=h,s=Math.max(1,s>>1),o=Math.max(1,o>>1);return{textureData:{type:"compressed",levels:f},internalFormat:a,width:u,height:c}}(r,!0),t=[r.buffer];return{result:new d(null!==(l=null===e||void 0===e?void 0:e.internalFormat)&&void 0!==l?l:null,null!==(a=null===e||void 0===e?void 0:e.textureData)&&void 0!==a?a:null),transferList:t}}return{result:new d(null,null)}}if(e.hasETC){var r,s,o;if(u||await f(),e.preMultiplyAlpha&&!c&&await w(),e.preMultiplyAlpha){var h;const n=new Uint8ClampedArray(t.length);null!==(h=c)&&void 0!==h&&h.premultiply(new Uint8Array(t),e.width,e.height,n),t=n}const n=v(t,e.width,e.height,e.hasMipmap),l=n?m(n):null,a=(null===l||void 0===l||null===(r=l.compressedTexture)||void 0===r?void 0:r.levels.map(e=>e.buffer))||[];return{result:new d(null!==(s=null===l||void 0===l?void 0:l.internalFormat)&&void 0!==s?s:null,null!==(o=null===l||void 0===l?void 0:l.compressedTexture)&&void 0!==o?o:null),transferList:a}}return{result:new d(null,null)}}finally{t instanceof ImageBitmap&&t.close()}}async function f(){u||(u=await(null!==s&&void 0!==s?s:(null!==a&&void 0!==a||(a=(async()=>{const e=await n.e(6378).then(n.bind(n,56378)),t=await e.default({locateFile:e=>(0,l.s)("esri/libs/basisu/".concat(e))});return t.initializeBasis(),t})()),s=a)),s=null)}async function w(){c||(c=await(null!==o&&void 0!==o?o:(null!==r&&void 0!==r||(r=(async()=>{const e=await n.e(3996).then(n.bind(n,53996));return await e.default({locateFile:e=>(0,l.s)("esri/libs/dxtEncoder/".concat(e))})})()),o=r)),o=null)}function v(e,t,n,l){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:255,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!u)return null;const o=new u.BasisEncoder;o.setPerceptual(!s),o.setCheckForAlpha(!0),o.setForceAlpha(!1),o.setRenormalize(s),o.setMipGen(l),o.setMipSRGB(!s),o.setCreateKTX2File(!0),o.setKTX2SRGBTransferFunc(!s),o.setQualityLevel(a),o.setCompressionLevel(r);const c=new Uint8Array(e.byteLength);o.setSliceSourceImage(0,new Uint8Array(e),t,n,i);const d=o.encode(c),h=new Uint8Array(c.buffer,0,d),p=new u.KTX2File(new Uint8Array(h));return p.isValid()?(o.delete(),h):(p.close(),p.delete(),o.delete(),null)}function m(e){if(!u)return new d(null,null);const t=new u.KTX2File(new Uint8Array(e));t.startTranscoding();const[n,l]=t.getHasAlpha()?[1,i.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[0,i.CQ.COMPRESSED_RGB8_ETC2],a=t.getLevels(),r=[];for(let i=0;i<a;i++)r.push(new Uint8Array(t.getImageTranscodedSizeInBytes(i,0,0,n))),t.transcodeImage(r[i],i,0,0,n,0,-1,-1);return t.close(),t.delete(),{internalFormat:l,compressedTexture:{type:"compressed",levels:r}}}const y=31,C=1,T=2,g=3,A=4,E=7,b=21,S=131072;function _(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const D=_("DXT1"),X=_("DXT3"),B=_("DXT5")}}]);
//# sourceMappingURL=6745.c3e70f8f.chunk.js.map